#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Secret scanning with gitleaks (REQUIRED)
if ! command -v gitleaks &> /dev/null; then
  echo "‚ùå BLOCKED: gitleaks is not installed"
  echo ""
  echo "   Install it first:"
  echo "   - Windows: winget install gitleaks"
  echo "   - macOS:   brew install gitleaks"
  echo "   - Linux:   https://github.com/gitleaks/gitleaks#installing"
  echo ""
  exit 1
fi

echo "üîç Scanning for secrets..."
gitleaks protect --staged --config .gitleaks.toml
if [ $? -ne 0 ]; then
  echo "‚ùå Secrets detected! Commit blocked."
  echo "   Review the findings and remove sensitive data."
  exit 1
fi
echo "‚úÖ No secrets found"
