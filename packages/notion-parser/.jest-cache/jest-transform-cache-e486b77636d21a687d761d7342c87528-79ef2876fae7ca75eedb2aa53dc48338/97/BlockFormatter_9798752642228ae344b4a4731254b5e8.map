{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\formatters\\BlockFormatter.ts","mappings":"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","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\formatters\\BlockFormatter.ts"],"sourcesContent":["import type { NotionBlock, NotionColor } from '../types';\r\n\r\nexport interface FormattingOptions {\r\n  color?: NotionColor;\r\n  applyColorToAll?: boolean;\r\n  normalizeWhitespace?: boolean;\r\n  removeEmptyBlocks?: boolean;\r\n  mergeConsecutiveParagraphs?: boolean;\r\n  maxConsecutiveEmptyLines?: number;\r\n  mergeSimilarBlocks?: boolean;\r\n  trimRichText?: boolean;\r\n  enforceBlockLimits?: boolean;\r\n  optimizeStructure?: boolean;\r\n  maxBlockDepth?: number;\r\n  maxChildrenPerBlock?: number;\r\n}\r\n\r\nexport class BlockFormatter {\r\n  format(blocks: NotionBlock[], options: FormattingOptions = {}): NotionBlock[] {\r\n    let formattedBlocks = [...blocks];\r\n\r\n    // Remove empty blocks if requested\r\n    if (options.removeEmptyBlocks) {\r\n      formattedBlocks = this.removeEmptyBlocks(formattedBlocks);\r\n    }\r\n\r\n    // Normalize whitespace if requested\r\n    if (options.normalizeWhitespace) {\r\n      formattedBlocks = this.normalizeWhitespace(formattedBlocks);\r\n    }\r\n\r\n    // Apply color if specified\r\n    if (options.color && options.applyColorToAll) {\r\n      formattedBlocks = this.applyColor(formattedBlocks, options.color);\r\n    }\r\n\r\n    // Merge consecutive paragraphs if requested\r\n    if (options.mergeConsecutiveParagraphs) {\r\n      formattedBlocks = this.mergeConsecutiveParagraphs(formattedBlocks);\r\n    }\r\n\r\n    // Limit consecutive empty lines\r\n    if (options.maxConsecutiveEmptyLines !== undefined) {\r\n      formattedBlocks = this.limitConsecutiveEmptyLines(\r\n        formattedBlocks, \r\n        options.maxConsecutiveEmptyLines\r\n      );\r\n    }\r\n\r\n    // Merge similar blocks if requested\r\n    if (options.mergeSimilarBlocks) {\r\n      formattedBlocks = this.mergeSimilarBlocks(formattedBlocks);\r\n    }\r\n\r\n    // Trim rich text if requested\r\n    if (options.trimRichText) {\r\n      formattedBlocks = this.trimRichText(formattedBlocks);\r\n    }\r\n\r\n    // Enforce block limits if requested\r\n    if (options.enforceBlockLimits) {\r\n      formattedBlocks = this.enforceBlockLimits(formattedBlocks, options);\r\n    }\r\n\r\n    // Optimize structure if requested\r\n    if (options.optimizeStructure) {\r\n      formattedBlocks = this.optimizeStructure(formattedBlocks, options);\r\n    }\r\n\r\n    return formattedBlocks;\r\n  }\r\n\r\n  private removeEmptyBlocks(blocks: NotionBlock[]): NotionBlock[] {\r\n    return blocks.filter(block => {\r\n      switch (block.type) {\r\n        case 'paragraph':\r\n          return this.hasContent((block as any).paragraph?.rich_text);\r\n        case 'heading_1':\r\n        case 'heading_2':\r\n        case 'heading_3':\r\n          const headingField = (block as any)[block.type];\r\n          return this.hasContent(headingField?.rich_text);\r\n        case 'bulleted_list_item':\r\n        case 'numbered_list_item':\r\n          const listField = (block as any)[block.type];\r\n          return this.hasContent(listField?.rich_text);\r\n        case 'to_do':\r\n          return this.hasContent((block as any).to_do?.rich_text);\r\n        case 'toggle':\r\n          return this.hasContent((block as any).toggle?.rich_text);\r\n        case 'quote':\r\n          return this.hasContent((block as any).quote?.rich_text);\r\n        case 'callout':\r\n          return this.hasContent((block as any).callout?.rich_text);\r\n        case 'code':\r\n          return this.hasContent((block as any).code?.rich_text);\r\n        default:\r\n          return true; // Keep other block types\r\n      }\r\n    });\r\n  }\r\n\r\n  private hasContent(richText: any[]): boolean {\r\n    if (!Array.isArray(richText)) return false;\r\n    \r\n    return richText.some(item => {\r\n      const content = item.type === 'text' \r\n        ? item.text?.content || ''\r\n        : item.type === 'equation'\r\n        ? item.equation?.expression || ''\r\n        : '';\r\n      return content.trim().length > 0;\r\n    });\r\n  }\r\n\r\n  private normalizeWhitespace(blocks: NotionBlock[]): NotionBlock[] {\r\n    return blocks.map(block => {\r\n      const clonedBlock = { ...block };\r\n\r\n      switch (block.type) {\r\n        case 'paragraph':\r\n          (clonedBlock as any).paragraph = {\r\n            ...(clonedBlock as any).paragraph,\r\n            rich_text: this.normalizeRichTextWhitespace((clonedBlock as any).paragraph?.rich_text)\r\n          };\r\n          break;\r\n        case 'heading_1':\r\n        case 'heading_2':\r\n        case 'heading_3':\r\n          const headingField = (clonedBlock as any)[block.type];\r\n          (clonedBlock as any)[block.type] = {\r\n            ...headingField,\r\n            rich_text: this.normalizeRichTextWhitespace(headingField?.rich_text)\r\n          };\r\n          break;\r\n        case 'bulleted_list_item':\r\n        case 'numbered_list_item':\r\n          const listField = (clonedBlock as any)[block.type];\r\n          (clonedBlock as any)[block.type] = {\r\n            ...listField,\r\n            rich_text: this.normalizeRichTextWhitespace(listField?.rich_text)\r\n          };\r\n          break;\r\n        case 'to_do':\r\n          (clonedBlock as any).to_do = {\r\n            ...(clonedBlock as any).to_do,\r\n            rich_text: this.normalizeRichTextWhitespace((clonedBlock as any).to_do?.rich_text)\r\n          };\r\n          break;\r\n        case 'toggle':\r\n          (clonedBlock as any).toggle = {\r\n            ...(clonedBlock as any).toggle,\r\n            rich_text: this.normalizeRichTextWhitespace((clonedBlock as any).toggle?.rich_text)\r\n          };\r\n          break;\r\n        case 'quote':\r\n          (clonedBlock as any).quote = {\r\n            ...(clonedBlock as any).quote,\r\n            rich_text: this.normalizeRichTextWhitespace((clonedBlock as any).quote?.rich_text)\r\n          };\r\n          break;\r\n        case 'callout':\r\n          (clonedBlock as any).callout = {\r\n            ...(clonedBlock as any).callout,\r\n            rich_text: this.normalizeRichTextWhitespace((clonedBlock as any).callout?.rich_text)\r\n          };\r\n          break;\r\n      }\r\n\r\n      return clonedBlock;\r\n    });\r\n  }\r\n\r\n  private normalizeRichTextWhitespace(richText: any[]): any[] {\r\n    if (!Array.isArray(richText)) return richText;\r\n\r\n    return richText.map(item => {\r\n      if (item.type === 'text' && item.text?.content) {\r\n        return {\r\n          ...item,\r\n          text: {\r\n            ...item.text,\r\n            content: item.text.content\r\n              .replace(/\\r\\n/g, '\\n')\r\n              .replace(/\\r/g, '\\n')\r\n              .replace(/\\t/g, '  ')\r\n              .replace(/[ ]+/g, ' ')\r\n              .trim()\r\n          }\r\n        };\r\n      }\r\n      return item;\r\n    });\r\n  }\r\n\r\n  private applyColor(blocks: NotionBlock[], color: NotionColor): NotionBlock[] {\r\n    return blocks.map(block => {\r\n      const clonedBlock = { ...block };\r\n\r\n      switch (block.type) {\r\n        case 'paragraph':\r\n          (clonedBlock as any).paragraph = {\r\n            ...(clonedBlock as any).paragraph,\r\n            color\r\n          };\r\n          break;\r\n        case 'heading_1':\r\n        case 'heading_2':\r\n        case 'heading_3':\r\n          (clonedBlock as any)[block.type] = {\r\n            ...(clonedBlock as any)[block.type],\r\n            color\r\n          };\r\n          break;\r\n        case 'bulleted_list_item':\r\n        case 'numbered_list_item':\r\n          (clonedBlock as any)[block.type] = {\r\n            ...(clonedBlock as any)[block.type],\r\n            color\r\n          };\r\n          break;\r\n        case 'to_do':\r\n          (clonedBlock as any).to_do = {\r\n            ...(clonedBlock as any).to_do,\r\n            color\r\n          };\r\n          break;\r\n        case 'toggle':\r\n          (clonedBlock as any).toggle = {\r\n            ...(clonedBlock as any).toggle,\r\n            color\r\n          };\r\n          break;\r\n        case 'quote':\r\n          (clonedBlock as any).quote = {\r\n            ...(clonedBlock as any).quote,\r\n            color\r\n          };\r\n          break;\r\n        case 'callout':\r\n          (clonedBlock as any).callout = {\r\n            ...(clonedBlock as any).callout,\r\n            color\r\n          };\r\n          break;\r\n      }\r\n\r\n      return clonedBlock;\r\n    });\r\n  }\r\n\r\n  private mergeConsecutiveParagraphs(blocks: NotionBlock[]): NotionBlock[] {\r\n    const result: NotionBlock[] = [];\r\n    let currentParagraph: any = null;\r\n\r\n    for (const block of blocks) {\r\n      if (block.type === 'paragraph') {\r\n        if (currentParagraph) {\r\n          // Merge with previous paragraph\r\n          currentParagraph.paragraph.rich_text = [\r\n            ...currentParagraph.paragraph.rich_text,\r\n            { type: 'text', text: { content: ' ' } }, // Add space between merged paragraphs\r\n            ...(block as any).paragraph.rich_text\r\n          ];\r\n        } else {\r\n          currentParagraph = { ...block };\r\n        }\r\n      } else {\r\n        // Push accumulated paragraph if exists\r\n        if (currentParagraph) {\r\n          result.push(currentParagraph);\r\n          currentParagraph = null;\r\n        }\r\n        result.push(block);\r\n      }\r\n    }\r\n\r\n    // Push final paragraph if exists\r\n    if (currentParagraph) {\r\n      result.push(currentParagraph);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private limitConsecutiveEmptyLines(blocks: NotionBlock[], maxEmpty: number): NotionBlock[] {\r\n    const result: NotionBlock[] = [];\r\n    let consecutiveEmptyCount = 0;\r\n\r\n    for (const block of blocks) {\r\n      const isEmpty = this.isEmptyBlock(block);\r\n\r\n      if (isEmpty) {\r\n        consecutiveEmptyCount++;\r\n        if (consecutiveEmptyCount <= maxEmpty) {\r\n          result.push(block);\r\n        }\r\n      } else {\r\n        consecutiveEmptyCount = 0;\r\n        result.push(block);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private isEmptyBlock(block: NotionBlock): boolean {\r\n    switch (block.type) {\r\n      case 'paragraph':\r\n        return !this.hasContent((block as any).paragraph?.rich_text);\r\n      case 'heading_1':\r\n      case 'heading_2':\r\n      case 'heading_3':\r\n        const headingField = (block as any)[block.type];\r\n        return !this.hasContent(headingField?.rich_text);\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Optimise les blocs pour réduire la taille\r\n   */\r\n  optimize(blocks: NotionBlock[]): NotionBlock[] {\r\n    return this.format(blocks, {\r\n      removeEmptyBlocks: true,\r\n      normalizeWhitespace: true,\r\n      maxConsecutiveEmptyLines: 1\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Applique un style cohérent à tous les blocs\r\n   */\r\n  applyTheme(blocks: NotionBlock[], theme: { color?: NotionColor }): NotionBlock[] {\r\n    return this.format(blocks, {\r\n      color: theme.color,\r\n      applyColorToAll: !!theme.color,\r\n      normalizeWhitespace: true\r\n    });\r\n  }\r\n\r\n  private mergeSimilarBlocks(blocks: NotionBlock[]): NotionBlock[] {\r\n    const result: NotionBlock[] = [];\r\n    let i = 0;\r\n\r\n    while (i < blocks.length) {\r\n      const currentBlock = blocks[i];\r\n      \r\n      // Look for consecutive blocks of the same type that can be merged\r\n      if (this.canMergeBlockType(currentBlock.type)) {\r\n        const similarBlocks = [currentBlock];\r\n        let j = i + 1;\r\n        \r\n        while (j < blocks.length && this.areBlocksSimilar(currentBlock, blocks[j])) {\r\n          similarBlocks.push(blocks[j]);\r\n          j++;\r\n        }\r\n        \r\n        if (similarBlocks.length > 1) {\r\n          const mergedBlock = this.mergeBlocks(similarBlocks);\r\n          result.push(mergedBlock);\r\n        } else {\r\n          result.push(currentBlock);\r\n        }\r\n        \r\n        i = j;\r\n      } else {\r\n        result.push(currentBlock);\r\n        i++;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private canMergeBlockType(type: string): boolean {\r\n    return ['paragraph', 'code'].includes(type);\r\n  }\r\n\r\n  private areBlocksSimilar(block1: NotionBlock, block2: NotionBlock): boolean {\r\n    if (block1.type !== block2.type) return false;\r\n    \r\n    switch (block1.type) {\r\n      case 'code':\r\n        const code1 = (block1 as any).code;\r\n        const code2 = (block2 as any).code;\r\n        return code1?.language === code2?.language;\r\n      case 'paragraph':\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  private mergeBlocks(blocks: NotionBlock[]): NotionBlock {\r\n    const firstBlock = blocks[0];\r\n    const type = firstBlock.type;\r\n    \r\n    switch (type) {\r\n      case 'paragraph':\r\n        const mergedRichText = blocks.flatMap((block, index) => {\r\n          const richText = (block as any).paragraph?.rich_text || [];\r\n          if (index > 0) {\r\n            return [\r\n              { type: 'text', text: { content: '\\n' } },\r\n              ...richText\r\n            ];\r\n          }\r\n          return richText;\r\n        });\r\n        \r\n        return {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: mergedRichText,\r\n            color: (firstBlock as any).paragraph?.color\r\n          }\r\n        };\r\n        \r\n      case 'code':\r\n        const mergedCode = blocks.map(block => \r\n          (block as any).code?.rich_text?.[0]?.text?.content || ''\r\n        ).join('\\n');\r\n        \r\n        return {\r\n          type: 'code',\r\n          code: {\r\n            rich_text: [{ type: 'text', text: { content: mergedCode } }],\r\n            language: (firstBlock as any).code?.language || 'plain text'\r\n          }\r\n        };\r\n        \r\n      default:\r\n        return firstBlock;\r\n    }\r\n  }\r\n\r\n  private trimRichText(blocks: NotionBlock[]): NotionBlock[] {\r\n    return blocks.map(block => {\r\n      const clonedBlock = { ...block };\r\n      \r\n      const richTextFields = this.getRichTextFields(block);\r\n      \r\n      for (const field of richTextFields) {\r\n        const richText = this.getNestedProperty(clonedBlock, field);\r\n        if (Array.isArray(richText)) {\r\n          this.setNestedProperty(clonedBlock, field, this.trimRichTextArray(richText));\r\n        }\r\n      }\r\n      \r\n      return clonedBlock;\r\n    });\r\n  }\r\n\r\n  private trimRichTextArray(richText: any[]): any[] {\r\n    if (!Array.isArray(richText) || richText.length === 0) return richText;\r\n    \r\n    // Trim leading and trailing empty text items\r\n    let start = 0;\r\n    let end = richText.length - 1;\r\n    \r\n    while (start <= end && this.isEmptyRichTextItem(richText[start])) {\r\n      start++;\r\n    }\r\n    \r\n    while (end >= start && this.isEmptyRichTextItem(richText[end])) {\r\n      end--;\r\n    }\r\n    \r\n    return richText.slice(start, end + 1);\r\n  }\r\n\r\n  private isEmptyRichTextItem(item: any): boolean {\r\n    if (item.type === 'text') {\r\n      return !item.text?.content?.trim();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private enforceBlockLimits(blocks: NotionBlock[], options: FormattingOptions): NotionBlock[] {\r\n    let result = [...blocks];\r\n    \r\n    // Limit total number of blocks\r\n    if (options.maxChildrenPerBlock && result.length > options.maxChildrenPerBlock) {\r\n      result = result.slice(0, options.maxChildrenPerBlock);\r\n    }\r\n    \r\n    // Limit block depth\r\n    if (options.maxBlockDepth) {\r\n      result = this.limitBlockDepth(result, options.maxBlockDepth);\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  private limitBlockDepth(blocks: NotionBlock[], maxDepth: number, currentDepth = 0): NotionBlock[] {\r\n    if (currentDepth >= maxDepth) {\r\n      return blocks.map(block => ({ ...block, children: undefined }));\r\n    }\r\n    \r\n    return blocks.map(block => {\r\n      const clonedBlock = { ...block };\r\n      \r\n      if ((clonedBlock as any).children) {\r\n        (clonedBlock as any).children = this.limitBlockDepth(\r\n          (clonedBlock as any).children,\r\n          maxDepth,\r\n          currentDepth + 1\r\n        );\r\n      }\r\n      \r\n      return clonedBlock;\r\n    });\r\n  }\r\n\r\n  private optimizeStructure(blocks: NotionBlock[], _options: FormattingOptions): NotionBlock[] {\r\n    let result = [...blocks];\r\n    \r\n    // Remove redundant nesting\r\n    result = this.flattenUnnecessaryNesting(result);\r\n    \r\n    // Optimize list structures\r\n    result = this.optimizeListStructures(result);\r\n    \r\n    // Remove duplicate consecutive blocks\r\n    result = this.removeDuplicateBlocks(result);\r\n    \r\n    return result;\r\n  }\r\n\r\n  private flattenUnnecessaryNesting(blocks: NotionBlock[]): NotionBlock[] {\r\n    return blocks.map(block => {\r\n      const clonedBlock = { ...block };\r\n      \r\n      // If a block has only one child and they're the same type, flatten\r\n      if ((clonedBlock as any).children?.length === 1) {\r\n        const child = (clonedBlock as any).children[0];\r\n        if (child.type === block.type) {\r\n          return child;\r\n        }\r\n      }\r\n      \r\n      return clonedBlock;\r\n    });\r\n  }\r\n\r\n  private optimizeListStructures(blocks: NotionBlock[]): NotionBlock[] {\r\n    // Group consecutive list items\r\n    const result: NotionBlock[] = [];\r\n    let i = 0;\r\n    \r\n    while (i < blocks.length) {\r\n      const block = blocks[i];\r\n      \r\n      if (this.isListItem(block)) {\r\n        const listItems = [block];\r\n        let j = i + 1;\r\n        \r\n        while (j < blocks.length && this.isListItem(blocks[j]) && \r\n               this.isSameListType(block, blocks[j])) {\r\n          listItems.push(blocks[j]);\r\n          j++;\r\n        }\r\n        \r\n        result.push(...listItems);\r\n        i = j;\r\n      } else {\r\n        result.push(block);\r\n        i++;\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  private isListItem(block: NotionBlock): boolean {\r\n    return ['bulleted_list_item', 'numbered_list_item', 'to_do'].includes(block.type);\r\n  }\r\n\r\n  private isSameListType(block1: NotionBlock, block2: NotionBlock): boolean {\r\n    return block1.type === block2.type;\r\n  }\r\n\r\n  private removeDuplicateBlocks(blocks: NotionBlock[]): NotionBlock[] {\r\n    const result: NotionBlock[] = [];\r\n    let lastBlock: NotionBlock | null = null;\r\n    \r\n    for (const block of blocks) {\r\n      if (!lastBlock || !this.areBlocksIdentical(lastBlock, block)) {\r\n        result.push(block);\r\n        lastBlock = block;\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  private areBlocksIdentical(block1: NotionBlock, block2: NotionBlock): boolean {\r\n    return JSON.stringify(block1) === JSON.stringify(block2);\r\n  }\r\n\r\n  private getRichTextFields(block: NotionBlock): string[] {\r\n    switch (block.type) {\r\n      case 'paragraph':\r\n        return ['paragraph.rich_text'];\r\n      case 'heading_1':\r\n        return ['heading_1.rich_text'];\r\n      case 'heading_2':\r\n        return ['heading_2.rich_text'];\r\n      case 'heading_3':\r\n        return ['heading_3.rich_text'];\r\n      case 'bulleted_list_item':\r\n        return ['bulleted_list_item.rich_text'];\r\n      case 'numbered_list_item':\r\n        return ['numbered_list_item.rich_text'];\r\n      case 'to_do':\r\n        return ['to_do.rich_text'];\r\n      case 'toggle':\r\n        return ['toggle.rich_text'];\r\n      case 'quote':\r\n        return ['quote.rich_text'];\r\n      case 'callout':\r\n        return ['callout.rich_text'];\r\n      case 'code':\r\n        return ['code.rich_text'];\r\n      default:\r\n        return [];\r\n    }\r\n  }\r\n\r\n  private getNestedProperty(obj: any, path: string): any {\r\n    return path.split('.').reduce((current, key) => current?.[key], obj);\r\n  }\r\n\r\n  private setNestedProperty(obj: any, path: string, value: any): void {\r\n    const keys = path.split('.');\r\n    const lastKey = keys.pop()!;\r\n    const target = keys.reduce((current, key) => {\r\n      if (!current[key]) current[key] = {};\r\n      return current[key];\r\n    }, obj);\r\n    target[lastKey] = value;\r\n  }\r\n}"],"version":3}