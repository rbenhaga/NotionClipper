{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\comprehensive\\security.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\comprehensive\\security.test.ts"],"sourcesContent":["/**\r\n * Tests de sécurité complets - Conformes au Cahier des Charges v2.1 ⭐\r\n * Couvre la protection XSS, injection, DoS et validation de sécurité\r\n */\r\n\r\nimport { parseContent } from '../../src/parseContent';\r\nimport { testHelpers } from '../helpers/test-helpers';\r\n\r\n// Types locaux\r\ntype TestBlock = {\r\n  type: string;\r\n  [key: string]: any;\r\n};\r\n\r\ntype SecurityTestCase = {\r\n  name: string;\r\n  input: string;\r\n  expectedBlocked: boolean;\r\n  description: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n};\r\n\r\n// Constantes locales\r\nconst TEST_CONSTANTS = {\r\n  SECURITY_PATTERNS: {\r\n    MALICIOUS_URLS: [\r\n      'javascript:void(0)',\r\n      'data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==',\r\n      'vbscript:msgbox(1)',\r\n      'file:///etc/passwd'\r\n    ]\r\n  }\r\n};\r\n\r\ndescribe('Security Tests - Cahier des Charges v2.1 ⭐', () => {\r\n  describe('XSS Protection', () => {\r\n    const xssTestCases: SecurityTestCase[] = [\r\n      {\r\n        name: 'Script tag injection',\r\n        input: '<div><script>alert(\"XSS\")</script><p>Normal content</p></div>',\r\n        expectedBlocked: true,\r\n        description: 'Should block script tags in HTML content',\r\n        severity: 'critical'\r\n      },\r\n      {\r\n        name: 'Event handler injection',\r\n        input: '<div onclick=\"alert(\\'XSS\\')\" onload=\"malicious()\"><p onmouseover=\"steal()\">Content</p></div>',\r\n        expectedBlocked: true,\r\n        description: 'Should remove event handlers from HTML',\r\n        severity: 'critical'\r\n      },\r\n      {\r\n        name: 'SVG with embedded scripts',\r\n        input: '<svg onload=\"alert(\\'XSS\\')\"><script>malicious()</script></svg>',\r\n        expectedBlocked: true,\r\n        description: 'Should block SVG with embedded scripts',\r\n        severity: 'critical'\r\n      },\r\n      {\r\n        name: 'Iframe injection',\r\n        input: '<iframe src=\"javascript:alert(\\'XSS\\')\"></iframe>',\r\n        expectedBlocked: true,\r\n        description: 'Should block malicious iframes',\r\n        severity: 'high'\r\n      }\r\n    ];\r\n\r\n    xssTestCases.forEach(testCase => {\r\n      it(`should handle ${testCase.name}`, () => {\r\n        const result = parseContent(testCase.input, { contentType: 'html' });\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        const resultString = JSON.stringify(result.blocks);\r\n        const hasScript = resultString.toLowerCase().includes('<script');\r\n        const hasEventHandlers = /on\\w+\\s*=/i.test(resultString);\r\n        \r\n        if (testCase.expectedBlocked) {\r\n          expect(hasScript).toBe(false);\r\n          expect(hasEventHandlers).toBe(false);\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('URL Protocol Security', () => {\r\n    const maliciousUrls = TEST_CONSTANTS.SECURITY_PATTERNS.MALICIOUS_URLS;\r\n\r\n    maliciousUrls.forEach(url => {\r\n      it(`should block malicious URL: ${url.substring(0, 20)}...`, () => {\r\n        const content = `[Click me](${url})`;\r\n        const result = parseContent(content, { contentType: 'markdown' });\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        const resultString = JSON.stringify(result.blocks);\r\n        \r\n        // Check that dangerous protocols are blocked (URLs should be empty)\r\n        if (url.startsWith('javascript:') || url.startsWith('vbscript:')) {\r\n          expect(resultString).toContain('\"url\":\"\"'); // URL should be sanitized to empty string\r\n        }\r\n        \r\n        // Data URLs with HTML/JS should be blocked\r\n        if (url.includes('data:text/html') && url.includes('script')) {\r\n          expect(resultString).not.toMatch(/data:text\\/html.*<script/i);\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should validate internal network URLs', () => {\r\n      const internalUrls = [\r\n        'http://localhost:3000/admin',\r\n        'http://127.0.0.1/secret',\r\n        'http://192.168.1.1/config',\r\n        'http://10.0.0.1/internal'\r\n      ];\r\n      \r\n      internalUrls.forEach(url => {\r\n        const result = parseContent(`[Link](${url})`, { contentType: 'markdown' });\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        // Internal URLs should be handled appropriately\r\n        // (Implementation dependent - may block or allow with warning)\r\n        expect(result.success).toBe(true);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Content Sanitization', () => {\r\n    it('should detect and handle null bytes', () => {\r\n      const contentWithNullBytes = `Normal text\\x00hidden content`;\r\n      \r\n      const result = parseContent(contentWithNullBytes);\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toMatch(/\\x00/);\r\n    });\r\n\r\n    it('should sanitize control characters', () => {\r\n      const contentWithControlChars = `Text with\\x01\\x02\\x03control chars`;\r\n      \r\n      const result = parseContent(contentWithControlChars);\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toMatch(/[\\x01-\\x08\\x0B\\x0C\\x0E-\\x1F]/);\r\n    });\r\n\r\n    it('should safely decode HTML entities', () => {\r\n      const contentWithEntities = `&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;`;\r\n      \r\n      const result = parseContent(contentWithEntities, { contentType: 'html' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toMatch(/<script.*>.*alert.*<\\/script>/i);\r\n    });\r\n  });\r\n\r\n  describe('Input Validation', () => {\r\n    it('should handle extremely long URLs safely', () => {\r\n      const longUrl = 'https://example.com/' + 'a'.repeat(10000);\r\n      \r\n      const result = parseContent(longUrl);\r\n      \r\n      expect(result.success).toBeDefined();\r\n      if (!result.success) {\r\n        expect(result.error).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should validate URL formats strictly', () => {\r\n      const malformedUrls = [\r\n        'ht tp://example.com',\r\n        'https://exam ple.com',\r\n        'https://example.com/<script>',\r\n        'ftp://example.com\\x00hidden'\r\n      ];\r\n      \r\n      malformedUrls.forEach(url => {\r\n        const result = parseContent(url);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        const hasValidLink = result.blocks.some((block: TestBlock) => \r\n          block.paragraph?.rich_text?.some((segment: any) => \r\n            segment.href === url\r\n          )\r\n        );\r\n        \r\n        expect(hasValidLink).toBe(false);\r\n      });\r\n    });\r\n\r\n    it('should prevent ReDoS attacks with complex regex', () => {\r\n      const redosContent = 'a'.repeat(1000) + '!';\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(redosContent);\r\n      const endTime = Date.now();\r\n      \r\n      expect(endTime - startTime).toBeLessThan(5000);\r\n      expect(result.success).toBeDefined();\r\n    });\r\n  });\r\n\r\n  // ⭐ NOUVEAU : Tests de sécurité pour les nouvelles fonctionnalités v2.1\r\n  describe('Audio URL Security (⭐ NOUVEAU v2.1)', () => {\r\n    it('should block malicious audio URLs', () => {\r\n      const maliciousAudioUrls = [\r\n        'javascript:alert(\"xss\").mp3',\r\n        'data:audio/mp3;base64,malicious_payload',\r\n        'file:///etc/passwd.mp3',\r\n        'ftp://malicious.com/audio.mp3'\r\n      ];\r\n      \r\n      maliciousAudioUrls.forEach(url => {\r\n        const result = parseContent(url);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        // Should not create audio blocks for malicious URLs\r\n        const audioBlocks = result.blocks.filter((block: TestBlock) => \r\n          block.type === 'audio'\r\n        );\r\n        expect(audioBlocks.length).toBe(0);\r\n      });\r\n    });\r\n\r\n    it('should validate audio URL length limits', () => {\r\n      const longAudioUrl = 'https://example.com/' + 'a'.repeat(5000) + '.mp3';\r\n      \r\n      const result = parseContent(longAudioUrl);\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      // Should handle gracefully without creating invalid blocks\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('should sanitize audio URLs with special characters', () => {\r\n      const specialCharUrls = [\r\n        'https://example.com/audio<script>.mp3',\r\n        'https://example.com/audio\"onclick=\"alert().mp3',\r\n        'https://example.com/audio\\x00hidden.mp3'\r\n      ];\r\n      \r\n      specialCharUrls.forEach(url => {\r\n        const result = parseContent(url);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        const resultString = JSON.stringify(result.blocks);\r\n        expect(resultString).not.toContain('<script>');\r\n        expect(resultString).not.toContain('onclick=');\r\n        expect(resultString).not.toMatch(/\\x00/);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('File Upload Security (⭐ NOUVEAU v2.1)', () => {\r\n    it('should validate file upload parameters', () => {\r\n      // Mock file upload scenarios\r\n      const maliciousFilenames = [\r\n        '../../../etc/passwd',\r\n        'file<script>alert()</script>.jpg',\r\n        'file\\x00hidden.exe.jpg',\r\n        'file\"onclick=\"alert().jpg'\r\n      ];\r\n      \r\n      maliciousFilenames.forEach(filename => {\r\n        // Test filename validation\r\n        expect(() => {\r\n          // This would be tested with actual FileUploadHandler\r\n          const sanitized = filename.replace(/[<>\"'&\\x00-\\x1f]/g, '');\r\n          expect(sanitized).not.toContain('<script>');\r\n          expect(sanitized).not.toContain('\\x00');\r\n        }).not.toThrow();\r\n      });\r\n    });\r\n\r\n    it('should prevent path traversal in filenames', () => {\r\n      const pathTraversalNames = [\r\n        '../../../etc/passwd',\r\n        '..\\\\..\\\\windows\\\\system32\\\\config',\r\n        '/etc/shadow',\r\n        'C:\\\\Windows\\\\System32\\\\config'\r\n      ];\r\n      \r\n      pathTraversalNames.forEach(filename => {\r\n        // Should sanitize path traversal attempts\r\n        const sanitized = filename.replace(/[./\\\\]/g, '_');\r\n        expect(sanitized).not.toContain('../');\r\n        expect(sanitized).not.toContain('..\\\\');\r\n      });\r\n    });\r\n\r\n    it('should validate MIME type consistency', () => {\r\n      const inconsistentFiles = [\r\n        { filename: 'image.jpg', mimeType: 'application/javascript' },\r\n        { filename: 'document.pdf', mimeType: 'text/html' },\r\n        { filename: 'audio.mp3', mimeType: 'application/x-executable' }\r\n      ];\r\n      \r\n      inconsistentFiles.forEach(file => {\r\n        // Should detect MIME type inconsistencies\r\n        const expectedMime = file.filename.endsWith('.jpg') ? 'image/jpeg' :\r\n                           file.filename.endsWith('.pdf') ? 'application/pdf' :\r\n                           file.filename.endsWith('.mp3') ? 'audio/mpeg' : 'unknown';\r\n        \r\n        expect(file.mimeType).not.toBe(expectedMime);\r\n        // In real implementation, this should trigger validation warning\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Table Header Injection Security (⭐ NOUVEAU v2.1)', () => {\r\n    it('should sanitize malicious content in table headers', () => {\r\n      const maliciousTable = `<script>alert('xss')</script>,onclick=\"alert()\",Normal\r\nJohn,30,NYC\r\nJane,25,LA`;\r\n      \r\n      const result = parseContent(maliciousTable, { contentType: 'csv' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toContain('<script>');\r\n      expect(resultString).not.toContain('onclick=');\r\n    });\r\n\r\n    it('should handle formula injection in CSV headers', () => {\r\n      const formulaInjectionTable = `=cmd|'/c calc'!A0,=HYPERLINK(\"http://evil.com\"),Name\r\nJohn,30,NYC\r\nJane,25,LA`;\r\n      \r\n      const result = parseContent(formulaInjectionTable, { contentType: 'csv' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toMatch(/^=/); // Should not start with =\r\n      expect(resultString).not.toContain('cmd');\r\n      expect(resultString).not.toContain('HYPERLINK');\r\n    });\r\n\r\n    it('should prevent CSV injection attacks', () => {\r\n      const csvInjectionTable = `@SUM(1+1)*cmd|'/c calc'!A0,Name,Age\r\n=1+1+cmd|'/c calc'!A0,John,30\r\n+1+1+cmd|'/c calc'!A0,Jane,25`;\r\n      \r\n      const result = parseContent(csvInjectionTable, { contentType: 'csv' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toMatch(/^[@=+]/); // Should not start with formula chars\r\n      expect(resultString).not.toContain('cmd');\r\n    });\r\n  });\r\n\r\n  describe('Toggle Heading Security (⭐ NOUVEAU v2.1)', () => {\r\n    it('should sanitize malicious content in toggle headings', () => {\r\n      const maliciousToggle = `> # <script>alert('xss')</script> Heading\r\n> Content with <img src=\"x\" onerror=\"alert()\">`;\r\n      \r\n      const result = parseContent(maliciousToggle, { contentType: 'markdown' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toContain('<script>');\r\n      expect(resultString).not.toContain('onerror=');\r\n    });\r\n\r\n    it('should prevent nested script injection in toggle content', () => {\r\n      const nestedInjection = `> # Safe Heading\r\n> Normal content\r\n> <div onclick=\"malicious()\">\r\n> <script>alert('nested')</script>\r\n> </div>`;\r\n      \r\n      const result = parseContent(nestedInjection, { contentType: 'markdown' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toContain('<script>');\r\n      expect(resultString).not.toContain('onclick=');\r\n    });\r\n  });\r\n\r\n  describe('DoS Protection (Enhanced v2.1)', () => {\r\n    it('should handle extremely large audio playlists', () => {\r\n      const largePlaylist = Array(10000).fill(0)\r\n        .map((_, i) => `https://example.com/song${i}.mp3`)\r\n        .join('\\n');\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(largePlaylist);\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(processingTime).toBeLessThan(5000); // Should not hang\r\n      expect(result.success).toBeDefined();\r\n    });\r\n\r\n    it('should handle massive table data efficiently', () => {\r\n      const massiveTable = Array(5000).fill(0)\r\n        .map((_, i) => `Row${i},Data${i},Value${i}`)\r\n        .join('\\n');\r\n      const tableWithHeader = `Header1,Header2,Header3\\n${massiveTable}`;\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(tableWithHeader, { contentType: 'csv' });\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(processingTime).toBeLessThan(3000); // Should be reasonably fast\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('should handle deeply nested toggle structures', () => {\r\n      let nestedToggle = '> # Level 1\\n> Content 1\\n';\r\n      for (let i = 2; i <= 100; i++) {\r\n        nestedToggle += `> ${'#'.repeat(Math.min(i, 3))} Level ${i}\\n> Content ${i}\\n`;\r\n      }\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(nestedToggle, { contentType: 'markdown' });\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(processingTime).toBeLessThan(2000);\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('should prevent memory exhaustion with large files', () => {\r\n      const hugeContent = 'x'.repeat(10 * 1024 * 1024); // 10MB\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(hugeContent);\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(processingTime).toBeLessThan(10000); // Should not hang\r\n      expect(result.success).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Advanced Security Validation', () => {\r\n    it('should detect and prevent polyglot attacks', () => {\r\n      const polyglotContent = `<!--<script>alert(1)</script>-->\r\n<svg onload=alert(1)>\r\n/*<script>alert(1)</script>*/\r\n#<script>alert(1)</script>\r\n**<script>alert(1)</script>**`;\r\n      \r\n      const result = parseContent(polyglotContent, { contentType: 'markdown' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toContain('<script>');\r\n      expect(resultString).not.toContain('onload=');\r\n    });\r\n\r\n    it('should validate Unicode normalization attacks', () => {\r\n      const unicodeAttack = 'java\\u0073cript:alert(1)'; // 's' as Unicode\r\n      \r\n      const result = parseContent(`[Link](${unicodeAttack})`);\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      expect(resultString).not.toContain('javascript:');\r\n    });\r\n\r\n    it('should prevent encoding bypass attacks', () => {\r\n      const encodingBypass = [\r\n        '%6A%61%76%61%73%63%72%69%70%74%3A', // javascript: URL encoded\r\n        '&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;', // HTML entities\r\n        'jav\\x61script:', // Hex encoding\r\n        'jav&#x61;script:' // Mixed encoding\r\n      ];\r\n      \r\n      encodingBypass.forEach(encoded => {\r\n        const result = parseContent(`[Link](${encoded}alert(1))`);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        const resultString = JSON.stringify(result.blocks);\r\n        expect(resultString).not.toMatch(/javascript:/i);\r\n      });\r\n    });\r\n\r\n    it('should validate against SSRF attacks in URLs', () => {\r\n      const ssrfUrls = [\r\n        'http://169.254.169.254/latest/meta-data/', // AWS metadata\r\n        'http://metadata.google.internal/', // GCP metadata\r\n        'http://localhost:6379/', // Redis\r\n        'http://127.0.0.1:22/', // SSH\r\n        'gopher://127.0.0.1:11211/', // Memcached\r\n        'dict://127.0.0.1:11211/' // Dict protocol\r\n      ];\r\n      \r\n      ssrfUrls.forEach(url => {\r\n        const result = parseContent(`[Link](${url})`);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        // Implementation should validate against internal/metadata URLs\r\n        expect(result.success).toBe(true);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Content Security Policy Compliance', () => {\r\n    it('should generate CSP-compliant output', () => {\r\n      const htmlContent = `<div>\r\n        <p>Safe content</p>\r\n        <img src=\"https://example.com/image.jpg\" alt=\"Image\">\r\n        <a href=\"https://example.com\">Link</a>\r\n      </div>`;\r\n      \r\n      const result = parseContent(htmlContent, { contentType: 'html' });\r\n      testHelpers.expectValidResult(result);\r\n      \r\n      const resultString = JSON.stringify(result.blocks);\r\n      \r\n      // Should not contain inline styles or scripts\r\n      expect(resultString).not.toMatch(/style\\s*=/i);\r\n      expect(resultString).not.toMatch(/on\\w+\\s*=/i);\r\n      expect(resultString).not.toContain('<script');\r\n    });\r\n\r\n    it('should handle data URLs safely', () => {\r\n      const dataUrls = [\r\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==',\r\n        'data:text/plain;charset=utf-8,Hello%20World',\r\n        'data:application/json,{\"test\":true}'\r\n      ];\r\n      \r\n      dataUrls.forEach(url => {\r\n        const result = parseContent(`![Image](${url})`);\r\n        testHelpers.expectValidResult(result);\r\n        \r\n        // Data URLs should be handled according to security policy\r\n        expect(result.success).toBe(true);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Rate Limiting and Resource Protection', () => {\r\n    it('should handle rapid parsing requests', () => {\r\n      const requests = Array(100).fill('Test content');\r\n      \r\n      const startTime = Date.now();\r\n      const results = requests.map(content => parseContent(content));\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(results).toHaveLength(100);\r\n      expect(results.every(r => r.success)).toBe(true);\r\n      expect(processingTime).toBeLessThan(1000); // Should be efficient\r\n    });\r\n\r\n    it('should prevent resource exhaustion with complex regex', () => {\r\n      const complexContent = '(' + 'a'.repeat(1000) + ')*b';\r\n      \r\n      const startTime = Date.now();\r\n      const result = parseContent(complexContent);\r\n      const processingTime = Date.now() - startTime;\r\n      \r\n      expect(processingTime).toBeLessThan(1000); // Should not cause ReDoS\r\n      expect(result.success).toBeDefined();\r\n    });\r\n  });\r\n});"],"version":3}