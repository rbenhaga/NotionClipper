{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\security\\ContentSanitizer.ts","mappings":"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","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\security\\ContentSanitizer.ts"],"sourcesContent":["/**\r\n * ContentSanitizer - Sécurité pour le Cahier des Charges v2.1\r\n * Sanitise le contenu malveillant (XSS, injection, etc.)\r\n */\r\n\r\nexport class ContentSanitizer {\r\n  private static readonly DANGEROUS_PROTOCOLS = [\r\n    'javascript:',\r\n    'vbscript:',\r\n    'data:text/html',\r\n    'data:application/javascript'\r\n  ];\r\n\r\n  private static readonly DANGEROUS_TAGS = [\r\n    '<script',\r\n    '</script>',\r\n    '<iframe',\r\n    '</iframe>',\r\n    '<object',\r\n    '</object>',\r\n    '<embed',\r\n    '</embed>'\r\n  ];\r\n\r\n  private static readonly DANGEROUS_ATTRIBUTES = [\r\n    'onclick',\r\n    'onload',\r\n    'onerror',\r\n    'onmouseover',\r\n    'onfocus',\r\n    'onblur',\r\n    'onchange',\r\n    'onsubmit'\r\n  ];\r\n\r\n  private static readonly FORMULA_PREFIXES = [\r\n    '=',\r\n    '+',\r\n    '-',\r\n    '@'\r\n  ];\r\n\r\n  /**\r\n   * Sanitise le contenu texte\r\n   */\r\n  static sanitizeText(text: string): string {\r\n    if (!text || typeof text !== 'string') {\r\n      return '';\r\n    }\r\n\r\n    let sanitized = text;\r\n\r\n    // Supprimer les balises dangereuses (plus agressif)\r\n    this.DANGEROUS_TAGS.forEach(tag => {\r\n      const regex = new RegExp(tag.replace('<', '\\\\<').replace('>', '\\\\>'), 'gi');\r\n      sanitized = sanitized.replace(regex, '');\r\n    });\r\n\r\n    // Supprimer les attributs dangereux (plus agressif)\r\n    this.DANGEROUS_ATTRIBUTES.forEach(attr => {\r\n      const regex = new RegExp(`${attr}\\\\s*=\\\\s*[\"'][^\"']*[\"']`, 'gi');\r\n      sanitized = sanitized.replace(regex, '');\r\n      // Aussi sans quotes\r\n      const regex2 = new RegExp(`${attr}\\\\s*=\\\\s*[^\\\\s>]*`, 'gi');\r\n      sanitized = sanitized.replace(regex2, '');\r\n    });\r\n\r\n    // Supprimer les caractères de contrôle\r\n    sanitized = sanitized.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\r\n\r\n    // Supprimer les balises HTML complètes\r\n    sanitized = sanitized.replace(/<[^>]*>/g, '');\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  /**\r\n   * Sanitise une URL\r\n   */\r\n  static sanitizeUrl(url: string): string {\r\n    if (!url || typeof url !== 'string') {\r\n      return '';\r\n    }\r\n\r\n    const lowerUrl = url.toLowerCase();\r\n\r\n    // Bloquer les protocoles dangereux\r\n    for (const protocol of this.DANGEROUS_PROTOCOLS) {\r\n      if (lowerUrl.startsWith(protocol)) {\r\n        return ''; // URL bloquée\r\n      }\r\n    }\r\n\r\n    // Valider que c'est une URL HTTP/HTTPS valide\r\n    try {\r\n      const urlObj = new URL(url);\r\n      if (urlObj.protocol !== 'http:' && urlObj.protocol !== 'https:') {\r\n        return '';\r\n      }\r\n      return url;\r\n    } catch {\r\n      return ''; // URL invalide\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sanitise le contenu d'une cellule de table (protection CSV injection)\r\n   */\r\n  static sanitizeTableCell(cell: string): string {\r\n    if (!cell || typeof cell !== 'string') {\r\n      return '';\r\n    }\r\n\r\n    let sanitized = this.sanitizeText(cell);\r\n\r\n    // Supprimer les préfixes de formule dangereux\r\n    if (this.FORMULA_PREFIXES.some(prefix => sanitized.startsWith(prefix))) {\r\n      sanitized = sanitized.substring(1); // Supprimer le premier caractère\r\n    }\r\n\r\n    // Supprimer les commandes dangereuses\r\n    const dangerousCommands = ['cmd', 'calc', 'HYPERLINK', 'SUM', 'EXEC'];\r\n    dangerousCommands.forEach(cmd => {\r\n      const regex = new RegExp(cmd, 'gi');\r\n      sanitized = sanitized.replace(regex, '');\r\n    });\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  /**\r\n   * Sanitise le contenu complet (utilisé par les parsers)\r\n   */\r\n  static sanitizeContent(content: string): string {\r\n    if (!content || typeof content !== 'string') {\r\n      return '';\r\n    }\r\n\r\n    let sanitized = content;\r\n\r\n    // Sanitisation générale du texte\r\n    sanitized = this.sanitizeText(sanitized);\r\n\r\n    // Normalisation Unicode pour éviter les bypasses\r\n    sanitized = sanitized.normalize('NFC');\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  /**\r\n   * Vérifie si une URL est sûre\r\n   */\r\n  static isUrlSafe(url: string): boolean {\r\n    return this.sanitizeUrl(url) === url;\r\n  }\r\n\r\n  /**\r\n   * Vérifie si le contenu contient des éléments dangereux\r\n   */\r\n  static containsDangerousContent(content: string): boolean {\r\n    if (!content || typeof content !== 'string') {\r\n      return false;\r\n    }\r\n\r\n    const lowerContent = content.toLowerCase();\r\n\r\n    // Vérifier les balises dangereuses\r\n    if (this.DANGEROUS_TAGS.some(tag => lowerContent.includes(tag))) {\r\n      return true;\r\n    }\r\n\r\n    // Vérifier les attributs dangereux\r\n    if (this.DANGEROUS_ATTRIBUTES.some(attr => lowerContent.includes(attr))) {\r\n      return true;\r\n    }\r\n\r\n    // Vérifier les protocoles dangereux\r\n    if (this.DANGEROUS_PROTOCOLS.some(protocol => lowerContent.includes(protocol))) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n}"],"version":3}