77bda86700f6840aead4c03edd75c70a
"use strict";
/**
 * Configuration Jest pour les tests - Cahier des Charges v2.1 ⭐
 * Inclut des matchers personnalisés et configuration avancée
 */
Object.defineProperty(exports, "__esModule", { value: true });
const test_helpers_1 = require("./helpers/test-helpers");
// Constantes conformes au Cahier des Charges v2.1
const PERFORMANCE_BENCHMARKS = {
    DETECTION_1000_LINES: 5, // <5ms (P50)
    PARSE_MARKDOWN_1000: 30, // <30ms (P50)
    PARSE_CODE_1000: 20, // <20ms (P50)
    PARSE_TABLE_100_ROWS: 15, // <15ms (P50)
    PARSE_AUDIO_URL: 1, // <1ms (P50)
    CONVERT_100_BLOCKS: 20, // <20ms (P50)
    VALIDATE_100_BLOCKS: 10, // <10ms (P50)
    PIPELINE_TOTAL_1000: 80, // <80ms (P50)
    FILE_UPLOAD_5MB: 2000, // <2s (P50)
    // Timeout global pour les tests
    TEST_TIMEOUT: 30000
};
// Configuration des timeouts
jest.setTimeout(PERFORMANCE_BENCHMARKS.TEST_TIMEOUT);
// Mock console pour les tests
const originalConsole = console;
beforeAll(() => {
    // Silencer les logs pendant les tests sauf si DEBUG=true
    if (!process.env.DEBUG) {
        global.console = {
            ...console,
            log: jest.fn(),
            debug: jest.fn(),
            info: jest.fn(),
            warn: jest.fn(),
            error: originalConsole.error // Garder les erreurs
        };
    }
    // Initialiser les helpers globaux
    global.testHelpers = test_helpers_1.testHelpers;
    global.PERFORMANCE_BENCHMARKS = PERFORMANCE_BENCHMARKS;
});
afterAll(() => {
    global.console = originalConsole;
});
// Matchers personnalisés étendus
expect.extend({
    ...test_helpers_1.customMatchers,
    // Matcher pour les seuils de performance
    toBeWithinPerformanceThreshold(received, threshold) {
        const pass = received <= threshold;
        if (pass) {
            return {
                message: () => `Expected ${received}ms to exceed performance threshold ${threshold}ms`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected ${received}ms to be within performance threshold ${threshold}ms`,
                pass: false,
            };
        }
    },
    // Matcher pour valider la structure des blocs Notion
    toHaveValidNotionBlockStructure(received) {
        const isValid = received &&
            typeof received === 'object' &&
            typeof received.type === 'string' &&
            received.type.length > 0;
        if (isValid) {
            return {
                message: () => `Expected block to have invalid Notion structure`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected block to have valid Notion structure with type property`,
                pass: false,
            };
        }
    },
    // Matcher pour les blocs audio (⭐ NOUVEAU v2.1)
    toHaveAudioBlock(received) {
        const hasAudioBlock = received.some(block => block.type === 'audio' &&
            block.audio &&
            block.audio.type === 'external' &&
            block.audio.external &&
            block.audio.external.url);
        if (hasAudioBlock) {
            return {
                message: () => `Expected blocks to not contain audio block`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected blocks to contain at least one valid audio block`,
                pass: false,
            };
        }
    },
    // Matcher pour les tables avec headers (⭐ NOUVEAU v2.1)
    toHaveTableWithHeaders(received) {
        const hasTableWithHeaders = received.some(block => block.type === 'table' &&
            block.table &&
            (block.table.has_column_header === true || block.table.has_row_header === true));
        if (hasTableWithHeaders) {
            return {
                message: () => `Expected blocks to not contain table with headers`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected blocks to contain at least one table with headers`,
                pass: false,
            };
        }
    },
    // Matcher pour les toggle headings (⭐ NOUVEAU v2.1)
    toHaveToggleHeading(received) {
        const hasToggleHeading = received.some(block => block.type &&
            block.type.startsWith('heading_') &&
            block[block.type] &&
            block[block.type].is_toggleable === true);
        if (hasToggleHeading) {
            return {
                message: () => `Expected blocks to not contain toggle heading`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected blocks to contain at least one toggle heading`,
                pass: false,
            };
        }
    },
    // Matcher pour valider les URLs audio
    toBeValidAudioUrl(received) {
        const audioExtensions = ['mp3', 'wav', 'ogg', 'oga', 'm4a', 'aac', 'flac', 'webm'];
        const urlPattern = /^https?:\/\/[^\s<>"{}|\\^`[\]]+$/;
        const isValidUrl = urlPattern.test(received);
        const hasAudioExtension = audioExtensions.some(ext => received.toLowerCase().endsWith(`.${ext}`));
        const isValid = isValidUrl && hasAudioExtension;
        if (isValid) {
            return {
                message: () => `Expected ${received} to not be a valid audio URL`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected ${received} to be a valid audio URL with supported extension`,
                pass: false,
            };
        }
    },
    // Matcher pour valider le rich text
    toHaveValidRichText(received) {
        const isValidRichText = Array.isArray(received) &&
            received.every(segment => segment &&
                typeof segment === 'object' &&
                segment.type &&
                segment.text &&
                segment.annotations &&
                typeof segment.plain_text === 'string');
        if (isValidRichText) {
            return {
                message: () => `Expected rich text to be invalid`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `Expected valid rich text array with proper structure`,
                pass: false,
            };
        }
    }
});
// Mock global pour fetch si nécessaire
if (!global.fetch) {
    global.fetch = jest.fn();
}
// Mock pour performance.now si pas disponible
if (!global.performance) {
    global.performance = {
        now: jest.fn(() => Date.now())
    };
}
// Configuration pour les tests de performance
const originalSetTimeout = global.setTimeout;
const originalSetInterval = global.setInterval;
beforeEach(() => {
    // Reset des mocks avant chaque test
    jest.clearAllMocks();
    // Mock console.time et console.timeEnd pour les tests de performance
    jest.spyOn(console, 'time').mockImplementation(() => { });
    jest.spyOn(console, 'timeEnd').mockImplementation(() => { });
});
afterEach(() => {
    // Nettoyage après chaque test
    jest.restoreAllMocks();
});
// Gestion des erreurs non capturées
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
// Configuration des variables d'environnement pour les tests
process.env.NODE_ENV = 'test';
// ⭐ Utilitaires de test globaux pour v2.1
global.testUtils = {
    // Générateur de contenu de test
    generateTestContent: (type, size = 'small') => {
        const sizes = {
            small: 10,
            medium: 100,
            large: 1000
        };
        const count = sizes[size];
        switch (type) {
            case 'markdown':
                return Array(count).fill(0).map((_, i) => `# Header ${i}\n\nParagraph ${i} with **bold** text.`).join('\n\n');
            case 'audio':
                return Array(count).fill(0).map((_, i) => `https://example.com/audio${i}.mp3`).join('\n');
            case 'table':
                const rows = Array(count).fill(0).map((_, i) => `Row${i},Value${i},Data${i}`);
                return `Header1,Header2,Header3\n${rows.join('\n')}`;
            case 'toggle':
                return Array(count).fill(0).map((_, i) => `> # Toggle ${i}\n> Content for toggle ${i}`).join('\n\n');
            default:
                return Array(count).fill(0).map((_, i) => `Line ${i} of test content`).join('\n');
        }
    },
    // Mesure de performance
    measurePerformance: (fn) => {
        const startMemory = process.memoryUsage();
        const startTime = Date.now();
        const result = fn();
        const endTime = Date.now();
        const endMemory = process.memoryUsage();
        return {
            result,
            duration: endTime - startTime,
            memory: {
                start: startMemory,
                end: endMemory,
                delta: endMemory.heapUsed - startMemory.heapUsed
            }
        };
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHNldHVwLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgseURBQXFFO0FBRXJFLGtEQUFrRDtBQUNsRCxNQUFNLHNCQUFzQixHQUFHO0lBQzdCLG9CQUFvQixFQUFFLENBQUMsRUFBTyxhQUFhO0lBQzNDLG1CQUFtQixFQUFFLEVBQUUsRUFBTyxjQUFjO0lBQzVDLGVBQWUsRUFBRSxFQUFFLEVBQVcsY0FBYztJQUM1QyxvQkFBb0IsRUFBRSxFQUFFLEVBQU0sY0FBYztJQUM1QyxlQUFlLEVBQUUsQ0FBQyxFQUFZLGFBQWE7SUFDM0Msa0JBQWtCLEVBQUUsRUFBRSxFQUFRLGNBQWM7SUFDNUMsbUJBQW1CLEVBQUUsRUFBRSxFQUFPLGNBQWM7SUFDNUMsbUJBQW1CLEVBQUUsRUFBRSxFQUFPLGNBQWM7SUFDNUMsZUFBZSxFQUFFLElBQUksRUFBUyxZQUFZO0lBRTFDLGdDQUFnQztJQUNoQyxZQUFZLEVBQUUsS0FBSztDQUNwQixDQUFDO0FBRUYsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFckQsOEJBQThCO0FBQzlCLE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQztBQUVoQyxTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ2IseURBQXlEO0lBQ3pELElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxPQUFPLEdBQUc7WUFDZixHQUFHLE9BQU87WUFDVixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNkLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixLQUFLLEVBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQyxxQkFBcUI7U0FDbkQsQ0FBQztJQUNKLENBQUM7SUFFRCxrQ0FBa0M7SUFDakMsTUFBYyxDQUFDLFdBQVcsR0FBRywwQkFBVyxDQUFDO0lBQ3pDLE1BQWMsQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsQ0FBQztBQUNsRSxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxHQUFHLEVBQUU7SUFDWixNQUFNLENBQUMsT0FBTyxHQUFHLGVBQWUsQ0FBQztBQUNuQyxDQUFDLENBQUMsQ0FBQztBQWlCSCxpQ0FBaUM7QUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNaLEdBQUcsNkJBQWM7SUFFakIseUNBQXlDO0lBQ3pDLDhCQUE4QixDQUFDLFFBQWdCLEVBQUUsU0FBaUI7UUFDaEUsTUFBTSxJQUFJLEdBQUcsUUFBUSxJQUFJLFNBQVMsQ0FBQztRQUVuQyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxRQUFRLHNDQUFzQyxTQUFTLElBQUk7Z0JBQ3RGLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztRQUNKLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxRQUFRLHlDQUF5QyxTQUFTLElBQUk7Z0JBQ3pGLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQscURBQXFEO0lBQ3JELCtCQUErQixDQUFDLFFBQWE7UUFDM0MsTUFBTSxPQUFPLEdBQUcsUUFBUTtZQUNULE9BQU8sUUFBUSxLQUFLLFFBQVE7WUFDNUIsT0FBTyxRQUFRLENBQUMsSUFBSSxLQUFLLFFBQVE7WUFDakMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBRXhDLElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxpREFBaUQ7Z0JBQ2hFLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztRQUNKLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsa0VBQWtFO2dCQUNqRixJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELGdEQUFnRDtJQUNoRCxnQkFBZ0IsQ0FBQyxRQUFlO1FBQzlCLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FDMUMsS0FBSyxDQUFDLElBQUksS0FBSyxPQUFPO1lBQ3RCLEtBQUssQ0FBQyxLQUFLO1lBQ1gsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssVUFBVTtZQUMvQixLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVE7WUFDcEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUN6QixDQUFDO1FBRUYsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyw0Q0FBNEM7Z0JBQzNELElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztRQUNKLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsMkRBQTJEO2dCQUMxRSxJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELHdEQUF3RDtJQUN4RCxzQkFBc0IsQ0FBQyxRQUFlO1FBQ3BDLE1BQU0sbUJBQW1CLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUNoRCxLQUFLLENBQUMsSUFBSSxLQUFLLE9BQU87WUFDdEIsS0FBSyxDQUFDLEtBQUs7WUFDWCxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEtBQUssSUFBSSxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsY0FBYyxLQUFLLElBQUksQ0FBQyxDQUNoRixDQUFDO1FBRUYsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1lBQ3hCLE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLG1EQUFtRDtnQkFDbEUsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFDO1FBQ0osQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyw0REFBNEQ7Z0JBQzNFLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQsb0RBQW9EO0lBQ3BELG1CQUFtQixDQUFDLFFBQWU7UUFDakMsTUFBTSxnQkFBZ0IsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQzdDLEtBQUssQ0FBQyxJQUFJO1lBQ1YsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDO1lBQ2pDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ2pCLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxLQUFLLElBQUksQ0FDekMsQ0FBQztRQUVGLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztZQUNyQixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQywrQ0FBK0M7Z0JBQzlELElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztRQUNKLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsd0RBQXdEO2dCQUN2RSxJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELHNDQUFzQztJQUN0QyxpQkFBaUIsQ0FBQyxRQUFnQjtRQUNoQyxNQUFNLGVBQWUsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNuRixNQUFNLFVBQVUsR0FBRyxrQ0FBa0MsQ0FBQztRQUV0RCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdDLE1BQU0saUJBQWlCLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUNuRCxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FDM0MsQ0FBQztRQUVGLE1BQU0sT0FBTyxHQUFHLFVBQVUsSUFBSSxpQkFBaUIsQ0FBQztRQUVoRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxRQUFRLDhCQUE4QjtnQkFDakUsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFDO1FBQ0osQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLFFBQVEsbURBQW1EO2dCQUN0RixJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELG9DQUFvQztJQUNwQyxtQkFBbUIsQ0FBQyxRQUFhO1FBQy9CLE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ3hCLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FDdkIsT0FBTztnQkFDUCxPQUFPLE9BQU8sS0FBSyxRQUFRO2dCQUMzQixPQUFPLENBQUMsSUFBSTtnQkFDWixPQUFPLENBQUMsSUFBSTtnQkFDWixPQUFPLENBQUMsV0FBVztnQkFDbkIsT0FBTyxPQUFPLENBQUMsVUFBVSxLQUFLLFFBQVEsQ0FDdkMsQ0FBQztRQUV6QixJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLGtDQUFrQztnQkFDakQsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFDO1FBQ0osQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPO2dCQUNMLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxzREFBc0Q7Z0JBQ3JFLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsdUNBQXVDO0FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbEIsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0IsQ0FBQztBQUVELDhDQUE4QztBQUM5QyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3hCLE1BQU0sQ0FBQyxXQUFXLEdBQUc7UUFDbkIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ3hCLENBQUM7QUFDWCxDQUFDO0FBRUQsOENBQThDO0FBQzlDLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztBQUM3QyxNQUFNLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7QUFFL0MsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLG9DQUFvQztJQUNwQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFFckIscUVBQXFFO0lBQ3JFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3pELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzlELENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtJQUNiLDhCQUE4QjtJQUM5QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxvQ0FBb0M7QUFDcEMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNuRCxPQUFPLENBQUMsS0FBSyxDQUFDLHlCQUF5QixFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdkUsQ0FBQyxDQUFDLENBQUM7QUFFSCw2REFBNkQ7QUFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBRTlCLDBDQUEwQztBQUMxQyxNQUFNLENBQUMsU0FBUyxHQUFHO0lBQ2pCLGdDQUFnQztJQUNoQyxtQkFBbUIsRUFBRSxDQUFDLElBQVksRUFBRSxPQUFxQyxPQUFPLEVBQUUsRUFBRTtRQUNsRixNQUFNLEtBQUssR0FBRztZQUNaLEtBQUssRUFBRSxFQUFFO1lBQ1QsTUFBTSxFQUFFLEdBQUc7WUFDWCxLQUFLLEVBQUUsSUFBSTtTQUNaLENBQUM7UUFFRixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFMUIsUUFBUSxJQUFJLEVBQUUsQ0FBQztZQUNiLEtBQUssVUFBVTtnQkFDYixPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQ3ZDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBc0IsQ0FDdEQsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFakIsS0FBSyxPQUFPO2dCQUNWLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDdkMsNEJBQTRCLENBQUMsTUFBTSxDQUNwQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVmLEtBQUssT0FBTztnQkFDVixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUM3QyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQzdCLENBQUM7Z0JBQ0YsT0FBTyw0QkFBNEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBRXZELEtBQUssUUFBUTtnQkFDWCxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQ3ZDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxFQUFFLENBQzdDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRWpCO2dCQUNFLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDdkMsUUFBUSxDQUFDLGtCQUFrQixDQUM1QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQixDQUFDO0lBQ0gsQ0FBQztJQUVELHdCQUF3QjtJQUN4QixrQkFBa0IsRUFBRSxDQUFJLEVBQVcsRUFBZ0QsRUFBRTtRQUNuRixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDMUMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTdCLE1BQU0sTUFBTSxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBRXBCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMzQixNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFeEMsT0FBTztZQUNMLE1BQU07WUFDTixRQUFRLEVBQUUsT0FBTyxHQUFHLFNBQVM7WUFDN0IsTUFBTSxFQUFFO2dCQUNOLEtBQUssRUFBRSxXQUFXO2dCQUNsQixHQUFHLEVBQUUsU0FBUztnQkFDZCxLQUFLLEVBQUUsU0FBUyxDQUFDLFFBQVEsR0FBRyxXQUFXLENBQUMsUUFBUTthQUNqRDtTQUNGLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHJheWFuXFxEZXNrdG9wXFxEZXZcXE5vdGlvbkNsaXBwZXJcXHBhY2thZ2VzXFxub3Rpb24tcGFyc2VyXFx0ZXN0c1xcc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbmZpZ3VyYXRpb24gSmVzdCBwb3VyIGxlcyB0ZXN0cyAtIENhaGllciBkZXMgQ2hhcmdlcyB2Mi4xIOKtkFxyXG4gKiBJbmNsdXQgZGVzIG1hdGNoZXJzIHBlcnNvbm5hbGlzw6lzIGV0IGNvbmZpZ3VyYXRpb24gYXZhbmPDqWVcclxuICovXHJcblxyXG5pbXBvcnQgeyBjdXN0b21NYXRjaGVycywgdGVzdEhlbHBlcnMgfSBmcm9tICcuL2hlbHBlcnMvdGVzdC1oZWxwZXJzJztcclxuXHJcbi8vIENvbnN0YW50ZXMgY29uZm9ybWVzIGF1IENhaGllciBkZXMgQ2hhcmdlcyB2Mi4xXHJcbmNvbnN0IFBFUkZPUk1BTkNFX0JFTkNITUFSS1MgPSB7XHJcbiAgREVURUNUSU9OXzEwMDBfTElORVM6IDUsICAgICAgLy8gPDVtcyAoUDUwKVxyXG4gIFBBUlNFX01BUktET1dOXzEwMDA6IDMwLCAgICAgIC8vIDwzMG1zIChQNTApXHJcbiAgUEFSU0VfQ09ERV8xMDAwOiAyMCwgICAgICAgICAgLy8gPDIwbXMgKFA1MClcclxuICBQQVJTRV9UQUJMRV8xMDBfUk9XUzogMTUsICAgICAvLyA8MTVtcyAoUDUwKVxyXG4gIFBBUlNFX0FVRElPX1VSTDogMSwgICAgICAgICAgIC8vIDwxbXMgKFA1MClcclxuICBDT05WRVJUXzEwMF9CTE9DS1M6IDIwLCAgICAgICAvLyA8MjBtcyAoUDUwKVxyXG4gIFZBTElEQVRFXzEwMF9CTE9DS1M6IDEwLCAgICAgIC8vIDwxMG1zIChQNTApXHJcbiAgUElQRUxJTkVfVE9UQUxfMTAwMDogODAsICAgICAgLy8gPDgwbXMgKFA1MClcclxuICBGSUxFX1VQTE9BRF81TUI6IDIwMDAsICAgICAgICAvLyA8MnMgKFA1MClcclxuICBcclxuICAvLyBUaW1lb3V0IGdsb2JhbCBwb3VyIGxlcyB0ZXN0c1xyXG4gIFRFU1RfVElNRU9VVDogMzAwMDBcclxufTtcclxuXHJcbi8vIENvbmZpZ3VyYXRpb24gZGVzIHRpbWVvdXRzXHJcbmplc3Quc2V0VGltZW91dChQRVJGT1JNQU5DRV9CRU5DSE1BUktTLlRFU1RfVElNRU9VVCk7XHJcblxyXG4vLyBNb2NrIGNvbnNvbGUgcG91ciBsZXMgdGVzdHNcclxuY29uc3Qgb3JpZ2luYWxDb25zb2xlID0gY29uc29sZTtcclxuXHJcbmJlZm9yZUFsbCgoKSA9PiB7XHJcbiAgLy8gU2lsZW5jZXIgbGVzIGxvZ3MgcGVuZGFudCBsZXMgdGVzdHMgc2F1ZiBzaSBERUJVRz10cnVlXHJcbiAgaWYgKCFwcm9jZXNzLmVudi5ERUJVRykge1xyXG4gICAgZ2xvYmFsLmNvbnNvbGUgPSB7XHJcbiAgICAgIC4uLmNvbnNvbGUsXHJcbiAgICAgIGxvZzogamVzdC5mbigpLFxyXG4gICAgICBkZWJ1ZzogamVzdC5mbigpLFxyXG4gICAgICBpbmZvOiBqZXN0LmZuKCksXHJcbiAgICAgIHdhcm46IGplc3QuZm4oKSxcclxuICAgICAgZXJyb3I6IG9yaWdpbmFsQ29uc29sZS5lcnJvciAvLyBHYXJkZXIgbGVzIGVycmV1cnNcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBJbml0aWFsaXNlciBsZXMgaGVscGVycyBnbG9iYXV4XHJcbiAgKGdsb2JhbCBhcyBhbnkpLnRlc3RIZWxwZXJzID0gdGVzdEhlbHBlcnM7XHJcbiAgKGdsb2JhbCBhcyBhbnkpLlBFUkZPUk1BTkNFX0JFTkNITUFSS1MgPSBQRVJGT1JNQU5DRV9CRU5DSE1BUktTO1xyXG59KTtcclxuXHJcbmFmdGVyQWxsKCgpID0+IHtcclxuICBnbG9iYWwuY29uc29sZSA9IG9yaWdpbmFsQ29uc29sZTtcclxufSk7XHJcblxyXG4vLyDirZAgTWF0Y2hlcnMgcGVyc29ubmFsaXPDqXMgcG91ciBsZSBDYWhpZXIgZGVzIENoYXJnZXMgdjIuMVxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgbmFtZXNwYWNlIGplc3Qge1xyXG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcclxuICAgICAgdG9CZVdpdGhpblBlcmZvcm1hbmNlVGhyZXNob2xkKHRocmVzaG9sZDogbnVtYmVyKTogUjtcclxuICAgICAgdG9IYXZlVmFsaWROb3Rpb25CbG9ja1N0cnVjdHVyZSgpOiBSO1xyXG4gICAgICB0b0hhdmVBdWRpb0Jsb2NrKCk6IFI7XHJcbiAgICAgIHRvSGF2ZVRhYmxlV2l0aEhlYWRlcnMoKTogUjtcclxuICAgICAgdG9IYXZlVG9nZ2xlSGVhZGluZygpOiBSO1xyXG4gICAgICB0b0JlVmFsaWRBdWRpb1VybCgpOiBSO1xyXG4gICAgICB0b0hhdmVWYWxpZFJpY2hUZXh0KCk6IFI7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBNYXRjaGVycyBwZXJzb25uYWxpc8OpcyDDqXRlbmR1c1xyXG5leHBlY3QuZXh0ZW5kKHtcclxuICAuLi5jdXN0b21NYXRjaGVycyxcclxuICBcclxuICAvLyBNYXRjaGVyIHBvdXIgbGVzIHNldWlscyBkZSBwZXJmb3JtYW5jZVxyXG4gIHRvQmVXaXRoaW5QZXJmb3JtYW5jZVRocmVzaG9sZChyZWNlaXZlZDogbnVtYmVyLCB0aHJlc2hvbGQ6IG51bWJlcikge1xyXG4gICAgY29uc3QgcGFzcyA9IHJlY2VpdmVkIDw9IHRocmVzaG9sZDtcclxuICAgIFxyXG4gICAgaWYgKHBhc3MpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgJHtyZWNlaXZlZH1tcyB0byBleGNlZWQgcGVyZm9ybWFuY2UgdGhyZXNob2xkICR7dGhyZXNob2xkfW1zYCxcclxuICAgICAgICBwYXNzOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgJHtyZWNlaXZlZH1tcyB0byBiZSB3aXRoaW4gcGVyZm9ybWFuY2UgdGhyZXNob2xkICR7dGhyZXNob2xkfW1zYCxcclxuICAgICAgICBwYXNzOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8vIE1hdGNoZXIgcG91ciB2YWxpZGVyIGxhIHN0cnVjdHVyZSBkZXMgYmxvY3MgTm90aW9uXHJcbiAgdG9IYXZlVmFsaWROb3Rpb25CbG9ja1N0cnVjdHVyZShyZWNlaXZlZDogYW55KSB7XHJcbiAgICBjb25zdCBpc1ZhbGlkID0gcmVjZWl2ZWQgJiYgXHJcbiAgICAgICAgICAgICAgICAgICB0eXBlb2YgcmVjZWl2ZWQgPT09ICdvYmplY3QnICYmXHJcbiAgICAgICAgICAgICAgICAgICB0eXBlb2YgcmVjZWl2ZWQudHlwZSA9PT0gJ3N0cmluZycgJiZcclxuICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkLnR5cGUubGVuZ3RoID4gMDtcclxuICAgIFxyXG4gICAgaWYgKGlzVmFsaWQpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgYmxvY2sgdG8gaGF2ZSBpbnZhbGlkIE5vdGlvbiBzdHJ1Y3R1cmVgLFxyXG4gICAgICAgIHBhc3M6IHRydWUsXHJcbiAgICAgIH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCBibG9jayB0byBoYXZlIHZhbGlkIE5vdGlvbiBzdHJ1Y3R1cmUgd2l0aCB0eXBlIHByb3BlcnR5YCxcclxuICAgICAgICBwYXNzOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8vIE1hdGNoZXIgcG91ciBsZXMgYmxvY3MgYXVkaW8gKOKtkCBOT1VWRUFVIHYyLjEpXHJcbiAgdG9IYXZlQXVkaW9CbG9jayhyZWNlaXZlZDogYW55W10pIHtcclxuICAgIGNvbnN0IGhhc0F1ZGlvQmxvY2sgPSByZWNlaXZlZC5zb21lKGJsb2NrID0+IFxyXG4gICAgICBibG9jay50eXBlID09PSAnYXVkaW8nICYmIFxyXG4gICAgICBibG9jay5hdWRpbyAmJlxyXG4gICAgICBibG9jay5hdWRpby50eXBlID09PSAnZXh0ZXJuYWwnICYmXHJcbiAgICAgIGJsb2NrLmF1ZGlvLmV4dGVybmFsICYmXHJcbiAgICAgIGJsb2NrLmF1ZGlvLmV4dGVybmFsLnVybFxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgaWYgKGhhc0F1ZGlvQmxvY2spIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgYmxvY2tzIHRvIG5vdCBjb250YWluIGF1ZGlvIGJsb2NrYCxcclxuICAgICAgICBwYXNzOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgYmxvY2tzIHRvIGNvbnRhaW4gYXQgbGVhc3Qgb25lIHZhbGlkIGF1ZGlvIGJsb2NrYCxcclxuICAgICAgICBwYXNzOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8vIE1hdGNoZXIgcG91ciBsZXMgdGFibGVzIGF2ZWMgaGVhZGVycyAo4q2QIE5PVVZFQVUgdjIuMSlcclxuICB0b0hhdmVUYWJsZVdpdGhIZWFkZXJzKHJlY2VpdmVkOiBhbnlbXSkge1xyXG4gICAgY29uc3QgaGFzVGFibGVXaXRoSGVhZGVycyA9IHJlY2VpdmVkLnNvbWUoYmxvY2sgPT4gXHJcbiAgICAgIGJsb2NrLnR5cGUgPT09ICd0YWJsZScgJiYgXHJcbiAgICAgIGJsb2NrLnRhYmxlICYmXHJcbiAgICAgIChibG9jay50YWJsZS5oYXNfY29sdW1uX2hlYWRlciA9PT0gdHJ1ZSB8fCBibG9jay50YWJsZS5oYXNfcm93X2hlYWRlciA9PT0gdHJ1ZSlcclxuICAgICk7XHJcbiAgICBcclxuICAgIGlmIChoYXNUYWJsZVdpdGhIZWFkZXJzKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkIGJsb2NrcyB0byBub3QgY29udGFpbiB0YWJsZSB3aXRoIGhlYWRlcnNgLFxyXG4gICAgICAgIHBhc3M6IHRydWUsXHJcbiAgICAgIH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBFeHBlY3RlZCBibG9ja3MgdG8gY29udGFpbiBhdCBsZWFzdCBvbmUgdGFibGUgd2l0aCBoZWFkZXJzYCxcclxuICAgICAgICBwYXNzOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8vIE1hdGNoZXIgcG91ciBsZXMgdG9nZ2xlIGhlYWRpbmdzICjirZAgTk9VVkVBVSB2Mi4xKVxyXG4gIHRvSGF2ZVRvZ2dsZUhlYWRpbmcocmVjZWl2ZWQ6IGFueVtdKSB7XHJcbiAgICBjb25zdCBoYXNUb2dnbGVIZWFkaW5nID0gcmVjZWl2ZWQuc29tZShibG9jayA9PiBcclxuICAgICAgYmxvY2sudHlwZSAmJiBcclxuICAgICAgYmxvY2sudHlwZS5zdGFydHNXaXRoKCdoZWFkaW5nXycpICYmXHJcbiAgICAgIGJsb2NrW2Jsb2NrLnR5cGVdICYmXHJcbiAgICAgIGJsb2NrW2Jsb2NrLnR5cGVdLmlzX3RvZ2dsZWFibGUgPT09IHRydWVcclxuICAgICk7XHJcbiAgICBcclxuICAgIGlmIChoYXNUb2dnbGVIZWFkaW5nKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkIGJsb2NrcyB0byBub3QgY29udGFpbiB0b2dnbGUgaGVhZGluZ2AsXHJcbiAgICAgICAgcGFzczogdHJ1ZSxcclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkIGJsb2NrcyB0byBjb250YWluIGF0IGxlYXN0IG9uZSB0b2dnbGUgaGVhZGluZ2AsXHJcbiAgICAgICAgcGFzczogZmFsc2UsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvLyBNYXRjaGVyIHBvdXIgdmFsaWRlciBsZXMgVVJMcyBhdWRpb1xyXG4gIHRvQmVWYWxpZEF1ZGlvVXJsKHJlY2VpdmVkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGF1ZGlvRXh0ZW5zaW9ucyA9IFsnbXAzJywgJ3dhdicsICdvZ2cnLCAnb2dhJywgJ200YScsICdhYWMnLCAnZmxhYycsICd3ZWJtJ107XHJcbiAgICBjb25zdCB1cmxQYXR0ZXJuID0gL15odHRwcz86XFwvXFwvW15cXHM8Plwie318XFxcXF5gW1xcXV0rJC87XHJcbiAgICBcclxuICAgIGNvbnN0IGlzVmFsaWRVcmwgPSB1cmxQYXR0ZXJuLnRlc3QocmVjZWl2ZWQpO1xyXG4gICAgY29uc3QgaGFzQXVkaW9FeHRlbnNpb24gPSBhdWRpb0V4dGVuc2lvbnMuc29tZShleHQgPT4gXHJcbiAgICAgIHJlY2VpdmVkLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoYC4ke2V4dH1gKVxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgY29uc3QgaXNWYWxpZCA9IGlzVmFsaWRVcmwgJiYgaGFzQXVkaW9FeHRlbnNpb247XHJcbiAgICBcclxuICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIG5vdCBiZSBhIHZhbGlkIGF1ZGlvIFVSTGAsXHJcbiAgICAgICAgcGFzczogdHJ1ZSxcclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGJlIGEgdmFsaWQgYXVkaW8gVVJMIHdpdGggc3VwcG9ydGVkIGV4dGVuc2lvbmAsXHJcbiAgICAgICAgcGFzczogZmFsc2UsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvLyBNYXRjaGVyIHBvdXIgdmFsaWRlciBsZSByaWNoIHRleHRcclxuICB0b0hhdmVWYWxpZFJpY2hUZXh0KHJlY2VpdmVkOiBhbnkpIHtcclxuICAgIGNvbnN0IGlzVmFsaWRSaWNoVGV4dCA9IEFycmF5LmlzQXJyYXkocmVjZWl2ZWQpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkLmV2ZXJ5KHNlZ21lbnQgPT4gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBzZWdtZW50ID09PSAnb2JqZWN0JyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQudHlwZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQudGV4dCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQuYW5ub3RhdGlvbnMgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygc2VnbWVudC5wbGFpbl90ZXh0ID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgXHJcbiAgICBpZiAoaXNWYWxpZFJpY2hUZXh0KSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYEV4cGVjdGVkIHJpY2ggdGV4dCB0byBiZSBpbnZhbGlkYCxcclxuICAgICAgICBwYXNzOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgRXhwZWN0ZWQgdmFsaWQgcmljaCB0ZXh0IGFycmF5IHdpdGggcHJvcGVyIHN0cnVjdHVyZWAsXHJcbiAgICAgICAgcGFzczogZmFsc2UsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIE1vY2sgZ2xvYmFsIHBvdXIgZmV0Y2ggc2kgbsOpY2Vzc2FpcmVcclxuaWYgKCFnbG9iYWwuZmV0Y2gpIHtcclxuICBnbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCk7XHJcbn1cclxuXHJcbi8vIE1vY2sgcG91ciBwZXJmb3JtYW5jZS5ub3cgc2kgcGFzIGRpc3BvbmlibGVcclxuaWYgKCFnbG9iYWwucGVyZm9ybWFuY2UpIHtcclxuICBnbG9iYWwucGVyZm9ybWFuY2UgPSB7XHJcbiAgICBub3c6IGplc3QuZm4oKCkgPT4gRGF0ZS5ub3coKSlcclxuICB9IGFzIGFueTtcclxufVxyXG5cclxuLy8gQ29uZmlndXJhdGlvbiBwb3VyIGxlcyB0ZXN0cyBkZSBwZXJmb3JtYW5jZVxyXG5jb25zdCBvcmlnaW5hbFNldFRpbWVvdXQgPSBnbG9iYWwuc2V0VGltZW91dDtcclxuY29uc3Qgb3JpZ2luYWxTZXRJbnRlcnZhbCA9IGdsb2JhbC5zZXRJbnRlcnZhbDtcclxuXHJcbmJlZm9yZUVhY2goKCkgPT4ge1xyXG4gIC8vIFJlc2V0IGRlcyBtb2NrcyBhdmFudCBjaGFxdWUgdGVzdFxyXG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIFxyXG4gIC8vIE1vY2sgY29uc29sZS50aW1lIGV0IGNvbnNvbGUudGltZUVuZCBwb3VyIGxlcyB0ZXN0cyBkZSBwZXJmb3JtYW5jZVxyXG4gIGplc3Quc3B5T24oY29uc29sZSwgJ3RpbWUnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gIGplc3Quc3B5T24oY29uc29sZSwgJ3RpbWVFbmQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG59KTtcclxuXHJcbmFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgLy8gTmV0dG95YWdlIGFwcsOocyBjaGFxdWUgdGVzdFxyXG4gIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XHJcbn0pO1xyXG5cclxuLy8gR2VzdGlvbiBkZXMgZXJyZXVycyBub24gY2FwdHVyw6llc1xyXG5wcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7XHJcbiAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XHJcbn0pO1xyXG5cclxuLy8gQ29uZmlndXJhdGlvbiBkZXMgdmFyaWFibGVzIGQnZW52aXJvbm5lbWVudCBwb3VyIGxlcyB0ZXN0c1xyXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcclxuXHJcbi8vIOKtkCBVdGlsaXRhaXJlcyBkZSB0ZXN0IGdsb2JhdXggcG91ciB2Mi4xXHJcbmdsb2JhbC50ZXN0VXRpbHMgPSB7XHJcbiAgLy8gR8OpbsOpcmF0ZXVyIGRlIGNvbnRlbnUgZGUgdGVzdFxyXG4gIGdlbmVyYXRlVGVzdENvbnRlbnQ6ICh0eXBlOiBzdHJpbmcsIHNpemU6ICdzbWFsbCcgfCAnbWVkaXVtJyB8ICdsYXJnZScgPSAnc21hbGwnKSA9PiB7XHJcbiAgICBjb25zdCBzaXplcyA9IHtcclxuICAgICAgc21hbGw6IDEwLFxyXG4gICAgICBtZWRpdW06IDEwMCxcclxuICAgICAgbGFyZ2U6IDEwMDBcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IGNvdW50ID0gc2l6ZXNbc2l6ZV07XHJcbiAgICBcclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICBjYXNlICdtYXJrZG93bic6XHJcbiAgICAgICAgcmV0dXJuIEFycmF5KGNvdW50KS5maWxsKDApLm1hcCgoXywgaSkgPT4gXHJcbiAgICAgICAgICBgIyBIZWFkZXIgJHtpfVxcblxcblBhcmFncmFwaCAke2l9IHdpdGggKipib2xkKiogdGV4dC5gXHJcbiAgICAgICAgKS5qb2luKCdcXG5cXG4nKTtcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ2F1ZGlvJzpcclxuICAgICAgICByZXR1cm4gQXJyYXkoY291bnQpLmZpbGwoMCkubWFwKChfLCBpKSA9PiBcclxuICAgICAgICAgIGBodHRwczovL2V4YW1wbGUuY29tL2F1ZGlvJHtpfS5tcDNgXHJcbiAgICAgICAgKS5qb2luKCdcXG4nKTtcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ3RhYmxlJzpcclxuICAgICAgICBjb25zdCByb3dzID0gQXJyYXkoY291bnQpLmZpbGwoMCkubWFwKChfLCBpKSA9PiBcclxuICAgICAgICAgIGBSb3cke2l9LFZhbHVlJHtpfSxEYXRhJHtpfWBcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBgSGVhZGVyMSxIZWFkZXIyLEhlYWRlcjNcXG4ke3Jvd3Muam9pbignXFxuJyl9YDtcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ3RvZ2dsZSc6XHJcbiAgICAgICAgcmV0dXJuIEFycmF5KGNvdW50KS5maWxsKDApLm1hcCgoXywgaSkgPT4gXHJcbiAgICAgICAgICBgPiAjIFRvZ2dsZSAke2l9XFxuPiBDb250ZW50IGZvciB0b2dnbGUgJHtpfWBcclxuICAgICAgICApLmpvaW4oJ1xcblxcbicpO1xyXG4gICAgICBcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gQXJyYXkoY291bnQpLmZpbGwoMCkubWFwKChfLCBpKSA9PiBcclxuICAgICAgICAgIGBMaW5lICR7aX0gb2YgdGVzdCBjb250ZW50YFxyXG4gICAgICAgICkuam9pbignXFxuJyk7XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvLyBNZXN1cmUgZGUgcGVyZm9ybWFuY2VcclxuICBtZWFzdXJlUGVyZm9ybWFuY2U6IDxUPihmbjogKCkgPT4gVCk6IHsgcmVzdWx0OiBUOyBkdXJhdGlvbjogbnVtYmVyOyBtZW1vcnk6IGFueSB9ID0+IHtcclxuICAgIGNvbnN0IHN0YXJ0TWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xyXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIFxyXG4gICAgY29uc3QgcmVzdWx0ID0gZm4oKTtcclxuICAgIFxyXG4gICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XHJcbiAgICBjb25zdCBlbmRNZW1vcnkgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlc3VsdCxcclxuICAgICAgZHVyYXRpb246IGVuZFRpbWUgLSBzdGFydFRpbWUsXHJcbiAgICAgIG1lbW9yeToge1xyXG4gICAgICAgIHN0YXJ0OiBzdGFydE1lbW9yeSxcclxuICAgICAgICBlbmQ6IGVuZE1lbW9yeSxcclxuICAgICAgICBkZWx0YTogZW5kTWVtb3J5LmhlYXBVc2VkIC0gc3RhcnRNZW1vcnkuaGVhcFVzZWRcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBUeXBlcyBnbG9iYXV4IHBvdXIgVHlwZVNjcmlwdFxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgdmFyIHRlc3RVdGlsczoge1xyXG4gICAgZ2VuZXJhdGVUZXN0Q29udGVudDogKHR5cGU6IHN0cmluZywgc2l6ZT86ICdzbWFsbCcgfCAnbWVkaXVtJyB8ICdsYXJnZScpID0+IHN0cmluZztcclxuICAgIG1lYXN1cmVQZXJmb3JtYW5jZTogPFQ+KGZuOiAoKSA9PiBUKSA9PiB7IHJlc3VsdDogVDsgZHVyYXRpb246IG51bWJlcjsgbWVtb3J5OiBhbnkgfTtcclxuICB9O1xyXG4gIHZhciBQRVJGT1JNQU5DRV9CRU5DSE1BUktTOiBhbnk7XHJcbn0iXSwidmVyc2lvbiI6M30=