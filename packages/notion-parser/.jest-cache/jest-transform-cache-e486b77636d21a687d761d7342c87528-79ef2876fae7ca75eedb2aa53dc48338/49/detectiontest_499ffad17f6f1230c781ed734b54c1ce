19c7fd5f67ecaf2ce4ef660588b70d80
"use strict";
/**
 * Tests complets de détection automatique
 * Basé sur le test ultimate exhaustif - Phase 1
 */
Object.defineProperty(exports, "__esModule", { value: true });
const parseContent_1 = require("../../src/parseContent");
describe('Content Detection - Phase 1', () => {
    describe('Automatic Content Type Detection', () => {
        it('should detect URLs with high confidence (>0.90)', async () => {
            const content = 'https://www.notion.so';
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('url');
            expect(result.metadata?.confidence).toBeGreaterThan(0.90);
        });
        it('should detect JavaScript code with good confidence (>0.70)', async () => {
            const content = `function hello() {
  console.log("Hello World");
  return true;
}`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('code');
            expect(result.metadata?.confidence).toBeGreaterThan(0.70);
        });
        it('should detect CSV format with good confidence (>0.70)', async () => {
            const content = `Name,Age,City
John,30,Paris
Jane,25,London`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(['csv', 'table']).toContain(result.metadata?.detectedType);
            expect(result.metadata?.confidence).toBeGreaterThan(0.70);
        });
        it('should detect TSV format with good confidence (>0.70)', async () => {
            const content = `Name\tAge\tCity
John\t30\tParis
Jane\t25\tLondon`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(['tsv', 'table']).toContain(result.metadata?.detectedType);
            expect(result.metadata?.confidence).toBeGreaterThan(0.70);
        });
        it('should detect HTML with moderate confidence (>0.50)', async () => {
            const content = `<!DOCTYPE html>
<html>
<head><title>Test</title></head>
<body>
  <p>Content with <strong>bold</strong></p>
</body>
</html>`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('html');
            expect(result.metadata?.confidence).toBeGreaterThan(0.50);
        });
        it('should detect LaTeX with moderate confidence (>0.50)', async () => {
            const content = `$
\\int_{a}^{b} f(x) \\, dx = F(b) - F(a)
$`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('latex');
            expect(result.metadata?.confidence).toBeGreaterThan(0.50);
        });
        it('should detect JSON with good confidence (>0.70)', async () => {
            const content = `{
  "name": "John",
  "age": 30,
  "city": "Paris"
}`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('json');
            expect(result.metadata?.confidence).toBeGreaterThan(0.70);
        });
        it('should detect Markdown with moderate confidence (>0.40)', async () => {
            const content = `# Title
**Bold** and *italic*
- List item`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('markdown');
            expect(result.metadata?.confidence).toBeGreaterThan(0.40);
        });
        it('should fallback to text with perfect confidence (1.0)', async () => {
            const content = 'Just plain text without any special formatting';
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('text');
            expect(result.metadata?.confidence).toBe(1.0);
        });
    });
    describe('Detection Priority Order', () => {
        it('should prioritize URL detection over other types', async () => {
            const content = 'https://github.com/user/repo.git';
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('url');
        });
        it('should prioritize code detection over markdown for code-like content', async () => {
            const content = `class Example {
  constructor() {
    this.value = 42;
  }
}`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.metadata?.detectedType).toBe('code');
        });
    });
    describe('Edge Cases in Detection', () => {
        it('should handle mixed content appropriately', async () => {
            const content = `# Markdown Title
But also has function() { code(); }
And https://example.com URLs`;
            const result = (0, parseContent_1.parseContent)(content, { includeMetadata: true });
            // Should detect as markdown due to header
            expect(['markdown', 'text']).toContain(result.metadata?.detectedType);
        });
        it('should handle empty content gracefully', async () => {
            const result = (0, parseContent_1.parseContent)('', { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.success).toBe(true);
            expect(result.blocks).toEqual([]);
        });
        it('should handle whitespace-only content', async () => {
            const result = (0, parseContent_1.parseContent)('   \n\t  \n  ', { includeMetadata: true });
            expect(result.success).toBe(true);
            expect(result.success).toBe(true);
            expect(result.blocks).toEqual([]);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXGNvbXByZWhlbnNpdmVcXGRldGVjdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgseURBQXNEO0FBRXRELFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7SUFDM0MsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtRQUNoRCxFQUFFLENBQUMsaURBQWlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsTUFBTSxPQUFPLEdBQUcsdUJBQXVCLENBQUM7WUFDeEMsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBWSxFQUFDLE9BQU8sRUFBRSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNERBQTRELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUUsTUFBTSxPQUFPLEdBQUc7OztFQUdwQixDQUFDO1lBQ0csTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBWSxFQUFDLE9BQU8sRUFBRSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdURBQXVELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckUsTUFBTSxPQUFPLEdBQUc7O2VBRVAsQ0FBQztZQUNWLE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUVoRSxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUNsRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdURBQXVELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckUsTUFBTSxPQUFPLEdBQUc7O2lCQUVMLENBQUM7WUFDWixNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFDbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLE1BQU0sT0FBTyxHQUFHOzs7Ozs7UUFNZCxDQUFDO1lBQ0gsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBWSxFQUFDLE9BQU8sRUFBRSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDcEUsTUFBTSxPQUFPLEdBQUc7O0VBRXBCLENBQUM7WUFDRyxNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRCxNQUFNLE9BQU8sR0FBRzs7OztFQUlwQixDQUFDO1lBQ0csTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBWSxFQUFDLE9BQU8sRUFBRSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseURBQXlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkUsTUFBTSxPQUFPLEdBQUc7O1lBRVYsQ0FBQztZQUNQLE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUVoRSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVsQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVEQUF1RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3JFLE1BQU0sT0FBTyxHQUFHLGdEQUFnRCxDQUFDO1lBQ2pFLE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUVoRSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVsQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1FBQ3hDLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRSxNQUFNLE9BQU8sR0FBRyxrQ0FBa0MsQ0FBQztZQUNuRCxNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNFQUFzRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BGLE1BQU0sT0FBTyxHQUFHOzs7O0VBSXBCLENBQUM7WUFDRyxNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1FBQ3ZDLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLE9BQU8sR0FBRzs7NkJBRU8sQ0FBQztZQUV4QixNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsT0FBTyxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFaEUsMENBQTBDO1lBQzFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3hFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RELE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxFQUFFLEVBQUUsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFZLEVBQUMsZUFBZSxFQUFFLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFeEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xccmF5YW5cXERlc2t0b3BcXERldlxcTm90aW9uQ2xpcHBlclxccGFja2FnZXNcXG5vdGlvbi1wYXJzZXJcXHRlc3RzXFxjb21wcmVoZW5zaXZlXFxkZXRlY3Rpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVGVzdHMgY29tcGxldHMgZGUgZMOpdGVjdGlvbiBhdXRvbWF0aXF1ZVxyXG4gKiBCYXPDqSBzdXIgbGUgdGVzdCB1bHRpbWF0ZSBleGhhdXN0aWYgLSBQaGFzZSAxXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgcGFyc2VDb250ZW50IH0gZnJvbSAnLi4vLi4vc3JjL3BhcnNlQ29udGVudCc7XHJcblxyXG5kZXNjcmliZSgnQ29udGVudCBEZXRlY3Rpb24gLSBQaGFzZSAxJywgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKCdBdXRvbWF0aWMgQ29udGVudCBUeXBlIERldGVjdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IFVSTHMgd2l0aCBoaWdoIGNvbmZpZGVuY2UgKD4wLjkwKScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9ICdodHRwczovL3d3dy5ub3Rpb24uc28nO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmRldGVjdGVkVHlwZSkudG9CZSgndXJsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwLjkwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IEphdmFTY3JpcHQgY29kZSB3aXRoIGdvb2QgY29uZmlkZW5jZSAoPjAuNzApJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gYGZ1bmN0aW9uIGhlbGxvKCkge1xyXG4gIGNvbnNvbGUubG9nKFwiSGVsbG8gV29ybGRcIik7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1gO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpLnRvQmUoJ2NvZGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YT8uY29uZmlkZW5jZSkudG9CZUdyZWF0ZXJUaGFuKDAuNzApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgQ1NWIGZvcm1hdCB3aXRoIGdvb2QgY29uZmlkZW5jZSAoPjAuNzApJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gYE5hbWUsQWdlLENpdHlcclxuSm9obiwzMCxQYXJpc1xyXG5KYW5lLDI1LExvbmRvbmA7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGluY2x1ZGVNZXRhZGF0YTogdHJ1ZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChbJ2NzdicsICd0YWJsZSddKS50b0NvbnRhaW4ocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5jb25maWRlbmNlKS50b0JlR3JlYXRlclRoYW4oMC43MCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBUU1YgZm9ybWF0IHdpdGggZ29vZCBjb25maWRlbmNlICg+MC43MCknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgTmFtZVxcdEFnZVxcdENpdHlcclxuSm9oblxcdDMwXFx0UGFyaXNcclxuSmFuZVxcdDI1XFx0TG9uZG9uYDtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbnRlbnQsIHsgaW5jbHVkZU1ldGFkYXRhOiB0cnVlIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KFsndHN2JywgJ3RhYmxlJ10pLnRvQ29udGFpbihyZXN1bHQubWV0YWRhdGE/LmRldGVjdGVkVHlwZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwLjcwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IEhUTUwgd2l0aCBtb2RlcmF0ZSBjb25maWRlbmNlICg+MC41MCknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgPCFET0NUWVBFIGh0bWw+XHJcbjxodG1sPlxyXG48aGVhZD48dGl0bGU+VGVzdDwvdGl0bGU+PC9oZWFkPlxyXG48Ym9keT5cclxuICA8cD5Db250ZW50IHdpdGggPHN0cm9uZz5ib2xkPC9zdHJvbmc+PC9wPlxyXG48L2JvZHk+XHJcbjwvaHRtbD5gO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpLnRvQmUoJ2h0bWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YT8uY29uZmlkZW5jZSkudG9CZUdyZWF0ZXJUaGFuKDAuNTApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgTGFUZVggd2l0aCBtb2RlcmF0ZSBjb25maWRlbmNlICg+MC41MCknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgJFxyXG5cXFxcaW50X3thfV57Yn0gZih4KSBcXFxcLCBkeCA9IEYoYikgLSBGKGEpXHJcbiRgO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpLnRvQmUoJ2xhdGV4Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwLjUwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IEpTT04gd2l0aCBnb29kIGNvbmZpZGVuY2UgKD4wLjcwKScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9IGB7XHJcbiAgXCJuYW1lXCI6IFwiSm9oblwiLFxyXG4gIFwiYWdlXCI6IDMwLFxyXG4gIFwiY2l0eVwiOiBcIlBhcmlzXCJcclxufWA7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGluY2x1ZGVNZXRhZGF0YTogdHJ1ZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmRldGVjdGVkVHlwZSkudG9CZSgnanNvbicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5jb25maWRlbmNlKS50b0JlR3JlYXRlclRoYW4oMC43MCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBNYXJrZG93biB3aXRoIG1vZGVyYXRlIGNvbmZpZGVuY2UgKD4wLjQwKScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9IGAjIFRpdGxlXHJcbioqQm9sZCoqIGFuZCAqaXRhbGljKlxyXG4tIExpc3QgaXRlbWA7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGluY2x1ZGVNZXRhZGF0YTogdHJ1ZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0YWRhdGE/LmRldGVjdGVkVHlwZSkudG9CZSgnbWFya2Rvd24nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YT8uY29uZmlkZW5jZSkudG9CZUdyZWF0ZXJUaGFuKDAuNDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBmYWxsYmFjayB0byB0ZXh0IHdpdGggcGVyZmVjdCBjb25maWRlbmNlICgxLjApJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJ0p1c3QgcGxhaW4gdGV4dCB3aXRob3V0IGFueSBzcGVjaWFsIGZvcm1hdHRpbmcnO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpLnRvQmUoJ3RleHQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YT8uY29uZmlkZW5jZSkudG9CZSgxLjApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdEZXRlY3Rpb24gUHJpb3JpdHkgT3JkZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHByaW9yaXRpemUgVVJMIGRldGVjdGlvbiBvdmVyIG90aGVyIHR5cGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS91c2VyL3JlcG8uZ2l0JztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbnRlbnQsIHsgaW5jbHVkZU1ldGFkYXRhOiB0cnVlIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhZGF0YT8uZGV0ZWN0ZWRUeXBlKS50b0JlKCd1cmwnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcHJpb3JpdGl6ZSBjb2RlIGRldGVjdGlvbiBvdmVyIG1hcmtkb3duIGZvciBjb2RlLWxpa2UgY29udGVudCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9IGBjbGFzcyBFeGFtcGxlIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudmFsdWUgPSA0MjtcclxuICB9XHJcbn1gO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldGFkYXRhPy5kZXRlY3RlZFR5cGUpLnRvQmUoJ2NvZGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRWRnZSBDYXNlcyBpbiBEZXRlY3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXhlZCBjb250ZW50IGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgIyBNYXJrZG93biBUaXRsZVxyXG5CdXQgYWxzbyBoYXMgZnVuY3Rpb24oKSB7IGNvZGUoKTsgfVxyXG5BbmQgaHR0cHM6Ly9leGFtcGxlLmNvbSBVUkxzYDtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGluY2x1ZGVNZXRhZGF0YTogdHJ1ZSB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNob3VsZCBkZXRlY3QgYXMgbWFya2Rvd24gZHVlIHRvIGhlYWRlclxyXG4gICAgICBleHBlY3QoWydtYXJrZG93bicsICd0ZXh0J10pLnRvQ29udGFpbihyZXN1bHQubWV0YWRhdGE/LmRldGVjdGVkVHlwZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBjb250ZW50IGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudCgnJywgeyBpbmNsdWRlTWV0YWRhdGE6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzKS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHdoaXRlc3BhY2Utb25seSBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoJyAgIFxcblxcdCAgXFxuICAnLCB7IGluY2x1ZGVNZXRhZGF0YTogdHJ1ZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MpLnRvRXF1YWwoW10pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==