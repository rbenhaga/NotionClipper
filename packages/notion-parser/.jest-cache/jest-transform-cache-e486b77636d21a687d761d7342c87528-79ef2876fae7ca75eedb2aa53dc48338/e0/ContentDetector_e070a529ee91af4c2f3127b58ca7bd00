6ee1ceb8514d81f0598be432380a1c5e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContentDetector = void 0;
const MarkdownDetector_1 = require("./MarkdownDetector");
class ContentDetector {
    constructor() {
        this.markdownDetector = new MarkdownDetector_1.MarkdownDetector();
    }
    detect(content, options = {}) {
        if (!content?.trim()) {
            return { type: 'text', confidence: 1.0 };
        }
        const results = [];
        // URL Detection
        if (options.enableUrlDetection !== false) {
            const urlResult = this.detectUrl(content);
            if (urlResult.confidence > 0.8) {
                results.push(urlResult);
            }
        }
        // LaTeX Detection
        if (options.enableLatexDetection !== false) {
            const latexResult = this.detectLatex(content);
            if (latexResult.confidence > 0.5) {
                results.push(latexResult);
            }
        }
        // JSON Detection
        if (options.enableJsonDetection !== false) {
            const jsonResult = this.detectJson(content);
            if (jsonResult.confidence > 0.7) {
                results.push(jsonResult);
            }
        }
        // Code Detection
        if (options.enableCodeDetection !== false) {
            const codeResult = this.detectCode(content);
            if (codeResult.confidence > 0.4) { // Seuil abaissé pour détecter plus de code
                results.push(codeResult);
            }
        }
        // Table Detection
        if (options.enableTableDetection !== false) {
            const tableResult = this.detectTable(content);
            if (tableResult.confidence > 0.6) {
                results.push(tableResult);
            }
        }
        // HTML Detection
        if (options.enableHtmlDetection !== false) {
            const htmlResult = this.detectHtml(content);
            if (htmlResult.confidence > 0.5) {
                results.push(htmlResult);
            }
        }
        // Markdown Detection
        if (options.enableMarkdownDetection !== false) {
            const markdownResult = this.markdownDetector.detect(content);
            if (markdownResult.confidence > 0.4) {
                results.push(markdownResult);
            }
        }
        // Return highest confidence result or default to text
        if (results.length === 0) {
            return { type: 'text', confidence: 1.0 };
        }
        return results.reduce((best, current) => current.confidence > best.confidence ? current : best);
    }
    detectUrl(content) {
        const trimmed = content.trim();
        // Single URL
        if (this.isValidUrl(trimmed)) {
            return {
                type: 'url',
                confidence: 0.95,
                metadata: { url: trimmed }
            };
        }
        // Multiple URLs
        const urls = trimmed.split(/\s+/).filter(line => this.isValidUrl(line));
        if (urls.length > 0 && urls.length === trimmed.split(/\s+/).length) {
            return {
                type: 'url',
                confidence: 0.85,
                metadata: { urls }
            };
        }
        return { type: 'url', confidence: 0.0 };
    }
    detectCode(content) {
        const lines = content.split('\n');
        let codeIndicators = 0;
        let totalLines = lines.length;
        // Code block markers
        if (content.includes('```')) {
            codeIndicators += 0.4;
        }
        // Indentation patterns
        const indentedLines = lines.filter(line => line.match(/^[ ]{2,}/) || line.match(/^\t/)).length;
        if (indentedLines / totalLines > 0.3) {
            codeIndicators += 0.3;
        }
        // Programming language keywords
        const codeKeywords = [
            'function', 'const', 'let', 'var', 'class', 'import', 'export',
            'if', 'else', 'for', 'while', 'return', 'try', 'catch',
            'def', 'class', 'import', 'from', 'return', 'if', 'else',
            'public', 'private', 'static', 'void', 'int', 'string',
            'console.log', 'console.', 'document.', 'window.'
        ];
        const keywordMatches = codeKeywords.filter(keyword => content.includes(keyword)).length;
        if (keywordMatches >= 1) { // Seuil abaissé de 2 à 1
            codeIndicators += 0.4; // Augmenté de 0.3 à 0.4
        }
        // Brackets and semicolons
        const brackets = (content.match(/[{}[\]()]/g) || []).length;
        const semicolons = (content.match(/;/g) || []).length;
        if (brackets > totalLines * 0.5 || semicolons > totalLines * 0.3) {
            codeIndicators += 0.2;
        }
        return {
            type: 'code',
            confidence: Math.min(codeIndicators, 1.0),
            metadata: {
                language: this.detectLanguage(content)
            }
        };
    }
    detectTable(content) {
        const lines = content.split('\n').filter(line => line.trim());
        // CSV detection
        if (this.detectCsv(content)) {
            return {
                type: 'csv',
                confidence: 0.8,
                metadata: { delimiter: ',' }
            };
        }
        // TSV detection
        if (this.detectTsv(content)) {
            return {
                type: 'tsv',
                confidence: 0.8,
                metadata: { delimiter: '\t' }
            };
        }
        // Markdown table detection
        const pipeLines = lines.filter(line => line.includes('|')).length;
        if (pipeLines >= 2 && pipeLines / lines.length > 0.5) {
            // Check for header separator
            const hasHeaderSeparator = lines.some(line => line.match(/^\|?[\s]*:?-+:?[\s]*\|/));
            return {
                type: 'table',
                confidence: hasHeaderSeparator ? 0.9 : 0.6,
                metadata: { format: 'markdown' }
            };
        }
        return { type: 'table', confidence: 0.0 };
    }
    detectHtml(content) {
        const htmlTags = content.match(/<[^>]+>/g) || [];
        const totalLength = content.length;
        if (htmlTags.length === 0) {
            return { type: 'html', confidence: 0.0 };
        }
        // Calculate tag density
        const tagDensity = htmlTags.length / (totalLength / 100);
        // Check for common HTML structures
        const hasHtmlStructure = content.includes('<html>') ||
            content.includes('<!DOCTYPE') ||
            content.includes('<head>') ||
            content.includes('<body>');
        const hasCommonTags = ['<div>', '<p>', '<span>', '<a>', '<img>']
            .some(tag => content.includes(tag));
        let confidence = 0;
        if (hasHtmlStructure)
            confidence += 0.4;
        if (hasCommonTags)
            confidence += 0.3;
        if (tagDensity > 2)
            confidence += 0.3;
        return {
            type: 'html',
            confidence: Math.min(confidence, 1.0)
        };
    }
    detectCsv(content) {
        const lines = content.split('\n').filter(line => line.trim());
        if (lines.length < 2)
            return false;
        const commaLines = lines.filter(line => line.includes(',')).length;
        return commaLines / lines.length > 0.7;
    }
    detectTsv(content) {
        const lines = content.split('\n').filter(line => line.trim());
        if (lines.length < 2)
            return false;
        const tabLines = lines.filter(line => line.includes('\t')).length;
        return tabLines / lines.length > 0.7;
    }
    detectLanguage(content) {
        // Simple language detection based on patterns
        if (content.includes('function') && content.includes('{')) {
            if (content.includes('const') || content.includes('let')) {
                return 'javascript';
            }
            return 'javascript';
        }
        if (content.includes('def ') && content.includes(':')) {
            return 'python';
        }
        if (content.includes('public class') || content.includes('import java')) {
            return 'java';
        }
        if (content.includes('#include') || content.includes('int main')) {
            return 'c++';
        }
        if (content.includes('<?php')) {
            return 'php';
        }
        return 'plain text';
    }
    detectLatex(content) {
        let confidence = 0;
        const trimmed = content.trim();
        // LaTeX delimiters
        const inlineLatex = (trimmed.match(/\$[^$]+\$/g) || []).length;
        const blockLatex = (trimmed.match(/\$\$[\s\S]+?\$\$/g) || []).length;
        const environments = (trimmed.match(/\\begin\{[^}]+\}[\s\S]*?\\end\{[^}]+\}/g) || []).length;
        if (blockLatex > 0)
            confidence += 0.4;
        if (inlineLatex > 0)
            confidence += 0.3;
        if (environments > 0)
            confidence += 0.4;
        // LaTeX commands
        const latexCommands = [
            '\\frac', '\\sum', '\\int', '\\sqrt', '\\alpha', '\\beta', '\\gamma',
            '\\theta', '\\lambda', '\\mu', '\\sigma', '\\pi', '\\infty',
            '\\partial', '\\nabla', '\\times', '\\cdot', '\\leq', '\\geq',
            '\\neq', '\\approx', '\\equiv', '\\rightarrow', '\\leftarrow'
        ];
        const commandMatches = latexCommands.filter(cmd => trimmed.includes(cmd)).length;
        if (commandMatches > 0)
            confidence += Math.min(commandMatches * 0.1, 0.3);
        // Math environments
        const mathEnvs = ['equation', 'align', 'matrix', 'cases', 'split'];
        const envMatches = mathEnvs.filter(env => trimmed.includes(`\\begin{${env}}`) || trimmed.includes(`\\end{${env}}`)).length;
        if (envMatches > 0)
            confidence += 0.3;
        return {
            type: 'latex',
            confidence: Math.min(confidence, 1.0),
            metadata: {
                hasInlineLatex: inlineLatex > 0,
                hasBlockLatex: blockLatex > 0,
                hasEnvironments: environments > 0
            }
        };
    }
    detectJson(content) {
        const trimmed = content.trim();
        try {
            // Try to parse as JSON
            const parsed = JSON.parse(trimmed);
            // Check if it's a meaningful JSON structure
            if (typeof parsed === 'object' && parsed !== null) {
                const isArray = Array.isArray(parsed);
                const isObject = !isArray && typeof parsed === 'object';
                let confidence = 0.8;
                // Boost confidence for complex structures
                if (isArray && parsed.length > 0) {
                    confidence += 0.1;
                }
                if (isObject && Object.keys(parsed).length > 0) {
                    confidence += 0.1;
                }
                return {
                    type: 'json',
                    confidence: Math.min(confidence, 1.0),
                    metadata: {
                        isArray,
                        isObject,
                        itemCount: isArray ? parsed.length : Object.keys(parsed).length
                    }
                };
            }
        }
        catch {
            // Not valid JSON, check for JSON-like patterns
            let confidence = 0;
            // Check for JSON-like structure patterns
            if (trimmed.startsWith('{') && trimmed.endsWith('}')) {
                confidence += 0.3;
            }
            if (trimmed.startsWith('[') && trimmed.endsWith(']')) {
                confidence += 0.3;
            }
            // Check for JSON-like key-value patterns
            const keyValuePattern = /"[^"]+"\s*:\s*[^,}]+/g;
            const keyValueMatches = (trimmed.match(keyValuePattern) || []).length;
            if (keyValueMatches > 0) {
                confidence += Math.min(keyValueMatches * 0.1, 0.4);
            }
            return {
                type: 'json',
                confidence: Math.min(confidence, 0.6), // Max 0.6 for invalid JSON
                metadata: {
                    isValidJson: false,
                    hasJsonLikeStructure: confidence > 0
                }
            };
        }
        return { type: 'json', confidence: 0.0 };
    }
    isValidUrl(text) {
        try {
            // Simple URL validation using regex
            const urlPattern = /^https?:\/\/[^\s<>"{}|\\^`[\]]+$/;
            return urlPattern.test(text) && text.includes('.');
        }
        catch {
            return false;
        }
    }
}
exports.ContentDetector = ContentDetector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcc3JjXFxkZXRlY3RvcnNcXENvbnRlbnREZXRlY3Rvci50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSx5REFBc0Q7QUFVdEQsTUFBYSxlQUFlO0lBQTVCO1FBQ1UscUJBQWdCLEdBQUcsSUFBSSxtQ0FBZ0IsRUFBRSxDQUFDO0lBc1lwRCxDQUFDO0lBcFlDLE1BQU0sQ0FBQyxPQUFlLEVBQUUsVUFBNEIsRUFBRTtRQUNwRCxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUM7WUFDckIsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQzNDLENBQUM7UUFFRCxNQUFNLE9BQU8sR0FBc0IsRUFBRSxDQUFDO1FBRXRDLGdCQUFnQjtRQUNoQixJQUFJLE9BQU8sQ0FBQyxrQkFBa0IsS0FBSyxLQUFLLEVBQUUsQ0FBQztZQUN6QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzFDLElBQUksU0FBUyxDQUFDLFVBQVUsR0FBRyxHQUFHLEVBQUUsQ0FBQztnQkFDL0IsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxQixDQUFDO1FBQ0gsQ0FBQztRQUVELGtCQUFrQjtRQUNsQixJQUFJLE9BQU8sQ0FBQyxvQkFBb0IsS0FBSyxLQUFLLEVBQUUsQ0FBQztZQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzlDLElBQUksV0FBVyxDQUFDLFVBQVUsR0FBRyxHQUFHLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUM1QixDQUFDO1FBQ0gsQ0FBQztRQUVELGlCQUFpQjtRQUNqQixJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsS0FBSyxL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LENBQUM7WUFFdEUsSUFBSSxlQUFlLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3hCLFVBQVUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsR0FBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDckQsQ0FBQztZQUVELE9BQU87Z0JBQ0wsSUFBSSxFQUFFLE1BQU07Z0JBQ1osVUFBVSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxFQUFFLDJCQUEyQjtnQkFDbEUsUUFBUSxFQUFFO29CQUNSLFdBQVcsRUFBRSxLQUFLO29CQUNsQixvQkFBb0IsRUFBRSxVQUFVLEdBQUcsQ0FBQztpQkFDckM7YUFDRixDQUFDO1FBQ0osQ0FBQztRQUVELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUMzQyxDQUFDO0lBRU8sVUFBVSxDQUFDLElBQVk7UUFDN0IsSUFBSSxDQUFDO1lBQ0gsb0NBQW9DO1lBQ3BDLE1BQU0sVUFBVSxHQUFHLGtDQUFrQyxDQUFDO1lBQ3RELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFBQyxNQUFNLENBQUM7WUFDUCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUF2WUQsMENBdVlDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xccmF5YW5cXERlc2t0b3BcXERldlxcTm90aW9uQ2xpcHBlclxccGFja2FnZXNcXG5vdGlvbi1wYXJzZXJcXHNyY1xcZGV0ZWN0b3JzXFxDb250ZW50RGV0ZWN0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBEZXRlY3Rpb25PcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBNYXJrZG93bkRldGVjdG9yIH0gZnJvbSAnLi9NYXJrZG93bkRldGVjdG9yJztcclxuXHJcbmV4cG9ydCB0eXBlIENvbnRlbnRUeXBlID0gJ21hcmtkb3duJyB8ICdodG1sJyB8ICdjb2RlJyB8ICd0YWJsZScgfCAnY3N2JyB8ICd0c3YnIHwgJ3VybCcgfCAnbGF0ZXgnIHwgJ2pzb24nIHwgJ2F1ZGlvJyB8ICd0ZXh0JztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGV0ZWN0aW9uUmVzdWx0IHtcclxuICB0eXBlOiBDb250ZW50VHlwZTtcclxuICBjb25maWRlbmNlOiBudW1iZXI7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ29udGVudERldGVjdG9yIHtcclxuICBwcml2YXRlIG1hcmtkb3duRGV0ZWN0b3IgPSBuZXcgTWFya2Rvd25EZXRlY3RvcigpO1xyXG5cclxuICBkZXRlY3QoY29udGVudDogc3RyaW5nLCBvcHRpb25zOiBEZXRlY3Rpb25PcHRpb25zID0ge30pOiBEZXRlY3Rpb25SZXN1bHQge1xyXG4gICAgaWYgKCFjb250ZW50Py50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgdHlwZTogJ3RleHQnLCBjb25maWRlbmNlOiAxLjAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZXN1bHRzOiBEZXRlY3Rpb25SZXN1bHRbXSA9IFtdO1xyXG5cclxuICAgIC8vIFVSTCBEZXRlY3Rpb25cclxuICAgIGlmIChvcHRpb25zLmVuYWJsZVVybERldGVjdGlvbiAhPT0gZmFsc2UpIHtcclxuICAgICAgY29uc3QgdXJsUmVzdWx0ID0gdGhpcy5kZXRlY3RVcmwoY29udGVudCk7XHJcbiAgICAgIGlmICh1cmxSZXN1bHQuY29uZmlkZW5jZSA+IDAuOCkge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaCh1cmxSZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGFUZVggRGV0ZWN0aW9uXHJcbiAgICBpZiAob3B0aW9ucy5lbmFibGVMYXRleERldGVjdGlvbiAhPT0gZmFsc2UpIHtcclxuICAgICAgY29uc3QgbGF0ZXhSZXN1bHQgPSB0aGlzLmRldGVjdExhdGV4KGNvbnRlbnQpO1xyXG4gICAgICBpZiAobGF0ZXhSZXN1bHQuY29uZmlkZW5jZSA+IDAuNSkge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChsYXRleFJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBKU09OIERldGVjdGlvblxyXG4gICAgaWYgKG9wdGlvbnMuZW5hYmxlSnNvbkRldGVjdGlvbiAhPT0gZmFsc2UpIHtcclxuICAgICAgY29uc3QganNvblJlc3VsdCA9IHRoaXMuZGV0ZWN0SnNvbihjb250ZW50KTtcclxuICAgICAgaWYgKGpzb25SZXN1bHQuY29uZmlkZW5jZSA+IDAuNykge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChqc29uUmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENvZGUgRGV0ZWN0aW9uXHJcbiAgICBpZiAob3B0aW9ucy5lbmFibGVDb2RlRGV0ZWN0aW9uICE9PSBmYWxzZSkge1xyXG4gICAgICBjb25zdCBjb2RlUmVzdWx0ID0gdGhpcy5kZXRlY3RDb2RlKGNvbnRlbnQpO1xyXG4gICAgICBpZiAoY29kZVJlc3VsdC5jb25maWRlbmNlID4gMC40KSB7IC8vIFNldWlsIGFiYWlzc8OpIHBvdXIgZMOpdGVjdGVyIHBsdXMgZGUgY29kZVxyXG4gICAgICAgIHJlc3VsdHMucHVzaChjb2RlUmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRhYmxlIERldGVjdGlvblxyXG4gICAgaWYgKG9wdGlvbnMuZW5hYmxlVGFibGVEZXRlY3Rpb24gIT09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IHRhYmxlUmVzdWx0ID0gdGhpcy5kZXRlY3RUYWJsZShjb250ZW50KTtcclxuICAgICAgaWYgKHRhYmxlUmVzdWx0LmNvbmZpZGVuY2UgPiAwLjYpIHtcclxuICAgICAgICByZXN1bHRzLnB1c2godGFibGVSZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSFRNTCBEZXRlY3Rpb25cclxuICAgIGlmIChvcHRpb25zLmVuYWJsZUh0bWxEZXRlY3Rpb24gIT09IGZhbHNlKSB7XHJcbiAgICAgIGNvbnN0IGh0bWxSZXN1bHQgPSB0aGlzLmRldGVjdEh0bWwoY29udGVudCk7XHJcbiAgICAgIGlmIChodG1sUmVzdWx0LmNvbmZpZGVuY2UgPiAwLjUpIHtcclxuICAgICAgICByZXN1bHRzLnB1c2goaHRtbFJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBNYXJrZG93biBEZXRlY3Rpb25cclxuICAgIGlmIChvcHRpb25zLmVuYWJsZU1hcmtkb3duRGV0ZWN0aW9uICE9PSBmYWxzZSkge1xyXG4gICAgICBjb25zdCBtYXJrZG93blJlc3VsdCA9IHRoaXMubWFya2Rvd25EZXRlY3Rvci5kZXRlY3QoY29udGVudCk7XHJcbiAgICAgIGlmIChtYXJrZG93blJlc3VsdC5jb25maWRlbmNlID4gMC40KSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKG1hcmtkb3duUmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJldHVybiBoaWdoZXN0IGNvbmZpZGVuY2UgcmVzdWx0IG9yIGRlZmF1bHQgdG8gdGV4dFxyXG4gICAgaWYgKHJlc3VsdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB7IHR5cGU6ICd0ZXh0JywgY29uZmlkZW5jZTogMS4wIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdHMucmVkdWNlKChiZXN0LCBjdXJyZW50KSA9PiBcclxuICAgICAgY3VycmVudC5jb25maWRlbmNlID4gYmVzdC5jb25maWRlbmNlID8gY3VycmVudCA6IGJlc3RcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVjdFVybChjb250ZW50OiBzdHJpbmcpOiBEZXRlY3Rpb25SZXN1bHQge1xyXG4gICAgY29uc3QgdHJpbW1lZCA9IGNvbnRlbnQudHJpbSgpO1xyXG4gICAgXHJcbiAgICAvLyBTaW5nbGUgVVJMXHJcbiAgICBpZiAodGhpcy5pc1ZhbGlkVXJsKHRyaW1tZWQpKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdHlwZTogJ3VybCcsXHJcbiAgICAgICAgY29uZmlkZW5jZTogMC45NSxcclxuICAgICAgICBtZXRhZGF0YTogeyB1cmw6IHRyaW1tZWQgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE11bHRpcGxlIFVSTHNcclxuICAgIGNvbnN0IHVybHMgPSB0cmltbWVkLnNwbGl0KC9cXHMrLykuZmlsdGVyKGxpbmUgPT4gdGhpcy5pc1ZhbGlkVXJsKGxpbmUpKTtcclxuICAgIGlmICh1cmxzLmxlbmd0aCA+IDAgJiYgdXJscy5sZW5ndGggPT09IHRyaW1tZWQuc3BsaXQoL1xccysvKS5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0eXBlOiAndXJsJyxcclxuICAgICAgICBjb25maWRlbmNlOiAwLjg1LFxyXG4gICAgICAgIG1ldGFkYXRhOiB7IHVybHMgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHR5cGU6ICd1cmwnLCBjb25maWRlbmNlOiAwLjAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGV0ZWN0Q29kZShjb250ZW50OiBzdHJpbmcpOiBEZXRlY3Rpb25SZXN1bHQge1xyXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcclxuICAgIGxldCBjb2RlSW5kaWNhdG9ycyA9IDA7XHJcbiAgICBsZXQgdG90YWxMaW5lcyA9IGxpbmVzLmxlbmd0aDtcclxuXHJcbiAgICAvLyBDb2RlIGJsb2NrIG1hcmtlcnNcclxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdgYGAnKSkge1xyXG4gICAgICBjb2RlSW5kaWNhdG9ycyArPSAwLjQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5kZW50YXRpb24gcGF0dGVybnNcclxuICAgIGNvbnN0IGluZGVudGVkTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBcclxuICAgICAgbGluZS5tYXRjaCgvXlsgXXsyLH0vKSB8fCBsaW5lLm1hdGNoKC9eXFx0LylcclxuICAgICkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICBpZiAoaW5kZW50ZWRMaW5lcyAvIHRvdGFsTGluZXMgPiAwLjMpIHtcclxuICAgICAgY29kZUluZGljYXRvcnMgKz0gMC4zO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2dyYW1taW5nIGxhbmd1YWdlIGtleXdvcmRzXHJcbiAgICBjb25zdCBjb2RlS2V5d29yZHMgPSBbXHJcbiAgICAgICdmdW5jdGlvbicsICdjb25zdCcsICdsZXQnLCAndmFyJywgJ2NsYXNzJywgJ2ltcG9ydCcsICdleHBvcnQnLFxyXG4gICAgICAnaWYnLCAnZWxzZScsICdmb3InLCAnd2hpbGUnLCAncmV0dXJuJywgJ3RyeScsICdjYXRjaCcsXHJcbiAgICAgICdkZWYnLCAnY2xhc3MnLCAnaW1wb3J0JywgJ2Zyb20nLCAncmV0dXJuJywgJ2lmJywgJ2Vsc2UnLFxyXG4gICAgICAncHVibGljJywgJ3ByaXZhdGUnLCAnc3RhdGljJywgJ3ZvaWQnLCAnaW50JywgJ3N0cmluZycsXHJcbiAgICAgICdjb25zb2xlLmxvZycsICdjb25zb2xlLicsICdkb2N1bWVudC4nLCAnd2luZG93LidcclxuICAgIF07XHJcblxyXG4gICAgY29uc3Qga2V5d29yZE1hdGNoZXMgPSBjb2RlS2V5d29yZHMuZmlsdGVyKGtleXdvcmQgPT4gXHJcbiAgICAgIGNvbnRlbnQuaW5jbHVkZXMoa2V5d29yZClcclxuICAgICkubGVuZ3RoO1xyXG5cclxuICAgIGlmIChrZXl3b3JkTWF0Y2hlcyA+PSAxKSB7IC8vIFNldWlsIGFiYWlzc8OpIGRlIDIgw6AgMVxyXG4gICAgICBjb2RlSW5kaWNhdG9ycyArPSAwLjQ7IC8vIEF1Z21lbnTDqSBkZSAwLjMgw6AgMC40XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQnJhY2tldHMgYW5kIHNlbWljb2xvbnNcclxuICAgIGNvbnN0IGJyYWNrZXRzID0gKGNvbnRlbnQubWF0Y2goL1t7fVtcXF0oKV0vZykgfHwgW10pLmxlbmd0aDtcclxuICAgIGNvbnN0IHNlbWljb2xvbnMgPSAoY29udGVudC5tYXRjaCgvOy9nKSB8fCBbXSkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICBpZiAoYnJhY2tldHMgPiB0b3RhbExpbmVzICogMC41IHx8IHNlbWljb2xvbnMgPiB0b3RhbExpbmVzICogMC4zKSB7XHJcbiAgICAgIGNvZGVJbmRpY2F0b3JzICs9IDAuMjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0eXBlOiAnY29kZScsXHJcbiAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGNvZGVJbmRpY2F0b3JzLCAxLjApLFxyXG4gICAgICBtZXRhZGF0YTogeyBcclxuICAgICAgICBsYW5ndWFnZTogdGhpcy5kZXRlY3RMYW5ndWFnZShjb250ZW50KVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZXRlY3RUYWJsZShjb250ZW50OiBzdHJpbmcpOiBEZXRlY3Rpb25SZXN1bHQge1xyXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XHJcbiAgICBcclxuICAgIC8vIENTViBkZXRlY3Rpb25cclxuICAgIGlmICh0aGlzLmRldGVjdENzdihjb250ZW50KSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHR5cGU6ICdjc3YnLFxyXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuOCxcclxuICAgICAgICBtZXRhZGF0YTogeyBkZWxpbWl0ZXI6ICcsJyB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVFNWIGRldGVjdGlvblxyXG4gICAgaWYgKHRoaXMuZGV0ZWN0VHN2KGNvbnRlbnQpKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdHlwZTogJ3RzdicsXHJcbiAgICAgICAgY29uZmlkZW5jZTogMC44LFxyXG4gICAgICAgIG1ldGFkYXRhOiB7IGRlbGltaXRlcjogJ1xcdCcgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE1hcmtkb3duIHRhYmxlIGRldGVjdGlvblxyXG4gICAgY29uc3QgcGlwZUxpbmVzID0gbGluZXMuZmlsdGVyKGxpbmUgPT4gbGluZS5pbmNsdWRlcygnfCcpKS5sZW5ndGg7XHJcbiAgICBpZiAocGlwZUxpbmVzID49IDIgJiYgcGlwZUxpbmVzIC8gbGluZXMubGVuZ3RoID4gMC41KSB7XHJcbiAgICAgIC8vIENoZWNrIGZvciBoZWFkZXIgc2VwYXJhdG9yXHJcbiAgICAgIGNvbnN0IGhhc0hlYWRlclNlcGFyYXRvciA9IGxpbmVzLnNvbWUobGluZSA9PiBcclxuICAgICAgICBsaW5lLm1hdGNoKC9eXFx8P1tcXHNdKjo/LSs6P1tcXHNdKlxcfC8pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHR5cGU6ICd0YWJsZScsXHJcbiAgICAgICAgY29uZmlkZW5jZTogaGFzSGVhZGVyU2VwYXJhdG9yID8gMC45IDogMC42LFxyXG4gICAgICAgIG1ldGFkYXRhOiB7IGZvcm1hdDogJ21hcmtkb3duJyB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgdHlwZTogJ3RhYmxlJywgY29uZmlkZW5jZTogMC4wIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVjdEh0bWwoY29udGVudDogc3RyaW5nKTogRGV0ZWN0aW9uUmVzdWx0IHtcclxuICAgIGNvbnN0IGh0bWxUYWdzID0gY29udGVudC5tYXRjaCgvPFtePl0rPi9nKSB8fCBbXTtcclxuICAgIGNvbnN0IHRvdGFsTGVuZ3RoID0gY29udGVudC5sZW5ndGg7XHJcbiAgICBcclxuICAgIGlmIChodG1sVGFncy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHsgdHlwZTogJ2h0bWwnLCBjb25maWRlbmNlOiAwLjAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgdGFnIGRlbnNpdHlcclxuICAgIGNvbnN0IHRhZ0RlbnNpdHkgPSBodG1sVGFncy5sZW5ndGggLyAodG90YWxMZW5ndGggLyAxMDApO1xyXG4gICAgXHJcbiAgICAvLyBDaGVjayBmb3IgY29tbW9uIEhUTUwgc3RydWN0dXJlc1xyXG4gICAgY29uc3QgaGFzSHRtbFN0cnVjdHVyZSA9IGNvbnRlbnQuaW5jbHVkZXMoJzxodG1sPicpIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudC5pbmNsdWRlcygnPCFET0NUWVBFJykgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuaW5jbHVkZXMoJzxoZWFkPicpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LmluY2x1ZGVzKCc8Ym9keT4nKTtcclxuXHJcbiAgICBjb25zdCBoYXNDb21tb25UYWdzID0gWyc8ZGl2PicsICc8cD4nLCAnPHNwYW4+JywgJzxhPicsICc8aW1nPiddXHJcbiAgICAgIC5zb21lKHRhZyA9PiBjb250ZW50LmluY2x1ZGVzKHRhZykpO1xyXG5cclxuICAgIGxldCBjb25maWRlbmNlID0gMDtcclxuICAgIFxyXG4gICAgaWYgKGhhc0h0bWxTdHJ1Y3R1cmUpIGNvbmZpZGVuY2UgKz0gMC40O1xyXG4gICAgaWYgKGhhc0NvbW1vblRhZ3MpIGNvbmZpZGVuY2UgKz0gMC4zO1xyXG4gICAgaWYgKHRhZ0RlbnNpdHkgPiAyKSBjb25maWRlbmNlICs9IDAuMztcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0eXBlOiAnaHRtbCcsXHJcbiAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGNvbmZpZGVuY2UsIDEuMClcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVjdENzdihjb250ZW50OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpO1xyXG4gICAgaWYgKGxpbmVzLmxlbmd0aCA8IDIpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBjb21tYUxpbmVzID0gbGluZXMuZmlsdGVyKGxpbmUgPT4gbGluZS5pbmNsdWRlcygnLCcpKS5sZW5ndGg7XHJcbiAgICByZXR1cm4gY29tbWFMaW5lcyAvIGxpbmVzLmxlbmd0aCA+IDAuNztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGV0ZWN0VHN2KGNvbnRlbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XHJcbiAgICBpZiAobGluZXMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IHRhYkxpbmVzID0gbGluZXMuZmlsdGVyKGxpbmUgPT4gbGluZS5pbmNsdWRlcygnXFx0JykpLmxlbmd0aDtcclxuICAgIHJldHVybiB0YWJMaW5lcyAvIGxpbmVzLmxlbmd0aCA+IDAuNztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGV0ZWN0TGFuZ3VhZ2UoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIC8vIFNpbXBsZSBsYW5ndWFnZSBkZXRlY3Rpb24gYmFzZWQgb24gcGF0dGVybnNcclxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdmdW5jdGlvbicpICYmIGNvbnRlbnQuaW5jbHVkZXMoJ3snKSkge1xyXG4gICAgICBpZiAoY29udGVudC5pbmNsdWRlcygnY29uc3QnKSB8fCBjb250ZW50LmluY2x1ZGVzKCdsZXQnKSkge1xyXG4gICAgICAgIHJldHVybiAnamF2YXNjcmlwdCc7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuICdqYXZhc2NyaXB0JztcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ2RlZiAnKSAmJiBjb250ZW50LmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgcmV0dXJuICdweXRob24nO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygncHVibGljIGNsYXNzJykgfHwgY29udGVudC5pbmNsdWRlcygnaW1wb3J0IGphdmEnKSkge1xyXG4gICAgICByZXR1cm4gJ2phdmEnO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnI2luY2x1ZGUnKSB8fCBjb250ZW50LmluY2x1ZGVzKCdpbnQgbWFpbicpKSB7XHJcbiAgICAgIHJldHVybiAnYysrJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJzw/cGhwJykpIHtcclxuICAgICAgcmV0dXJuICdwaHAnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAncGxhaW4gdGV4dCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVjdExhdGV4KGNvbnRlbnQ6IHN0cmluZyk6IERldGVjdGlvblJlc3VsdCB7XHJcbiAgICBsZXQgY29uZmlkZW5jZSA9IDA7XHJcbiAgICBjb25zdCB0cmltbWVkID0gY29udGVudC50cmltKCk7XHJcblxyXG4gICAgLy8gTGFUZVggZGVsaW1pdGVyc1xyXG4gICAgY29uc3QgaW5saW5lTGF0ZXggPSAodHJpbW1lZC5tYXRjaCgvXFwkW14kXStcXCQvZykgfHwgW10pLmxlbmd0aDtcclxuICAgIGNvbnN0IGJsb2NrTGF0ZXggPSAodHJpbW1lZC5tYXRjaCgvXFwkXFwkW1xcc1xcU10rP1xcJFxcJC9nKSB8fCBbXSkubGVuZ3RoO1xyXG4gICAgY29uc3QgZW52aXJvbm1lbnRzID0gKHRyaW1tZWQubWF0Y2goL1xcXFxiZWdpblxce1tefV0rXFx9W1xcc1xcU10qP1xcXFxlbmRcXHtbXn1dK1xcfS9nKSB8fCBbXSkubGVuZ3RoO1xyXG5cclxuICAgIGlmIChibG9ja0xhdGV4ID4gMCkgY29uZmlkZW5jZSArPSAwLjQ7XHJcbiAgICBpZiAoaW5saW5lTGF0ZXggPiAwKSBjb25maWRlbmNlICs9IDAuMztcclxuICAgIGlmIChlbnZpcm9ubWVudHMgPiAwKSBjb25maWRlbmNlICs9IDAuNDtcclxuXHJcbiAgICAvLyBMYVRlWCBjb21tYW5kc1xyXG4gICAgY29uc3QgbGF0ZXhDb21tYW5kcyA9IFtcclxuICAgICAgJ1xcXFxmcmFjJywgJ1xcXFxzdW0nLCAnXFxcXGludCcsICdcXFxcc3FydCcsICdcXFxcYWxwaGEnLCAnXFxcXGJldGEnLCAnXFxcXGdhbW1hJyxcclxuICAgICAgJ1xcXFx0aGV0YScsICdcXFxcbGFtYmRhJywgJ1xcXFxtdScsICdcXFxcc2lnbWEnLCAnXFxcXHBpJywgJ1xcXFxpbmZ0eScsXHJcbiAgICAgICdcXFxccGFydGlhbCcsICdcXFxcbmFibGEnLCAnXFxcXHRpbWVzJywgJ1xcXFxjZG90JywgJ1xcXFxsZXEnLCAnXFxcXGdlcScsXHJcbiAgICAgICdcXFxcbmVxJywgJ1xcXFxhcHByb3gnLCAnXFxcXGVxdWl2JywgJ1xcXFxyaWdodGFycm93JywgJ1xcXFxsZWZ0YXJyb3cnXHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IGNvbW1hbmRNYXRjaGVzID0gbGF0ZXhDb21tYW5kcy5maWx0ZXIoY21kID0+IFxyXG4gICAgICB0cmltbWVkLmluY2x1ZGVzKGNtZClcclxuICAgICkubGVuZ3RoO1xyXG5cclxuICAgIGlmIChjb21tYW5kTWF0Y2hlcyA+IDApIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4oY29tbWFuZE1hdGNoZXMgKiAwLjEsIDAuMyk7XHJcblxyXG4gICAgLy8gTWF0aCBlbnZpcm9ubWVudHNcclxuICAgIGNvbnN0IG1hdGhFbnZzID0gWydlcXVhdGlvbicsICdhbGlnbicsICdtYXRyaXgnLCAnY2FzZXMnLCAnc3BsaXQnXTtcclxuICAgIGNvbnN0IGVudk1hdGNoZXMgPSBtYXRoRW52cy5maWx0ZXIoZW52ID0+IFxyXG4gICAgICB0cmltbWVkLmluY2x1ZGVzKGBcXFxcYmVnaW57JHtlbnZ9fWApIHx8IHRyaW1tZWQuaW5jbHVkZXMoYFxcXFxlbmR7JHtlbnZ9fWApXHJcbiAgICApLmxlbmd0aDtcclxuXHJcbiAgICBpZiAoZW52TWF0Y2hlcyA+IDApIGNvbmZpZGVuY2UgKz0gMC4zO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR5cGU6ICdsYXRleCcsXHJcbiAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGNvbmZpZGVuY2UsIDEuMCksXHJcbiAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgaGFzSW5saW5lTGF0ZXg6IGlubGluZUxhdGV4ID4gMCxcclxuICAgICAgICBoYXNCbG9ja0xhdGV4OiBibG9ja0xhdGV4ID4gMCxcclxuICAgICAgICBoYXNFbnZpcm9ubWVudHM6IGVudmlyb25tZW50cyA+IDBcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGV0ZWN0SnNvbihjb250ZW50OiBzdHJpbmcpOiBEZXRlY3Rpb25SZXN1bHQge1xyXG4gICAgY29uc3QgdHJpbW1lZCA9IGNvbnRlbnQudHJpbSgpO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBUcnkgdG8gcGFyc2UgYXMgSlNPTlxyXG4gICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHRyaW1tZWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIG1lYW5pbmdmdWwgSlNPTiBzdHJ1Y3R1cmVcclxuICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT09ICdvYmplY3QnICYmIHBhcnNlZCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHBhcnNlZCk7XHJcbiAgICAgICAgY29uc3QgaXNPYmplY3QgPSAhaXNBcnJheSAmJiB0eXBlb2YgcGFyc2VkID09PSAnb2JqZWN0JztcclxuICAgICAgICBcclxuICAgICAgICBsZXQgY29uZmlkZW5jZSA9IDAuODtcclxuICAgICAgICBcclxuICAgICAgICAvLyBCb29zdCBjb25maWRlbmNlIGZvciBjb21wbGV4IHN0cnVjdHVyZXNcclxuICAgICAgICBpZiAoaXNBcnJheSAmJiBwYXJzZWQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uZmlkZW5jZSArPSAwLjE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChpc09iamVjdCAmJiBPYmplY3Qua2V5cyhwYXJzZWQpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbmZpZGVuY2UgKz0gMC4xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgdHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgY29uZmlkZW5jZTogTWF0aC5taW4oY29uZmlkZW5jZSwgMS4wKSxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIGlzQXJyYXksXHJcbiAgICAgICAgICAgIGlzT2JqZWN0LFxyXG4gICAgICAgICAgICBpdGVtQ291bnQ6IGlzQXJyYXkgPyBwYXJzZWQubGVuZ3RoIDogT2JqZWN0LmtleXMocGFyc2VkKS5sZW5ndGhcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgLy8gTm90IHZhbGlkIEpTT04sIGNoZWNrIGZvciBKU09OLWxpa2UgcGF0dGVybnNcclxuICAgICAgbGV0IGNvbmZpZGVuY2UgPSAwO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgZm9yIEpTT04tbGlrZSBzdHJ1Y3R1cmUgcGF0dGVybnNcclxuICAgICAgaWYgKHRyaW1tZWQuc3RhcnRzV2l0aCgneycpICYmIHRyaW1tZWQuZW5kc1dpdGgoJ30nKSkge1xyXG4gICAgICAgIGNvbmZpZGVuY2UgKz0gMC4zO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKCdbJykgJiYgdHJpbW1lZC5lbmRzV2l0aCgnXScpKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSArPSAwLjM7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGZvciBKU09OLWxpa2Uga2V5LXZhbHVlIHBhdHRlcm5zXHJcbiAgICAgIGNvbnN0IGtleVZhbHVlUGF0dGVybiA9IC9cIlteXCJdK1wiXFxzKjpcXHMqW14sfV0rL2c7XHJcbiAgICAgIGNvbnN0IGtleVZhbHVlTWF0Y2hlcyA9ICh0cmltbWVkLm1hdGNoKGtleVZhbHVlUGF0dGVybikgfHwgW10pLmxlbmd0aDtcclxuICAgICAgXHJcbiAgICAgIGlmIChrZXlWYWx1ZU1hdGNoZXMgPiAwKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSArPSBNYXRoLm1pbihrZXlWYWx1ZU1hdGNoZXMgKiAwLjEsIDAuNCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdHlwZTogJ2pzb24nLFxyXG4gICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGNvbmZpZGVuY2UsIDAuNiksIC8vIE1heCAwLjYgZm9yIGludmFsaWQgSlNPTlxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICBpc1ZhbGlkSnNvbjogZmFsc2UsXHJcbiAgICAgICAgICBoYXNKc29uTGlrZVN0cnVjdHVyZTogY29uZmlkZW5jZSA+IDBcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7IHR5cGU6ICdqc29uJywgY29uZmlkZW5jZTogMC4wIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzVmFsaWRVcmwodGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBTaW1wbGUgVVJMIHZhbGlkYXRpb24gdXNpbmcgcmVnZXhcclxuICAgICAgY29uc3QgdXJsUGF0dGVybiA9IC9eaHR0cHM/OlxcL1xcL1teXFxzPD5cInt9fFxcXFxeYFtcXF1dKyQvO1xyXG4gICAgICByZXR1cm4gdXJsUGF0dGVybi50ZXN0KHRleHQpICYmIHRleHQuaW5jbHVkZXMoJy4nKTtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG59Il0sInZlcnNpb24iOjN9