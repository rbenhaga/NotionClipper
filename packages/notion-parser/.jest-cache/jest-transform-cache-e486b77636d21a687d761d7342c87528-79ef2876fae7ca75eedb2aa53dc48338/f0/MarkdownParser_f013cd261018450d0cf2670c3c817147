73c46664e11d36dd44675d11631e978b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MarkdownParser = void 0;
const BaseParser_1 = require("./BaseParser");
class MarkdownParser extends BaseParser_1.BaseParser {
    constructor(options = {}) {
        super(options);
    }
    parse(content) {
        if (!content?.trim())
            return [];
        const nodes = [];
        const lines = content.split('\n');
        let i = 0;
        while (i < lines.length) {
            const line = lines[i];
            const trimmed = line.trim();
            if (!trimmed) {
                i++;
                continue;
            }
            // Code blocks
            if (trimmed.startsWith('```')) {
                const { node, consumed } = this.parseCodeBlock(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Equation blocks
            if (trimmed === '$' || trimmed.startsWith('$$')) {
                const { node, consumed } = this.parseEquationBlock(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Tables
            if (trimmed.startsWith('|') && i + 1 < lines.length && lines[i + 1].includes('|')) {
                const { node, consumed } = this.parseTable(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Toggle headings (> # Heading)
            if (trimmed.match(/^>\s*#{1,3}\s+/)) {
                const { node, consumed } = this.parseToggleHeading(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Multi-line callouts
            if (trimmed.match(/^>\s*\[!(\w+)\]/)) {
                const { node, consumed } = this.parseCallout(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Toggle blocks (> content with children)
            if (trimmed.startsWith('> ') && !trimmed.match(/^>\s*\[!/) && !trimmed.match(/^>\s*#{1,3}\s+/)) {
                const { node, consumed } = this.parseToggleBlock(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Nested lists (up to 3 levels)
            if (this.isListLine(trimmed)) {
                const { nodes: listNodes, consumed } = this.parseNestedList(lines, i);
                nodes.push(...listNodes);
                i += consumed;
                continue;
            }
            // Multi-line paragraphs with soft breaks
            if (this.isParagraphStart(trimmed)) {
                const { node, consumed } = this.parseMultiLineParagraph(lines, i);
                if (node)
                    nodes.push(node);
                i += consumed;
                continue;
            }
            // Single line parsing
            const node = this.parseLine(trimmed);
            if (node)
                nodes.push(node);
            i++;
        }
        return nodes.slice(0, this.options.maxBlocks || 100);
    }
    parseLine(line) {
        // Headers
        const headerMatch = line.match(/^(#{1,3})\s+(.+)$/);
        if (headerMatch) {
            const level = headerMatch[1].length;
            return this.createHeadingNode(headerMatch[2], level);
        }
        // Images with inline content
        const imageMatch = line.match(/^!\[([^\]]*)\]\(([^)]+)\)(.*)$/);
        if (imageMatch) {
            const imageNode = this.createMediaNode('image', imageMatch[2], imageMatch[1]);
            // If there's additional content after the image, create a paragraph
            if (imageMatch[3].trim()) {
                return this.createTextNode(line); // Keep as text to preserve mixed content
            }
            return imageNode;
        }
        // Lists (will be handled by parseNestedList for proper nesting)
        const bulletMatch = line.match(/^(\s*)[-*+]\s+(.+)$/);
        if (bulletMatch) {
            return this.createListItemNode(bulletMatch[2], 'bulleted');
        }
        const numberedMatch = line.match(/^(\s*)\d+\.\s+(.+)$/);
        if (numberedMatch) {
            return this.createListItemNode(numberedMatch[2], 'numbered');
        }
        // Checkboxes
        const checkboxMatch = line.match(/^(\s*)- \[([ x])\]\s+(.+)$/);
        if (checkboxMatch) {
            return this.createListItemNode(checkboxMatch[3], 'todo', checkboxMatch[2] === 'x');
        }
        // Quotes
        if (line.startsWith('> ') && !line.match(/^>\s*\[!/)) {
            return this.createQuoteNode(line.substring(2));
        }
        // Dividers
        if (line.match(/^(---|\*\*\*|___)$/)) {
            return this.createDividerNode();
        }
        // URLs
        if (this.isValidUrl(line)) {
            return this.createBookmarkNode(line);
        }
        // HTML inline handling
        if (line.includes('<') && line.includes('>')) {
            return this.parseHtmlInline(line);
        }
        // Regular paragraph
        return this.createTextNode(line);
    }
    parseCodeBlock(lines, startIdx) {
        const firstLine = lines[startIdx];
        const language = firstLine.replace('```', '').trim() || 'plain text';
        const codeLines = [];
        let i = startIdx + 1;
        while (i < lines.length && !lines[i].trim().startsWith('```')) {
            codeLines.push(lines[i]);
            i++;
        }
        if (i >= lines.length) {
            // No closing ```, treat as text
            return { node: this.createTextNode(firstLine), consumed: 1 };
        }
        const code = codeLines.join('\n');
        const truncatedCode = this.truncateContent(code, this.options.maxCodeLength || 2000);
        return {
            node: this.createCodeNode(truncatedCode, language, true),
            consumed: i - startIdx + 1
        };
    }
    parseEquationBlock(lines, startIdx) {
        const firstLine = lines[startIdx];
        // Handle $$equation$$ single line
        if (firstLine.startsWith('$$') && firstLine.endsWith('$$') && firstLine.length > 4) {
            const expression = firstLine.slice(2, -2).trim();
            return {
                node: this.createEquationNode(expression, true),
                consumed: 1
            };
        }
        // Handle multi-line $ or $$
        const equationLines = [];
        let i = startIdx + 1;
        const delimiter = firstLine.startsWith('$$') ? '$$' : '$';
        while (i < lines.length && lines[i].trim() !== delimiter) {
            equationLines.push(lines[i]);
            i++;
        }
        if (i >= lines.length) {
            // No closing delimiter, treat as text
            return { node: this.createTextNode(firstLine), consumed: 1 };
        }
        const expression = equationLines.join('\n').trim();
        if (!expression) {
            return { node: null, consumed: i - startIdx + 1 };
        }
        return {
            node: this.createEquationNode(expression, true),
            consumed: i - startIdx + 1
        };
    }
    parseTable(lines, startIdx) {
        const tableLines = [];
        let i = startIdx;
        // Collect all table lines
        while (i < lines.length && lines[i].trim().startsWith('|')) {
            tableLines.push(lines[i]);
            i++;
        }
        if (tableLines.length < 2) {
            return { node: null, consumed: 1 };
        }
        // Parse headers
        const headers = this.parseTableRow(tableLines[0]);
        // Check for separator line
        let dataStartIndex = 1;
        if (tableLines.length > 1 && this.isTableSeparator(tableLines[1])) {
            dataStartIndex = 2;
        }
        // Parse data rows
        const rows = tableLines.slice(dataStartIndex).map(line => this.parseTableRow(line));
        // Normalize row lengths
        const maxColumns = Math.max(headers.length, ...rows.map(row => row.length));
        const normalizedHeaders = this.normalizeTableRow(headers, maxColumns);
        const normalizedRows = rows.map(row => this.normalizeTableRow(row, maxColumns));
        return {
            node: this.createTableNode(normalizedHeaders, normalizedRows),
            consumed: i - startIdx
        };
    }
    parseTableRow(line) {
        // Remove leading/trailing pipes and split
        const trimmed = line.trim();
        const withoutOuterPipes = trimmed.startsWith('|') ? trimmed.slice(1) : trimmed;
        const withoutTrailingPipe = withoutOuterPipes.endsWith('|')
            ? withoutOuterPipes.slice(0, -1)
            : withoutOuterPipes;
        return withoutTrailingPipe
            .split('|')
            .map(cell => cell.trim());
    }
    isTableSeparator(line) {
        const trimmed = line.trim();
        return /^[\|\-:\s]+$/.test(trimmed) && trimmed.includes('-');
    }
    normalizeTableRow(row, targetLength) {
        const normalized = [...row];
        // Pad with empty strings if too short
        while (normalized.length < targetLength) {
            normalized.push('');
        }
        // Truncate if too long
        if (normalized.length > targetLength) {
            normalized.length = targetLength;
        }
        return normalized;
    }
    parseToggleHeading(lines, startIdx) {
        const firstLine = lines[startIdx];
        const match = firstLine.match(/^>\s*(#{1,3})\s+(.+)$/);
        if (!match)
            return { node: null, consumed: 1 };
        const level = match[1].length;
        const title = match[2];
        const children = [];
        let i = startIdx + 1;
        // Parse toggle content (lines starting with >)
        while (i < lines.length) {
            const line = lines[i].trim();
            if (line.startsWith('>')) {
                // Remove > prefix and parse as normal content
                const content = line.substring(1).trim();
                if (content) {
                    // Recursively parse the content
                    const contentNodes = this.parse(content);
                    children.push(...contentNodes);
                }
                i++;
            }
            else if (!line) {
                // Empty line within toggle
                i++;
            }
            else {
                // End of toggle
                break;
            }
        }
        return {
            node: this.createToggleHeadingNode(title, level, children),
            consumed: i - startIdx
        };
    }
    parseToggleBlock(lines, startIdx) {
        const firstLine = lines[startIdx];
        const content = firstLine.substring(2).trim(); // Remove "> "
        if (!content)
            return { node: null, consumed: 1 };
        const children = [];
        let i = startIdx + 1;
        // Parse toggle content (lines starting with >)
        while (i < lines.length) {
            const line = lines[i].trim();
            if (line.startsWith('>')) {
                // Remove > prefix and parse as normal content
                const childContent = line.substring(1).trim();
                if (childContent) {
                    // Recursively parse the content
                    const contentNodes = this.parse(childContent);
                    children.push(...contentNodes);
                }
                i++;
            }
            else if (!line) {
                // Empty line within toggle
                i++;
            }
            else {
                // End of toggle
                break;
            }
        }
        // If no children, treat as a simple quote
        if (children.length === 0) {
            return { node: this.createQuoteNode(content), consumed: 1 };
        }
        return {
            node: this.createToggleNode(content, children),
            consumed: i - startIdx
        };
    }
    parseCallout(lines, startIdx) {
        const firstLine = lines[startIdx];
        const match = firstLine.match(/^>\s*\[!(\w+)\]\s*(.*)$/);
        if (!match)
            return { node: null, consumed: 1 };
        const iconName = match[1].toLowerCase();
        const firstContent = match[2] || '';
        const contentLines = [firstContent];
        let i = startIdx + 1;
        // Parse multi-line callout content
        while (i < lines.length) {
            const line = lines[i].trim();
            if (line.startsWith('>')) {
                // Check if this is a new callout
                if (line.match(/^>\s*\[!(\w+)\]/)) {
                    // This is a new callout, stop parsing current one
                    break;
                }
                // Continue callout content
                const content = line.substring(1).trim();
                contentLines.push(content);
                i++;
            }
            else if (!line) {
                // Empty line within callout
                contentLines.push('');
                i++;
            }
            else {
                // End of callout
                break;
            }
        }
        const content = contentLines.filter(l => l !== '').join('\n');
        const icon = this.getCalloutIcon(iconName);
        const color = this.getCalloutColor(iconName);
        return {
            node: this.createCalloutNode(content, icon, color),
            consumed: i - startIdx
        };
    }
    isListLine(line) {
        return /^(\s*)[-*+]\s+/.test(line) ||
            /^(\s*)\d+\.\s+/.test(line) ||
            /^(\s*)- \[([ x])\]\s+/.test(line);
    }
    parseNestedList(lines, startIdx) {
        const listItems = [];
        let i = startIdx;
        while (i < lines.length) {
            const line = lines[i];
            const trimmed = line.trim();
            if (!this.isListLine(trimmed)) {
                break;
            }
            const level = this.getIndentationLevel(line);
            const listItem = this.parseListItem(trimmed);
            if (listItem) {
                listItems.push({
                    node: listItem.node,
                    level,
                    type: listItem.type
                });
            }
            i++;
        }
        // Convert flat list to nested structure
        const nestedNodes = this.buildNestedListStructure(listItems);
        return {
            nodes: nestedNodes,
            consumed: i - startIdx
        };
    }
    getIndentationLevel(line) {
        const match = line.match(/^(\s*)/);
        const spaces = match ? match[1].length : 0;
        return Math.floor(spaces / 2); // 2 spaces = 1 level
    }
    parseListItem(line) {
        // Checkbox
        const checkboxMatch = line.match(/^(\s*)- \[([ x])\]\s+(.+)$/);
        if (checkboxMatch) {
            return {
                node: this.createListItemNode(checkboxMatch[3], 'todo', checkboxMatch[2] === 'x'),
                type: 'todo'
            };
        }
        // Bulleted list
        const bulletMatch = line.match(/^(\s*)[-*+]\s+(.+)$/);
        if (bulletMatch) {
            return {
                node: this.createListItemNode(bulletMatch[2], 'bulleted'),
                type: 'bulleted'
            };
        }
        // Numbered list
        const numberedMatch = line.match(/^(\s*)\d+\.\s+(.+)$/);
        if (numberedMatch) {
            return {
                node: this.createListItemNode(numberedMatch[2], 'numbered'),
                type: 'numbered'
            };
        }
        return null;
    }
    buildNestedListStructure(items) {
        if (items.length === 0)
            return [];
        const result = [];
        const stack = [];
        for (const item of items) {
            // Pop items from stack that are at same or higher level
            while (stack.length > 0 && stack[stack.length - 1].level >= item.level) {
                const popped = stack.pop();
                if (popped.children.length > 0) {
                    popped.node.children = popped.children;
                }
                if (stack.length > 0) {
                    stack[stack.length - 1].children.push(popped.node);
                }
                else {
                    result.push(popped.node);
                }
            }
            // Add current item to stack
            stack.push({
                node: item.node,
                level: item.level,
                children: []
            });
        }
        // Pop remaining items from stack
        while (stack.length > 0) {
            const popped = stack.pop();
            if (popped.children.length > 0) {
                popped.node.children = popped.children;
            }
            if (stack.length > 0) {
                stack[stack.length - 1].children.push(popped.node);
            }
            else {
                result.push(popped.node);
            }
        }
        return result;
    }
    isParagraphStart(line) {
        // Not a special markdown element
        return !line.match(/^(#{1,3}\s|[-*+]\s|\d+\.\s|>\s|\|.*\||```|---|\*\*\*|___|!\[)/);
    }
    parseMultiLineParagraph(lines, startIdx) {
        const paragraphLines = [];
        let i = startIdx;
        while (i < lines.length) {
            const line = lines[i];
            const trimmed = line.trim();
            // Empty line ends paragraph
            if (!trimmed) {
                break;
            }
            // Special markdown elements end paragraph
            if (this.isSpecialMarkdownLine(trimmed)) {
                break;
            }
            paragraphLines.push(line);
            i++;
        }
        if (paragraphLines.length === 0) {
            return { node: null, consumed: 1 };
        }
        // Join lines with soft breaks (spaces)
        const content = paragraphLines.join(' ');
        return {
            node: this.createTextNode(content),
            consumed: i - startIdx
        };
    }
    isSpecialMarkdownLine(line) {
        return /^(#{1,3}\s|[-*+]\s|\d+\.\s|>\s|\|.*\||```|---|\*\*\*|___|!\[)/.test(line);
    }
    parseHtmlInline(line) {
        // Simple HTML tag removal for now
        // In a more complete implementation, you'd parse HTML properly
        const cleanText = line.replace(/<[^>]*>/g, '');
        return this.createTextNode(cleanText);
    }
    getCalloutIcon(name) {
        const icons = {
            'note': 'üìù',
            'info': '‚ÑπÔ∏è',
            'tip': 'üí°',
            'warning': '‚ö†Ô∏è',
            'danger': 'üö®',
            'success': '‚úÖ',
            'question': '‚ùì',
            'quote': 'üí¨',
            'example': 'üìå',
            'bug': 'üêõ',
            'todo': '‚òëÔ∏è',
            'abstract': 'üìÑ',
            'summary': 'üìã',
            'tldr': 'üìã',
            'failure': '‚ùå',
            'fail': '‚ùå',
            'missing': '‚ùì',
            'check': '‚úÖ',
            'done': '‚úÖ'
        };
        return icons[name] || 'üí°';
    }
    getCalloutColor(name) {
        const colors = {
            'note': 'blue_background',
            'info': 'blue_background',
            'tip': 'green_background',
            'warning': 'yellow_background',
            'danger': 'red_background',
            'success': 'green_background',
            'question': 'purple_background',
            'quote': 'gray_background',
            'example': 'blue_background',
            'bug': 'red_background',
            'todo': 'blue_background',
            'abstract': 'purple_background',
            'summary': 'purple_background',
            'tldr': 'purple_background',
            'failure': 'red_background',
            'fail': 'red_background',
            'missing': 'yellow_background',
            'check': 'green_background',
            'done': 'green_background'
        };
        return colors[name] || 'gray_background';
    }
    /**
     * Enhanced list parsing with better nesting support
     */
    static parseMarkdownList(content) {
        const parser = new MarkdownParser();
        const lines = content.split('\n');
        const { nodes } = parser.parseNestedList(lines, 0);
        return nodes;
    }
    /**
     * Parse markdown tables with advanced features
     */
    static parseMarkdownTable(content) {
        const parser = new MarkdownParser();
        const lines = content.split('\n');
        const { node } = parser.parseTable(lines, 0);
        return node;
    }
}
exports.MarkdownParser = MarkdownParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcc3JjXFxwYXJzZXJzXFxNYXJrZG93blBhcnNlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw2Q0FBMEM7QUFHMUMsTUFBYSxjQUFlLFNBQVEsdUJBQVU7SUFDNUMsWUFBWSxVQUF3QixFQUFFO1FBQ3BDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQWU7UUFDbkIsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUU7WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUVoQyxNQUFNLEtBQUssR0FBYyxFQUFFLENBQUM7UUFDNUIsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFVixPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUU1QixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2IsQ0FBQyxFQUFFLENBQUM7Z0JBQ0osU0FBUztZQUNYLENBQUM7WUFFRCxjQUFjO1lBQ2QsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzlCLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pELElBQUksSUFBSTtvQkFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMzQixDQUFDLElBQUksUUFBUSxDQUFDO2dCQUNkLFNBQVM7WUFDWCxDQUFDO1lBRUQsa0JBQWtCO1lBQ2xCLElBQUksT0FBTyxLQUFLLEdBQUcsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQ2hELE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDN0QsSUFBSSxJQUFJO29CQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNCLENBQUMsSUFBSSxRQUFRLENBQUM7Z0JBQ2QsU0FBUztZQUNYLENBQUM7WUFFRCxTQUFTO1lBQ1QsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNsRixNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNyRCxJQUFJLElBQUk7b0JBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDM0IsQ0FBQyxJQUFJLFFBQVEsQ0FBQztnQkFDZCxTQUFTO1lBQ1gsQ0FBQztZQUVELGdDQUFnQztZQUNoQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzdELElBQUksSUFBSTtvQkFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMzQixDQUFDLElBQUksUUFBUSxDQUFDO2dCQUNkLFNBQVM7WUFDWCxDQUFDO1lBRUQsc0JBQXNCO1lBQ3RCLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELElBQUksSUFBSTtvQkFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMzQixDQUFDLElBQUksUUFBUSxDQUFDO2dCQUNkLFNBQVM7WUFDWCxDQUFDO1lBRUQsMENBQTBDO1lBQzFDLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztnQkFDL0YsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUMzRCxJQUFJLElBQUk7b0JBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDM0IsQ0FBQyxJQUFJLFFBQVEsQ0FBQztnQkFDZCxTQUFTO1lBQ1gsQ0FBQztZQUVELGdDQUFnQztZQUNoQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDN0IsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RFLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQztnQkFDekIsQ0FBQyxJQUFJLFFBQVEsQ0FBQztnQkFDZCxTQUFTO1lBQ1gsQ0FBQztZQUVELHlDQUF5QztZQUN6QyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNuQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xFLElBQUksSUFBSTtvQkFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMzQixDQUFDLElBQUksUUFBUSxDQUFDO2dCQUNkLFNBQVM7WUFDWCxDQUFDO1lBRUQsc0JBQXNCO1lBQ3RCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckMsSUFBSSxJQUFJO2dCQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFM0IsQ0FBQyxFQUFFLENBQUM7UUFDTixDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsSUFBSSxHQUFHLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRU8sU0FBUyxDQUFDLElBQVk7UUFDNUIsVUFBVTtRQUNWLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUNwRCxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ2hCLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFtQixDQUFDO1lBQ2pELE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RCxDQUFDO1FBRUQsNkJBQTZCO1FBQzdCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUNoRSxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQ2YsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTlFLG9FQUFvRTtZQUNwRSxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO2dCQUN6QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx5Q0FBeUM7WUFDN0UsQ0FBQztZQUVELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7UUFFRCxnRUFBZ0U7UUFDaEUsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3RELElBQUksV0FBVyxFQUFFLENBQUM7WUFDaEIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDeEQsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUVELGFBQWE7UUFDYixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFDL0QsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBRUQsU0FBUztRQUNULElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNyRCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pELENBQUM7UUFFRCxXQUFXO1FBQ1gsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztZQUNyQyxPQUFPLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ2xDLENBQUM7UUFFRCxPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDMUIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsQ0FBQztRQUVELHVCQUF1QjtRQUN2QixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzdDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQyxDQUFDO1FBRUQsb0JBQW9CO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRU8sY0FBYyxDQUFDLEtBQWUsRUFBRSxRQUFnQjtRQUN0RCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksWUFBWSxDQUFDO1FBQ3JFLE1BQU0sU0FBUyxHQUFhLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRXJCLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDOUQsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixDQUFDLEVBQUUsQ0FBQztRQUNOLENBQUM7UUFFRCxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDdEIsZ0NBQWdDO1lBQ2hDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDL0QsQ0FBQztRQUVELE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLENBQUM7UUFFckYsT0FBTztZQUNMLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDO1lBQ3hELFFBQVEsRUFBRSxDQUFDLEdBQUcsUUFBUSxHQUFHLENBQUM7U0FDM0IsQ0FBQztJQUNKLENBQUM7SUFFTyxrQkFBa0IsQ0FBQyxLQUFlLEVBQUUsUUFBZ0I7UUFDMUQsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWxDLGtDQUFrQztRQUNsQyxJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ25GLE1BQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDakQsT0FBTztnQkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUM7Z0JBQy9DLFFBQVEsRUFBRSxDQUFDO2FBQ1osQ0FBQztRQUNKLENBQUM7UUFFRCw0QkFBNEI7UUFDNUIsTUFBTSxhQUFhLEdBQWEsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxHQUFHLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFDckIsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFFMUQsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDekQsYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QixDQUFDLEVBQUUsQ0FBQztRQUNOLENBQUM7UUFFRCxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDdEIsc0NBQXNDO1lBQ3RDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDL0QsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFbkQsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2hCLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsUUFBUSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ3BELENBQUM7UUFFRCxPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDO1lBQy9DLFFBQVEsRUFBRSxDQUFDLEdBQUcsUUFBUSxHQUFHLENBQUM7U0FDM0IsQ0FBQztJQUNKLENBQUM7SUFFTyxVQUFVLENBQUMsS0FBZSxFQUFFLFFBQWdCO1FBQ2xELE1BQU0sVUFBVSxHQUFhLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUM7UUFFakIsMEJBQTBCO1FBQzFCLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNELFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsQ0FBQyxFQUFFLENBQUM7UUFDTixDQUFDO1FBRUQsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzFCLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNyQyxDQUFDO1FBRUQsZ0JBQWdCO1FBQ2hCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbEQsMkJBQTJCO1FBQzNCLElBQUksY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN2QixJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ2xFLGNBQWMsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUVELGtCQUFrQjtRQUNsQixNQUFNLElBQUksR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVwRix3QkFBd0I7UUFDeEIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN0RSxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBRWhGLE9BQU87WUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRSxjQUFjLENBQUM7WUFDN0QsUUFBUSxFQUFFLENBQUMsR0FBRyxRQUFRO1NBQ3ZCLENBQUM7SUFDSixDQUFDO0lBRU8sYUFBYSxDQUFDLElBQVk7UUFDaEMsMENBQTBDO1FBQzFDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM1QixNQUFNLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUMvRSxNQUFNLG1CQUFtQixHQUFHLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUM7WUFDekQsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDO1FBRXRCLE9BQU8sbUJBQW1CO2FBQ3ZCLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDVixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRU8sZ0JBQWdCLENBQUMsSUFBWTtRQUNuQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDNUIsT0FBTyxjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVPLGlCQUFpQixDQUFDLEdBQWEsRUFBRSxZQUFvQjtRQUMzRCxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFFNUIsc0NBQXNDO1FBQ3RDLE9BQU8sVUFBVSxDQUFDLE1BQU0sR0FBRyxZQUFZLEVBQUUsQ0FBQztZQUN4QyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RCLENBQUM7UUFFRCx1QkFBdUI7UUFDdkIsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBQ3JDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsWUFBWSxDQUFDO1FBQ25DLENBQUM7UUFFRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBRU8sa0JBQWtCLENBQUMsS0FBZSxFQUFFLFFBQWdCO1FBQzFELE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFFdkQsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFFL0MsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQW1CLENBQUM7UUFDM0MsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZCLE1BQU0sUUFBUSxHQUFjLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRXJCLCtDQUErQztRQUMvQyxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBRTdCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUN6Qiw4Q0FBOEM7Z0JBQzlDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3pDLElBQUksT0FBTyxFQUFFLENBQUM7b0JBQ1osZ0NBQWdDO29CQUNoQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUN6QyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7Z0JBQ0QsQ0FBQyxFQUFFLENBQUM7WUFDTixDQUFDO2lCQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDakIsMkJBQTJCO2dCQUMzQixDQUFDLEVBQUUsQ0FBQztZQUNOLENBQUM7aUJBQU0sQ0FBQztnQkFDTixnQkFBZ0I7Z0JBQ2hCLE1BQU07WUFDUixDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU87WUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDO1lBQzFELFFBQVEsRUFBRSxDQUFDLEdBQUcsUUFBUTtTQUN2QixDQUFDO0lBQ0osQ0FBQztJQUVPLGdCQUFnQixDQUFDLEtBQWUsRUFBRSxRQUFnQjtRQUN4RCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLGNBQWM7UUFFN0QsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFFakQsTUFBTSxRQUFRLEdBQWMsRUFBRSxDQUFDO1FBQy9CLElBQUksQ0FBQyxHQUFHLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFFckIsK0NBQStDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN4QixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFN0IsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3pCLDhDQUE4QztnQkFDOUMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDOUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztvQkFDakIsZ0NBQWdDO29CQUNoQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUM5QyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7Z0JBQ0QsQ0FBQyxFQUFFLENBQUM7WUFDTixDQUFDO2lCQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDakIsMkJBQTJCO2dCQUMzQixDQUFDLEVBQUUsQ0FBQztZQUNOLENBQUM7aUJBQU0sQ0FBQztnQkFDTixnQkFBZ0I7Z0JBQ2hCLE1BQU07WUFDUixDQUFDO1FBQ0gsQ0FBQztRQUVELDBDQUEwQztRQUMxQyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDMUIsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUM5RCxDQUFDO1FBRUQsT0FBTztZQUNMLElBQUksRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQztZQUM5QyxRQUFRLEVBQUUsQ0FBQyxHQUFHLFFBQVE7U0FDdkIsQ0FBQztJQUNKLENBQUM7SUFFTyxZQUFZLENBQUMsS0FBZSxFQUFFLFFBQWdCO1FBQ3BELE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFFekQsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFFL0MsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3hDLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFcEMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNwQyxJQUFJLENBQUMsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRXJCLG1DQUFtQztRQUNuQyxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBRTdCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUN6QixpQ0FBaUM7Z0JBQ2pDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUM7b0JBQ2xDLGtEQUFrRDtvQkFDbEQsTUFBTTtnQkFDUixDQUFDO2dCQUVELDJCQUEyQjtnQkFDM0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDekMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDM0IsQ0FBQyxFQUFFLENBQUM7WUFDTixDQUFDO2lCQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDakIsNEJBQTRCO2dCQUM1QixZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN0QixDQUFDLEVBQUUsQ0FBQztZQUNOLENBQUM7aUJBQU0sQ0FBQztnQkFDTixpQkFBaUI7Z0JBQ2pCLE1BQU07WUFDUixDQUFDO1FBQ0gsQ0FBQztRQUVELE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0MsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU3QyxPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQztZQUNsRCxRQUFRLEVBQUUsQ0FBQyxHQUFHLFFBQVE7U0FDdkIsQ0FBQztJQUNKLENBQUM7SUFFTyxVQUFVLENBQUMsSUFBWTtRQUM3QixPQUFPLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDaEMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMzQix1QkFBdUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVPLGVBQWUsQ0FBQyxLQUFlLEVBQUUsUUFBZ0I7UUFDdkQsTUFBTSxTQUFTLEdBQTBELEVBQUUsQ0FBQztRQUM1RSxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUM7UUFFakIsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsTUFBTTtZQUNSLENBQUM7WUFFRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUU3QyxJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUNiLFNBQVMsQ0FBQyxJQUFJLENBQUM7b0JBQ2IsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJO29CQUNuQixLQUFLO29CQUNMLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSTtpQkFDcEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELENBQUMsRUFBRSxDQUFDO1FBQ04sQ0FBQztRQUVELHdDQUF3QztRQUN4QyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFN0QsT0FBTztZQUNMLEtBQUssRUFBRSxXQUFXO1lBQ2xCLFFBQVEsRUFBRSxDQUFDLEdBQUcsUUFBUTtTQUN2QixDQUFDO0lBQ0osQ0FBQztJQUVPLG1CQUFtQixDQUFDLElBQVk7UUFDdEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNuQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMscUJBQXFCO0lBQ3RELENBQUM7SUFFTyxhQUFhLENBQUMsSUFBWTtRQUNoQyxXQUFXO1FBQ1gsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1FBQy9ELElBQUksYUFBYSxFQUFFLENBQUM7WUFDbEIsT0FBTztnQkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQztnQkFDakYsSUFBSSxFQUFFLE1BQU07YUFDYixDQUFDO1FBQ0osQ0FBQztRQUVELGdCQUFnQjtRQUNoQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdEQsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNoQixPQUFPO2dCQUNMLElBQUksRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQztnQkFDekQsSUFBSSxFQUFFLFVBQVU7YUFDakIsQ0FBQztRQUNKLENBQUM7UUFFRCxnQkFBZ0I7UUFDaEIsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3hELElBQUksYUFBYSxFQUFFLENBQUM7WUFDbEIsT0FBTztnQkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUM7Z0JBQzNELElBQUksRUFBRSxVQUFVO2FBQ2pCLENBQUM7UUFDSixDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU8sd0JBQXdCLENBQUMsS0FBNEQ7UUFDM0YsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUVsQyxNQUFNLE1BQU0sR0FBYyxFQUFFLENBQUM7UUFDN0IsTUFBTSxLQUFLLEdBQWlFLEVBQUUsQ0FBQztRQUUvRSxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ3pCLHdEQUF3RDtZQUN4RCxPQUFPLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3ZFLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUcsQ0FBQztnQkFDNUIsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDOUIsTUFBTSxDQUFDLElBQVksQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztnQkFDbEQsQ0FBQztnQkFFRCxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ3JCLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNyRCxDQUFDO3FCQUFNLENBQUM7b0JBQ04sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNCLENBQUM7WUFDSCxDQUFDO1lBRUQsNEJBQTRCO1lBQzVCLEtBQUssQ0FBQyxJQUFJLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsUUFBUSxFQUFFLEVBQUU7YUFDYixDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsaUNBQWlDO1FBQ2pDLE9BQU8sS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN4QixNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsR0FBRyxFQUFHLENBQUM7WUFDNUIsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxDQUFDLElBQVksQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUNsRCxDQUFDO1lBRUQsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNyQixLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyRCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRU8sZ0JBQWdCLENBQUMsSUFBWTtRQUNuQyxpQ0FBaUM7UUFDakMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsK0RBQStELENBQUMsQ0FBQztJQUN0RixDQUFDO0lBRU8sdUJBQXVCLENBQUMsS0FBZSxFQUFFLFFBQWdCO1FBQy9ELE1BQU0sY0FBYyxHQUFhLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUM7UUFFakIsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFNUIsNEJBQTRCO1lBQzVCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDYixNQUFNO1lBQ1IsQ0FBQztZQUVELDBDQUEwQztZQUMxQyxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUN4QyxNQUFNO1lBQ1IsQ0FBQztZQUVELGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsQ0FBQyxFQUFFLENBQUM7UUFDTixDQUFDO1FBRUQsSUFBSSxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ2hDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNyQyxDQUFDO1FBRUQsdUNBQXVDO1FBQ3ZDLE1BQU0sT0FBTyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFekMsT0FBTztZQUNMLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztZQUNsQyxRQUFRLEVBQUUsQ0FBQyxHQUFHLFFBQVE7U0FDdkIsQ0FBQztJQUNKLENBQUM7SUFFTyxxQkFBcUIsQ0FBQyxJQUFZO1FBQ3hDLE9BQU8sK0RBQStELENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BGLENBQUM7SUFFTyxlQUFlLENBQUMsSUFBWTtRQUNsQyxrQ0FBa0M7UUFDbEMsK0RBQStEO1FBQy9ELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU8sY0FBYyxDQUFDLElBQVk7UUFDakMsTUFBTSxLQUFLLEdBQTJCO1lBQ3BDLE1BQU0sRUFBRSxJQUFJO1lBQ1osTUFBTSxFQUFFLElBQUk7WUFDWixLQUFLLEVBQUUsSUFBSTtZQUNYLFNBQVMsRUFBRSxJQUFJO1lBQ2YsUUFBUSxFQUFFLElBQUk7WUFDZCxTQUFTLEVBQUUsR0FBRztZQUNkLFVBQVUsRUFBRSxHQUFHO1lBQ2YsT0FBTyxFQUFFLElBQUk7WUFDYixTQUFTLEVBQUUsSUFBSTtZQUNmLEtBQUssRUFBRSxJQUFJO1lBQ1gsTUFBTSxFQUFFLElBQUk7WUFDWixVQUFVLEVBQUUsSUFBSTtZQUNoQixTQUFTLEVBQUUsSUFBSTtZQUNmLE1BQU0sRUFBRSxJQUFJO1lBQ1osU0FBUyxFQUFFLEdBQUc7WUFDZCxNQUFNLEVBQUUsR0FBRztZQUNYLFNBQVMsRUFBRSxHQUFHO1lBQ2QsT0FBTyxFQUFFLEdBQUc7WUFDWixNQUFNLEVBQUUsR0FBRztTQUNaLENBQUM7UUFDRixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDN0IsQ0FBQztJQUVPLGVBQWUsQ0FBQyxJQUFZO1FBQ2xDLE1BQU0sTUFBTSxHQUEyQjtZQUNyQyxNQUFNLEVBQUUsaUJBQWlCO1lBQ3pCLE1BQU0sRUFBRSxpQkFBaUI7WUFDekIsS0FBSyxFQUFFLGtCQUFrQjtZQUN6QixTQUFTLEVBQUUsbUJBQW1CO1lBQzlCLFFBQVEsRUFBRSxnQkFBZ0I7WUFDMUIsU0FBUyxFQUFFLGtCQUFrQjtZQUM3QixVQUFVLEVBQUUsbUJBQW1CO1lBQy9CLE9BQU8sRUFBRSxpQkFBaUI7WUFDMUIsU0FBUyxFQUFFLGlCQUFpQjtZQUM1QixLQUFLLEVBQUUsZ0JBQWdCO1lBQ3ZCLE1BQU0sRUFBRSxpQkFBaUI7WUFDekIsVUFBVSxFQUFFLG1CQUFtQjtZQUMvQixTQUFTLEVBQUUsbUJBQW1CO1lBQzlCLE1BQU0sRUFBRSxtQkFBbUI7WUFDM0IsU0FBUyxFQUFFLGdCQUFnQjtZQUMzQixNQUFNLEVBQUUsZ0JBQWdCO1lBQ3hCLFNBQVMsRUFBRSxtQkFBbUI7WUFDOUIsT0FBTyxFQUFFLGtCQUFrQjtZQUMzQixNQUFNLEVBQUUsa0JBQWtCO1NBQzNCLENBQUM7UUFDRixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxpQkFBaUIsQ0FBQztJQUMzQyxDQUFDO0lBSUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsaUJBQWlCLENBQUMsT0FBZTtRQUN0QyxNQUFNLE1BQU0sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3BDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE9BQWU7UUFDdkMsTUFBTSxNQUFNLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztRQUNwQyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3QyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDRjtBQTNwQkQsd0NBMnBCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHJheWFuXFxEZXNrdG9wXFxEZXZcXE5vdGlvbkNsaXBwZXJcXHBhY2thZ2VzXFxub3Rpb24tcGFyc2VyXFxzcmNcXHBhcnNlcnNcXE1hcmtkb3duUGFyc2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VQYXJzZXIgfSBmcm9tICcuL0Jhc2VQYXJzZXInO1xyXG5pbXBvcnQgdHlwZSB7IEFTVE5vZGUsIFBhcnNlT3B0aW9ucyB9IGZyb20gJy4uL3R5cGVzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBNYXJrZG93blBhcnNlciBleHRlbmRzIEJhc2VQYXJzZXIge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IFBhcnNlT3B0aW9ucyA9IHt9KSB7XHJcbiAgICBzdXBlcihvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHBhcnNlKGNvbnRlbnQ6IHN0cmluZyk6IEFTVE5vZGVbXSB7XHJcbiAgICBpZiAoIWNvbnRlbnQ/LnRyaW0oKSkgcmV0dXJuIFtdO1xyXG5cclxuICAgIGNvbnN0IG5vZGVzOiBBU1ROb2RlW10gPSBbXTtcclxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xyXG4gICAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XHJcblxyXG4gICAgICBpZiAoIXRyaW1tZWQpIHtcclxuICAgICAgICBpKys7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENvZGUgYmxvY2tzXHJcbiAgICAgIGlmICh0cmltbWVkLnN0YXJ0c1dpdGgoJ2BgYCcpKSB7XHJcbiAgICAgICAgY29uc3QgeyBub2RlLCBjb25zdW1lZCB9ID0gdGhpcy5wYXJzZUNvZGVCbG9jayhsaW5lcywgaSk7XHJcbiAgICAgICAgaWYgKG5vZGUpIG5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgaSArPSBjb25zdW1lZDtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRXF1YXRpb24gYmxvY2tzXHJcbiAgICAgIGlmICh0cmltbWVkID09PSAnJCcgfHwgdHJpbW1lZC5zdGFydHNXaXRoKCckJCcpKSB7XHJcbiAgICAgICAgY29uc3QgeyBub2RlLCBjb25zdW1lZCB9ID0gdGhpcy5wYXJzZUVxdWF0aW9uQmxvY2sobGluZXMsIGkpO1xyXG4gICAgICAgIGlmIChub2RlKSBub2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgIGkgKz0gY29uc3VtZWQ7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRhYmxlc1xyXG4gICAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKCd8JykgJiYgaSArIDEgPCBsaW5lcy5sZW5ndGggJiYgbGluZXNbaSArIDFdLmluY2x1ZGVzKCd8JykpIHtcclxuICAgICAgICBjb25zdCB7IG5vZGUsIGNvbnN1bWVkIH0gPSB0aGlzLnBhcnNlVGFibGUobGluZXMsIGkpO1xyXG4gICAgICAgIGlmIChub2RlKSBub2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgIGkgKz0gY29uc3VtZWQ7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRvZ2dsZSBoZWFkaW5ncyAoPiAjIEhlYWRpbmcpXHJcbiAgICAgIGlmICh0cmltbWVkLm1hdGNoKC9ePlxccyojezEsM31cXHMrLykpIHtcclxuICAgICAgICBjb25zdCB7IG5vZGUsIGNvbnN1bWVkIH0gPSB0aGlzLnBhcnNlVG9nZ2xlSGVhZGluZyhsaW5lcywgaSk7XHJcbiAgICAgICAgaWYgKG5vZGUpIG5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgaSArPSBjb25zdW1lZDtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTXVsdGktbGluZSBjYWxsb3V0c1xyXG4gICAgICBpZiAodHJpbW1lZC5tYXRjaCgvXj5cXHMqXFxbIShcXHcrKVxcXS8pKSB7XHJcbiAgICAgICAgY29uc3QgeyBub2RlLCBjb25zdW1lZCB9ID0gdGhpcy5wYXJzZUNhbGxvdXQobGluZXMsIGkpO1xyXG4gICAgICAgIGlmIChub2RlKSBub2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgIGkgKz0gY29uc3VtZWQ7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRvZ2dsZSBibG9ja3MgKD4gY29udGVudCB3aXRoIGNoaWxkcmVuKVxyXG4gICAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKCc+ICcpICYmICF0cmltbWVkLm1hdGNoKC9ePlxccypcXFshLykgJiYgIXRyaW1tZWQubWF0Y2goL14+XFxzKiN7MSwzfVxccysvKSkge1xyXG4gICAgICAgIGNvbnN0IHsgbm9kZSwgY29uc3VtZWQgfSA9IHRoaXMucGFyc2VUb2dnbGVCbG9jayhsaW5lcywgaSk7XHJcbiAgICAgICAgaWYgKG5vZGUpIG5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgaSArPSBjb25zdW1lZDtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTmVzdGVkIGxpc3RzICh1cCB0byAzIGxldmVscylcclxuICAgICAgaWYgKHRoaXMuaXNMaXN0TGluZSh0cmltbWVkKSkge1xyXG4gICAgICAgIGNvbnN0IHsgbm9kZXM6IGxpc3ROb2RlcywgY29uc3VtZWQgfSA9IHRoaXMucGFyc2VOZXN0ZWRMaXN0KGxpbmVzLCBpKTtcclxuICAgICAgICBub2Rlcy5wdXNoKC4uLmxpc3ROb2Rlcyk7XHJcbiAgICAgICAgaSArPSBjb25zdW1lZDtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTXVsdGktbGluZSBwYXJhZ3JhcGhzIHdpdGggc29mdCBicmVha3NcclxuICAgICAgaWYgKHRoaXMuaXNQYXJhZ3JhcGhTdGFydCh0cmltbWVkKSkge1xyXG4gICAgICAgIGNvbnN0IHsgbm9kZSwgY29uc3VtZWQgfSA9IHRoaXMucGFyc2VNdWx0aUxpbmVQYXJhZ3JhcGgobGluZXMsIGkpO1xyXG4gICAgICAgIGlmIChub2RlKSBub2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgIGkgKz0gY29uc3VtZWQ7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNpbmdsZSBsaW5lIHBhcnNpbmdcclxuICAgICAgY29uc3Qgbm9kZSA9IHRoaXMucGFyc2VMaW5lKHRyaW1tZWQpO1xyXG4gICAgICBpZiAobm9kZSkgbm9kZXMucHVzaChub2RlKTtcclxuXHJcbiAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbm9kZXMuc2xpY2UoMCwgdGhpcy5vcHRpb25zLm1heEJsb2NrcyB8fCAxMDApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZUxpbmUobGluZTogc3RyaW5nKTogQVNUTm9kZSB8IG51bGwge1xyXG4gICAgLy8gSGVhZGVyc1xyXG4gICAgY29uc3QgaGVhZGVyTWF0Y2ggPSBsaW5lLm1hdGNoKC9eKCN7MSwzfSlcXHMrKC4rKSQvKTtcclxuICAgIGlmIChoZWFkZXJNYXRjaCkge1xyXG4gICAgICBjb25zdCBsZXZlbCA9IGhlYWRlck1hdGNoWzFdLmxlbmd0aCBhcyAxIHwgMiB8IDM7XHJcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUhlYWRpbmdOb2RlKGhlYWRlck1hdGNoWzJdLCBsZXZlbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW1hZ2VzIHdpdGggaW5saW5lIGNvbnRlbnRcclxuICAgIGNvbnN0IGltYWdlTWF0Y2ggPSBsaW5lLm1hdGNoKC9eIVxcWyhbXlxcXV0qKVxcXVxcKChbXildKylcXCkoLiopJC8pO1xyXG4gICAgaWYgKGltYWdlTWF0Y2gpIHtcclxuICAgICAgY29uc3QgaW1hZ2VOb2RlID0gdGhpcy5jcmVhdGVNZWRpYU5vZGUoJ2ltYWdlJywgaW1hZ2VNYXRjaFsyXSwgaW1hZ2VNYXRjaFsxXSk7XHJcblxyXG4gICAgICAvLyBJZiB0aGVyZSdzIGFkZGl0aW9uYWwgY29udGVudCBhZnRlciB0aGUgaW1hZ2UsIGNyZWF0ZSBhIHBhcmFncmFwaFxyXG4gICAgICBpZiAoaW1hZ2VNYXRjaFszXS50cmltKCkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUZXh0Tm9kZShsaW5lKTsgLy8gS2VlcCBhcyB0ZXh0IHRvIHByZXNlcnZlIG1peGVkIGNvbnRlbnRcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGltYWdlTm9kZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMaXN0cyAod2lsbCBiZSBoYW5kbGVkIGJ5IHBhcnNlTmVzdGVkTGlzdCBmb3IgcHJvcGVyIG5lc3RpbmcpXHJcbiAgICBjb25zdCBidWxsZXRNYXRjaCA9IGxpbmUubWF0Y2goL14oXFxzKilbLSorXVxccysoLispJC8pO1xyXG4gICAgaWYgKGJ1bGxldE1hdGNoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUxpc3RJdGVtTm9kZShidWxsZXRNYXRjaFsyXSwgJ2J1bGxldGVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbnVtYmVyZWRNYXRjaCA9IGxpbmUubWF0Y2goL14oXFxzKilcXGQrXFwuXFxzKyguKykkLyk7XHJcbiAgICBpZiAobnVtYmVyZWRNYXRjaCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVMaXN0SXRlbU5vZGUobnVtYmVyZWRNYXRjaFsyXSwgJ251bWJlcmVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2tib3hlc1xyXG4gICAgY29uc3QgY2hlY2tib3hNYXRjaCA9IGxpbmUubWF0Y2goL14oXFxzKiktIFxcWyhbIHhdKVxcXVxccysoLispJC8pO1xyXG4gICAgaWYgKGNoZWNrYm94TWF0Y2gpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTGlzdEl0ZW1Ob2RlKGNoZWNrYm94TWF0Y2hbM10sICd0b2RvJywgY2hlY2tib3hNYXRjaFsyXSA9PT0gJ3gnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBRdW90ZXNcclxuICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJz4gJykgJiYgIWxpbmUubWF0Y2goL14+XFxzKlxcWyEvKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVRdW90ZU5vZGUobGluZS5zdWJzdHJpbmcoMikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERpdmlkZXJzXHJcbiAgICBpZiAobGluZS5tYXRjaCgvXigtLS18XFwqXFwqXFwqfF9fXykkLykpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRGl2aWRlck5vZGUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVUkxzXHJcbiAgICBpZiAodGhpcy5pc1ZhbGlkVXJsKGxpbmUpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJvb2ttYXJrTm9kZShsaW5lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBIVE1MIGlubGluZSBoYW5kbGluZ1xyXG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJzwnKSAmJiBsaW5lLmluY2x1ZGVzKCc+JykpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFyc2VIdG1sSW5saW5lKGxpbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlZ3VsYXIgcGFyYWdyYXBoXHJcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVUZXh0Tm9kZShsaW5lKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGFyc2VDb2RlQmxvY2sobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlOiBBU1ROb2RlIHwgbnVsbDsgY29uc3VtZWQ6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IGZpcnN0TGluZSA9IGxpbmVzW3N0YXJ0SWR4XTtcclxuICAgIGNvbnN0IGxhbmd1YWdlID0gZmlyc3RMaW5lLnJlcGxhY2UoJ2BgYCcsICcnKS50cmltKCkgfHwgJ3BsYWluIHRleHQnO1xyXG4gICAgY29uc3QgY29kZUxpbmVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbGV0IGkgPSBzdGFydElkeCArIDE7XHJcblxyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGggJiYgIWxpbmVzW2ldLnRyaW0oKS5zdGFydHNXaXRoKCdgYGAnKSkge1xyXG4gICAgICBjb2RlTGluZXMucHVzaChsaW5lc1tpXSk7XHJcbiAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaSA+PSBsaW5lcy5sZW5ndGgpIHtcclxuICAgICAgLy8gTm8gY2xvc2luZyBgYGAsIHRyZWF0IGFzIHRleHRcclxuICAgICAgcmV0dXJuIHsgbm9kZTogdGhpcy5jcmVhdGVUZXh0Tm9kZShmaXJzdExpbmUpLCBjb25zdW1lZDogMSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvZGUgPSBjb2RlTGluZXMuam9pbignXFxuJyk7XHJcbiAgICBjb25zdCB0cnVuY2F0ZWRDb2RlID0gdGhpcy50cnVuY2F0ZUNvbnRlbnQoY29kZSwgdGhpcy5vcHRpb25zLm1heENvZGVMZW5ndGggfHwgMjAwMCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbm9kZTogdGhpcy5jcmVhdGVDb2RlTm9kZSh0cnVuY2F0ZWRDb2RlLCBsYW5ndWFnZSwgdHJ1ZSksXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHggKyAxXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZUVxdWF0aW9uQmxvY2sobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlOiBBU1ROb2RlIHwgbnVsbDsgY29uc3VtZWQ6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IGZpcnN0TGluZSA9IGxpbmVzW3N0YXJ0SWR4XTtcclxuXHJcbiAgICAvLyBIYW5kbGUgJCRlcXVhdGlvbiQkIHNpbmdsZSBsaW5lXHJcbiAgICBpZiAoZmlyc3RMaW5lLnN0YXJ0c1dpdGgoJyQkJykgJiYgZmlyc3RMaW5lLmVuZHNXaXRoKCckJCcpICYmIGZpcnN0TGluZS5sZW5ndGggPiA0KSB7XHJcbiAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSBmaXJzdExpbmUuc2xpY2UoMiwgLTIpLnRyaW0oKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBub2RlOiB0aGlzLmNyZWF0ZUVxdWF0aW9uTm9kZShleHByZXNzaW9uLCB0cnVlKSxcclxuICAgICAgICBjb25zdW1lZDogMVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhhbmRsZSBtdWx0aS1saW5lICQgb3IgJCRcclxuICAgIGNvbnN0IGVxdWF0aW9uTGluZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBsZXQgaSA9IHN0YXJ0SWR4ICsgMTtcclxuICAgIGNvbnN0IGRlbGltaXRlciA9IGZpcnN0TGluZS5zdGFydHNXaXRoKCckJCcpID8gJyQkJyA6ICckJztcclxuXHJcbiAgICB3aGlsZSAoaSA8IGxpbmVzLmxlbmd0aCAmJiBsaW5lc1tpXS50cmltKCkgIT09IGRlbGltaXRlcikge1xyXG4gICAgICBlcXVhdGlvbkxpbmVzLnB1c2gobGluZXNbaV0pO1xyXG4gICAgICBpKys7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGkgPj0gbGluZXMubGVuZ3RoKSB7XHJcbiAgICAgIC8vIE5vIGNsb3NpbmcgZGVsaW1pdGVyLCB0cmVhdCBhcyB0ZXh0XHJcbiAgICAgIHJldHVybiB7IG5vZGU6IHRoaXMuY3JlYXRlVGV4dE5vZGUoZmlyc3RMaW5lKSwgY29uc3VtZWQ6IDEgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBleHByZXNzaW9uID0gZXF1YXRpb25MaW5lcy5qb2luKCdcXG4nKS50cmltKCk7XHJcblxyXG4gICAgaWYgKCFleHByZXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiB7IG5vZGU6IG51bGwsIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHggKyAxIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbm9kZTogdGhpcy5jcmVhdGVFcXVhdGlvbk5vZGUoZXhwcmVzc2lvbiwgdHJ1ZSksXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHggKyAxXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZVRhYmxlKGxpbmVzOiBzdHJpbmdbXSwgc3RhcnRJZHg6IG51bWJlcik6IHsgbm9kZTogQVNUTm9kZSB8IG51bGw7IGNvbnN1bWVkOiBudW1iZXIgfSB7XHJcbiAgICBjb25zdCB0YWJsZUxpbmVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbGV0IGkgPSBzdGFydElkeDtcclxuXHJcbiAgICAvLyBDb2xsZWN0IGFsbCB0YWJsZSBsaW5lc1xyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGggJiYgbGluZXNbaV0udHJpbSgpLnN0YXJ0c1dpdGgoJ3wnKSkge1xyXG4gICAgICB0YWJsZUxpbmVzLnB1c2gobGluZXNbaV0pO1xyXG4gICAgICBpKys7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRhYmxlTGluZXMubGVuZ3RoIDwgMikge1xyXG4gICAgICByZXR1cm4geyBub2RlOiBudWxsLCBjb25zdW1lZDogMSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFBhcnNlIGhlYWRlcnNcclxuICAgIGNvbnN0IGhlYWRlcnMgPSB0aGlzLnBhcnNlVGFibGVSb3codGFibGVMaW5lc1swXSk7XHJcblxyXG4gICAgLy8gQ2hlY2sgZm9yIHNlcGFyYXRvciBsaW5lXHJcbiAgICBsZXQgZGF0YVN0YXJ0SW5kZXggPSAxO1xyXG4gICAgaWYgKHRhYmxlTGluZXMubGVuZ3RoID4gMSAmJiB0aGlzLmlzVGFibGVTZXBhcmF0b3IodGFibGVMaW5lc1sxXSkpIHtcclxuICAgICAgZGF0YVN0YXJ0SW5kZXggPSAyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFBhcnNlIGRhdGEgcm93c1xyXG4gICAgY29uc3Qgcm93cyA9IHRhYmxlTGluZXMuc2xpY2UoZGF0YVN0YXJ0SW5kZXgpLm1hcChsaW5lID0+IHRoaXMucGFyc2VUYWJsZVJvdyhsaW5lKSk7XHJcblxyXG4gICAgLy8gTm9ybWFsaXplIHJvdyBsZW5ndGhzXHJcbiAgICBjb25zdCBtYXhDb2x1bW5zID0gTWF0aC5tYXgoaGVhZGVycy5sZW5ndGgsIC4uLnJvd3MubWFwKHJvdyA9PiByb3cubGVuZ3RoKSk7XHJcbiAgICBjb25zdCBub3JtYWxpemVkSGVhZGVycyA9IHRoaXMubm9ybWFsaXplVGFibGVSb3coaGVhZGVycywgbWF4Q29sdW1ucyk7XHJcbiAgICBjb25zdCBub3JtYWxpemVkUm93cyA9IHJvd3MubWFwKHJvdyA9PiB0aGlzLm5vcm1hbGl6ZVRhYmxlUm93KHJvdywgbWF4Q29sdW1ucykpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5vZGU6IHRoaXMuY3JlYXRlVGFibGVOb2RlKG5vcm1hbGl6ZWRIZWFkZXJzLCBub3JtYWxpemVkUm93cyksXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHhcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlVGFibGVSb3cobGluZTogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgLy8gUmVtb3ZlIGxlYWRpbmcvdHJhaWxpbmcgcGlwZXMgYW5kIHNwbGl0XHJcbiAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XHJcbiAgICBjb25zdCB3aXRob3V0T3V0ZXJQaXBlcyA9IHRyaW1tZWQuc3RhcnRzV2l0aCgnfCcpID8gdHJpbW1lZC5zbGljZSgxKSA6IHRyaW1tZWQ7XHJcbiAgICBjb25zdCB3aXRob3V0VHJhaWxpbmdQaXBlID0gd2l0aG91dE91dGVyUGlwZXMuZW5kc1dpdGgoJ3wnKVxyXG4gICAgICA/IHdpdGhvdXRPdXRlclBpcGVzLnNsaWNlKDAsIC0xKVxyXG4gICAgICA6IHdpdGhvdXRPdXRlclBpcGVzO1xyXG5cclxuICAgIHJldHVybiB3aXRob3V0VHJhaWxpbmdQaXBlXHJcbiAgICAgIC5zcGxpdCgnfCcpXHJcbiAgICAgIC5tYXAoY2VsbCA9PiBjZWxsLnRyaW0oKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzVGFibGVTZXBhcmF0b3IobGluZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XHJcbiAgICByZXR1cm4gL15bXFx8XFwtOlxcc10rJC8udGVzdCh0cmltbWVkKSAmJiB0cmltbWVkLmluY2x1ZGVzKCctJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG5vcm1hbGl6ZVRhYmxlUm93KHJvdzogc3RyaW5nW10sIHRhcmdldExlbmd0aDogbnVtYmVyKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IFsuLi5yb3ddO1xyXG5cclxuICAgIC8vIFBhZCB3aXRoIGVtcHR5IHN0cmluZ3MgaWYgdG9vIHNob3J0XHJcbiAgICB3aGlsZSAobm9ybWFsaXplZC5sZW5ndGggPCB0YXJnZXRMZW5ndGgpIHtcclxuICAgICAgbm9ybWFsaXplZC5wdXNoKCcnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcnVuY2F0ZSBpZiB0b28gbG9uZ1xyXG4gICAgaWYgKG5vcm1hbGl6ZWQubGVuZ3RoID4gdGFyZ2V0TGVuZ3RoKSB7XHJcbiAgICAgIG5vcm1hbGl6ZWQubGVuZ3RoID0gdGFyZ2V0TGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBub3JtYWxpemVkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZVRvZ2dsZUhlYWRpbmcobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlOiBBU1ROb2RlIHwgbnVsbDsgY29uc3VtZWQ6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IGZpcnN0TGluZSA9IGxpbmVzW3N0YXJ0SWR4XTtcclxuICAgIGNvbnN0IG1hdGNoID0gZmlyc3RMaW5lLm1hdGNoKC9ePlxccyooI3sxLDN9KVxccysoLispJC8pO1xyXG5cclxuICAgIGlmICghbWF0Y2gpIHJldHVybiB7IG5vZGU6IG51bGwsIGNvbnN1bWVkOiAxIH07XHJcblxyXG4gICAgY29uc3QgbGV2ZWwgPSBtYXRjaFsxXS5sZW5ndGggYXMgMSB8IDIgfCAzO1xyXG4gICAgY29uc3QgdGl0bGUgPSBtYXRjaFsyXTtcclxuXHJcbiAgICBjb25zdCBjaGlsZHJlbjogQVNUTm9kZVtdID0gW107XHJcbiAgICBsZXQgaSA9IHN0YXJ0SWR4ICsgMTtcclxuXHJcbiAgICAvLyBQYXJzZSB0b2dnbGUgY29udGVudCAobGluZXMgc3RhcnRpbmcgd2l0aCA+KVxyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldLnRyaW0oKTtcclxuXHJcbiAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJz4nKSkge1xyXG4gICAgICAgIC8vIFJlbW92ZSA+IHByZWZpeCBhbmQgcGFyc2UgYXMgbm9ybWFsIGNvbnRlbnRcclxuICAgICAgICBjb25zdCBjb250ZW50ID0gbGluZS5zdWJzdHJpbmcoMSkudHJpbSgpO1xyXG4gICAgICAgIGlmIChjb250ZW50KSB7XHJcbiAgICAgICAgICAvLyBSZWN1cnNpdmVseSBwYXJzZSB0aGUgY29udGVudFxyXG4gICAgICAgICAgY29uc3QgY29udGVudE5vZGVzID0gdGhpcy5wYXJzZShjb250ZW50KTtcclxuICAgICAgICAgIGNoaWxkcmVuLnB1c2goLi4uY29udGVudE5vZGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICB9IGVsc2UgaWYgKCFsaW5lKSB7XHJcbiAgICAgICAgLy8gRW1wdHkgbGluZSB3aXRoaW4gdG9nZ2xlXHJcbiAgICAgICAgaSsrO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEVuZCBvZiB0b2dnbGVcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5vZGU6IHRoaXMuY3JlYXRlVG9nZ2xlSGVhZGluZ05vZGUodGl0bGUsIGxldmVsLCBjaGlsZHJlbiksXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHhcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlVG9nZ2xlQmxvY2sobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlOiBBU1ROb2RlIHwgbnVsbDsgY29uc3VtZWQ6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IGZpcnN0TGluZSA9IGxpbmVzW3N0YXJ0SWR4XTtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBmaXJzdExpbmUuc3Vic3RyaW5nKDIpLnRyaW0oKTsgLy8gUmVtb3ZlIFwiPiBcIlxyXG5cclxuICAgIGlmICghY29udGVudCkgcmV0dXJuIHsgbm9kZTogbnVsbCwgY29uc3VtZWQ6IDEgfTtcclxuXHJcbiAgICBjb25zdCBjaGlsZHJlbjogQVNUTm9kZVtdID0gW107XHJcbiAgICBsZXQgaSA9IHN0YXJ0SWR4ICsgMTtcclxuXHJcbiAgICAvLyBQYXJzZSB0b2dnbGUgY29udGVudCAobGluZXMgc3RhcnRpbmcgd2l0aCA+KVxyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldLnRyaW0oKTtcclxuXHJcbiAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJz4nKSkge1xyXG4gICAgICAgIC8vIFJlbW92ZSA+IHByZWZpeCBhbmQgcGFyc2UgYXMgbm9ybWFsIGNvbnRlbnRcclxuICAgICAgICBjb25zdCBjaGlsZENvbnRlbnQgPSBsaW5lLnN1YnN0cmluZygxKS50cmltKCk7XHJcbiAgICAgICAgaWYgKGNoaWxkQ29udGVudCkge1xyXG4gICAgICAgICAgLy8gUmVjdXJzaXZlbHkgcGFyc2UgdGhlIGNvbnRlbnRcclxuICAgICAgICAgIGNvbnN0IGNvbnRlbnROb2RlcyA9IHRoaXMucGFyc2UoY2hpbGRDb250ZW50KTtcclxuICAgICAgICAgIGNoaWxkcmVuLnB1c2goLi4uY29udGVudE5vZGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICB9IGVsc2UgaWYgKCFsaW5lKSB7XHJcbiAgICAgICAgLy8gRW1wdHkgbGluZSB3aXRoaW4gdG9nZ2xlXHJcbiAgICAgICAgaSsrO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEVuZCBvZiB0b2dnbGVcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIGNoaWxkcmVuLCB0cmVhdCBhcyBhIHNpbXBsZSBxdW90ZVxyXG4gICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBub2RlOiB0aGlzLmNyZWF0ZVF1b3RlTm9kZShjb250ZW50KSwgY29uc3VtZWQ6IDEgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBub2RlOiB0aGlzLmNyZWF0ZVRvZ2dsZU5vZGUoY29udGVudCwgY2hpbGRyZW4pLFxyXG4gICAgICBjb25zdW1lZDogaSAtIHN0YXJ0SWR4XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZUNhbGxvdXQobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlOiBBU1ROb2RlIHwgbnVsbDsgY29uc3VtZWQ6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IGZpcnN0TGluZSA9IGxpbmVzW3N0YXJ0SWR4XTtcclxuICAgIGNvbnN0IG1hdGNoID0gZmlyc3RMaW5lLm1hdGNoKC9ePlxccypcXFshKFxcdyspXFxdXFxzKiguKikkLyk7XHJcblxyXG4gICAgaWYgKCFtYXRjaCkgcmV0dXJuIHsgbm9kZTogbnVsbCwgY29uc3VtZWQ6IDEgfTtcclxuXHJcbiAgICBjb25zdCBpY29uTmFtZSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCBmaXJzdENvbnRlbnQgPSBtYXRjaFsyXSB8fCAnJztcclxuXHJcbiAgICBjb25zdCBjb250ZW50TGluZXMgPSBbZmlyc3RDb250ZW50XTtcclxuICAgIGxldCBpID0gc3RhcnRJZHggKyAxO1xyXG5cclxuICAgIC8vIFBhcnNlIG11bHRpLWxpbmUgY2FsbG91dCBjb250ZW50XHJcbiAgICB3aGlsZSAoaSA8IGxpbmVzLmxlbmd0aCkge1xyXG4gICAgICBjb25zdCBsaW5lID0gbGluZXNbaV0udHJpbSgpO1xyXG5cclxuICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aCgnPicpKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIG5ldyBjYWxsb3V0XHJcbiAgICAgICAgaWYgKGxpbmUubWF0Y2goL14+XFxzKlxcWyEoXFx3KylcXF0vKSkge1xyXG4gICAgICAgICAgLy8gVGhpcyBpcyBhIG5ldyBjYWxsb3V0LCBzdG9wIHBhcnNpbmcgY3VycmVudCBvbmVcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udGludWUgY2FsbG91dCBjb250ZW50XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IGxpbmUuc3Vic3RyaW5nKDEpLnRyaW0oKTtcclxuICAgICAgICBjb250ZW50TGluZXMucHVzaChjb250ZW50KTtcclxuICAgICAgICBpKys7XHJcbiAgICAgIH0gZWxzZSBpZiAoIWxpbmUpIHtcclxuICAgICAgICAvLyBFbXB0eSBsaW5lIHdpdGhpbiBjYWxsb3V0XHJcbiAgICAgICAgY29udGVudExpbmVzLnB1c2goJycpO1xyXG4gICAgICAgIGkrKztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBFbmQgb2YgY2FsbG91dFxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRlbnRMaW5lcy5maWx0ZXIobCA9PiBsICE9PSAnJykuam9pbignXFxuJyk7XHJcbiAgICBjb25zdCBpY29uID0gdGhpcy5nZXRDYWxsb3V0SWNvbihpY29uTmFtZSk7XHJcbiAgICBjb25zdCBjb2xvciA9IHRoaXMuZ2V0Q2FsbG91dENvbG9yKGljb25OYW1lKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBub2RlOiB0aGlzLmNyZWF0ZUNhbGxvdXROb2RlKGNvbnRlbnQsIGljb24sIGNvbG9yKSxcclxuICAgICAgY29uc3VtZWQ6IGkgLSBzdGFydElkeFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNMaXN0TGluZShsaW5lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAvXihcXHMqKVstKitdXFxzKy8udGVzdChsaW5lKSB8fFxyXG4gICAgICAvXihcXHMqKVxcZCtcXC5cXHMrLy50ZXN0KGxpbmUpIHx8XHJcbiAgICAgIC9eKFxccyopLSBcXFsoWyB4XSlcXF1cXHMrLy50ZXN0KGxpbmUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZU5lc3RlZExpc3QobGluZXM6IHN0cmluZ1tdLCBzdGFydElkeDogbnVtYmVyKTogeyBub2RlczogQVNUTm9kZVtdOyBjb25zdW1lZDogbnVtYmVyIH0ge1xyXG4gICAgY29uc3QgbGlzdEl0ZW1zOiBBcnJheTx7IG5vZGU6IEFTVE5vZGU7IGxldmVsOiBudW1iZXI7IHR5cGU6IHN0cmluZyB9PiA9IFtdO1xyXG4gICAgbGV0IGkgPSBzdGFydElkeDtcclxuXHJcbiAgICB3aGlsZSAoaSA8IGxpbmVzLmxlbmd0aCkge1xyXG4gICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07XHJcbiAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcclxuXHJcbiAgICAgIGlmICghdGhpcy5pc0xpc3RMaW5lKHRyaW1tZWQpKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGxldmVsID0gdGhpcy5nZXRJbmRlbnRhdGlvbkxldmVsKGxpbmUpO1xyXG4gICAgICBjb25zdCBsaXN0SXRlbSA9IHRoaXMucGFyc2VMaXN0SXRlbSh0cmltbWVkKTtcclxuXHJcbiAgICAgIGlmIChsaXN0SXRlbSkge1xyXG4gICAgICAgIGxpc3RJdGVtcy5wdXNoKHtcclxuICAgICAgICAgIG5vZGU6IGxpc3RJdGVtLm5vZGUsXHJcbiAgICAgICAgICBsZXZlbCxcclxuICAgICAgICAgIHR5cGU6IGxpc3RJdGVtLnR5cGVcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaSsrO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnZlcnQgZmxhdCBsaXN0IHRvIG5lc3RlZCBzdHJ1Y3R1cmVcclxuICAgIGNvbnN0IG5lc3RlZE5vZGVzID0gdGhpcy5idWlsZE5lc3RlZExpc3RTdHJ1Y3R1cmUobGlzdEl0ZW1zKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBub2RlczogbmVzdGVkTm9kZXMsXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHhcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEluZGVudGF0aW9uTGV2ZWwobGluZTogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKS8pO1xyXG4gICAgY29uc3Qgc3BhY2VzID0gbWF0Y2ggPyBtYXRjaFsxXS5sZW5ndGggOiAwO1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3Ioc3BhY2VzIC8gMik7IC8vIDIgc3BhY2VzID0gMSBsZXZlbFxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZUxpc3RJdGVtKGxpbmU6IHN0cmluZyk6IHsgbm9kZTogQVNUTm9kZTsgdHlwZTogc3RyaW5nIH0gfCBudWxsIHtcclxuICAgIC8vIENoZWNrYm94XHJcbiAgICBjb25zdCBjaGVja2JveE1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKS0gXFxbKFsgeF0pXFxdXFxzKyguKykkLyk7XHJcbiAgICBpZiAoY2hlY2tib3hNYXRjaCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5vZGU6IHRoaXMuY3JlYXRlTGlzdEl0ZW1Ob2RlKGNoZWNrYm94TWF0Y2hbM10sICd0b2RvJywgY2hlY2tib3hNYXRjaFsyXSA9PT0gJ3gnKSxcclxuICAgICAgICB0eXBlOiAndG9kbydcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWxsZXRlZCBsaXN0XHJcbiAgICBjb25zdCBidWxsZXRNYXRjaCA9IGxpbmUubWF0Y2goL14oXFxzKilbLSorXVxccysoLispJC8pO1xyXG4gICAgaWYgKGJ1bGxldE1hdGNoKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbm9kZTogdGhpcy5jcmVhdGVMaXN0SXRlbU5vZGUoYnVsbGV0TWF0Y2hbMl0sICdidWxsZXRlZCcpLFxyXG4gICAgICAgIHR5cGU6ICdidWxsZXRlZCdcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBOdW1iZXJlZCBsaXN0XHJcbiAgICBjb25zdCBudW1iZXJlZE1hdGNoID0gbGluZS5tYXRjaCgvXihcXHMqKVxcZCtcXC5cXHMrKC4rKSQvKTtcclxuICAgIGlmIChudW1iZXJlZE1hdGNoKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbm9kZTogdGhpcy5jcmVhdGVMaXN0SXRlbU5vZGUobnVtYmVyZWRNYXRjaFsyXSwgJ251bWJlcmVkJyksXHJcbiAgICAgICAgdHlwZTogJ251bWJlcmVkJ1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBidWlsZE5lc3RlZExpc3RTdHJ1Y3R1cmUoaXRlbXM6IEFycmF5PHsgbm9kZTogQVNUTm9kZTsgbGV2ZWw6IG51bWJlcjsgdHlwZTogc3RyaW5nIH0+KTogQVNUTm9kZVtdIHtcclxuICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQ6IEFTVE5vZGVbXSA9IFtdO1xyXG4gICAgY29uc3Qgc3RhY2s6IEFycmF5PHsgbm9kZTogQVNUTm9kZTsgbGV2ZWw6IG51bWJlcjsgY2hpbGRyZW46IEFTVE5vZGVbXSB9PiA9IFtdO1xyXG5cclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xyXG4gICAgICAvLyBQb3AgaXRlbXMgZnJvbSBzdGFjayB0aGF0IGFyZSBhdCBzYW1lIG9yIGhpZ2hlciBsZXZlbFxyXG4gICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5sZXZlbCA+PSBpdGVtLmxldmVsKSB7XHJcbiAgICAgICAgY29uc3QgcG9wcGVkID0gc3RhY2sucG9wKCkhO1xyXG4gICAgICAgIGlmIChwb3BwZWQuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgKHBvcHBlZC5ub2RlIGFzIGFueSkuY2hpbGRyZW4gPSBwb3BwZWQuY2hpbGRyZW47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc3RhY2subGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uY2hpbGRyZW4ucHVzaChwb3BwZWQubm9kZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdC5wdXNoKHBvcHBlZC5ub2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEFkZCBjdXJyZW50IGl0ZW0gdG8gc3RhY2tcclxuICAgICAgc3RhY2sucHVzaCh7XHJcbiAgICAgICAgbm9kZTogaXRlbS5ub2RlLFxyXG4gICAgICAgIGxldmVsOiBpdGVtLmxldmVsLFxyXG4gICAgICAgIGNoaWxkcmVuOiBbXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQb3AgcmVtYWluaW5nIGl0ZW1zIGZyb20gc3RhY2tcclxuICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IHBvcHBlZCA9IHN0YWNrLnBvcCgpITtcclxuICAgICAgaWYgKHBvcHBlZC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgKHBvcHBlZC5ub2RlIGFzIGFueSkuY2hpbGRyZW4gPSBwb3BwZWQuY2hpbGRyZW47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChzdGFjay5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0uY2hpbGRyZW4ucHVzaChwb3BwZWQubm9kZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0LnB1c2gocG9wcGVkLm5vZGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNQYXJhZ3JhcGhTdGFydChsaW5lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIC8vIE5vdCBhIHNwZWNpYWwgbWFya2Rvd24gZWxlbWVudFxyXG4gICAgcmV0dXJuICFsaW5lLm1hdGNoKC9eKCN7MSwzfVxcc3xbLSorXVxcc3xcXGQrXFwuXFxzfD5cXHN8XFx8LipcXHx8YGBgfC0tLXxcXCpcXCpcXCp8X19ffCFcXFspLyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlTXVsdGlMaW5lUGFyYWdyYXBoKGxpbmVzOiBzdHJpbmdbXSwgc3RhcnRJZHg6IG51bWJlcik6IHsgbm9kZTogQVNUTm9kZSB8IG51bGw7IGNvbnN1bWVkOiBudW1iZXIgfSB7XHJcbiAgICBjb25zdCBwYXJhZ3JhcGhMaW5lczogc3RyaW5nW10gPSBbXTtcclxuICAgIGxldCBpID0gc3RhcnRJZHg7XHJcblxyXG4gICAgd2hpbGUgKGkgPCBsaW5lcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xyXG4gICAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XHJcblxyXG4gICAgICAvLyBFbXB0eSBsaW5lIGVuZHMgcGFyYWdyYXBoXHJcbiAgICAgIGlmICghdHJpbW1lZCkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBTcGVjaWFsIG1hcmtkb3duIGVsZW1lbnRzIGVuZCBwYXJhZ3JhcGhcclxuICAgICAgaWYgKHRoaXMuaXNTcGVjaWFsTWFya2Rvd25MaW5lKHRyaW1tZWQpKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHBhcmFncmFwaExpbmVzLnB1c2gobGluZSk7XHJcbiAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICBpZiAocGFyYWdyYXBoTGluZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB7IG5vZGU6IG51bGwsIGNvbnN1bWVkOiAxIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSm9pbiBsaW5lcyB3aXRoIHNvZnQgYnJlYWtzIChzcGFjZXMpXHJcbiAgICBjb25zdCBjb250ZW50ID0gcGFyYWdyYXBoTGluZXMuam9pbignICcpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5vZGU6IHRoaXMuY3JlYXRlVGV4dE5vZGUoY29udGVudCksXHJcbiAgICAgIGNvbnN1bWVkOiBpIC0gc3RhcnRJZHhcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzU3BlY2lhbE1hcmtkb3duTGluZShsaW5lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAvXigjezEsM31cXHN8Wy0qK11cXHN8XFxkK1xcLlxcc3w+XFxzfFxcfC4qXFx8fGBgYHwtLS18XFwqXFwqXFwqfF9fX3whXFxbKS8udGVzdChsaW5lKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGFyc2VIdG1sSW5saW5lKGxpbmU6IHN0cmluZyk6IEFTVE5vZGUge1xyXG4gICAgLy8gU2ltcGxlIEhUTUwgdGFnIHJlbW92YWwgZm9yIG5vd1xyXG4gICAgLy8gSW4gYSBtb3JlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uLCB5b3UnZCBwYXJzZSBIVE1MIHByb3Blcmx5XHJcbiAgICBjb25zdCBjbGVhblRleHQgPSBsaW5lLnJlcGxhY2UoLzxbXj5dKj4vZywgJycpO1xyXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVGV4dE5vZGUoY2xlYW5UZXh0KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0Q2FsbG91dEljb24obmFtZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGljb25zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xyXG4gICAgICAnbm90ZSc6ICfwn5OdJyxcclxuICAgICAgJ2luZm8nOiAn4oS577iPJyxcclxuICAgICAgJ3RpcCc6ICfwn5KhJyxcclxuICAgICAgJ3dhcm5pbmcnOiAn4pqg77iPJyxcclxuICAgICAgJ2Rhbmdlcic6ICfwn5qoJyxcclxuICAgICAgJ3N1Y2Nlc3MnOiAn4pyFJyxcclxuICAgICAgJ3F1ZXN0aW9uJzogJ+KdkycsXHJcbiAgICAgICdxdW90ZSc6ICfwn5KsJyxcclxuICAgICAgJ2V4YW1wbGUnOiAn8J+TjCcsXHJcbiAgICAgICdidWcnOiAn8J+QmycsXHJcbiAgICAgICd0b2RvJzogJ+KYke+4jycsXHJcbiAgICAgICdhYnN0cmFjdCc6ICfwn5OEJyxcclxuICAgICAgJ3N1bW1hcnknOiAn8J+TiycsXHJcbiAgICAgICd0bGRyJzogJ/Cfk4snLFxyXG4gICAgICAnZmFpbHVyZSc6ICfinYwnLFxyXG4gICAgICAnZmFpbCc6ICfinYwnLFxyXG4gICAgICAnbWlzc2luZyc6ICfinZMnLFxyXG4gICAgICAnY2hlY2snOiAn4pyFJyxcclxuICAgICAgJ2RvbmUnOiAn4pyFJ1xyXG4gICAgfTtcclxuICAgIHJldHVybiBpY29uc1tuYW1lXSB8fCAn8J+SoSc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldENhbGxvdXRDb2xvcihuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgY29sb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xyXG4gICAgICAnbm90ZSc6ICdibHVlX2JhY2tncm91bmQnLFxyXG4gICAgICAnaW5mbyc6ICdibHVlX2JhY2tncm91bmQnLFxyXG4gICAgICAndGlwJzogJ2dyZWVuX2JhY2tncm91bmQnLFxyXG4gICAgICAnd2FybmluZyc6ICd5ZWxsb3dfYmFja2dyb3VuZCcsXHJcbiAgICAgICdkYW5nZXInOiAncmVkX2JhY2tncm91bmQnLFxyXG4gICAgICAnc3VjY2Vzcyc6ICdncmVlbl9iYWNrZ3JvdW5kJyxcclxuICAgICAgJ3F1ZXN0aW9uJzogJ3B1cnBsZV9iYWNrZ3JvdW5kJyxcclxuICAgICAgJ3F1b3RlJzogJ2dyYXlfYmFja2dyb3VuZCcsXHJcbiAgICAgICdleGFtcGxlJzogJ2JsdWVfYmFja2dyb3VuZCcsXHJcbiAgICAgICdidWcnOiAncmVkX2JhY2tncm91bmQnLFxyXG4gICAgICAndG9kbyc6ICdibHVlX2JhY2tncm91bmQnLFxyXG4gICAgICAnYWJzdHJhY3QnOiAncHVycGxlX2JhY2tncm91bmQnLFxyXG4gICAgICAnc3VtbWFyeSc6ICdwdXJwbGVfYmFja2dyb3VuZCcsXHJcbiAgICAgICd0bGRyJzogJ3B1cnBsZV9iYWNrZ3JvdW5kJyxcclxuICAgICAgJ2ZhaWx1cmUnOiAncmVkX2JhY2tncm91bmQnLFxyXG4gICAgICAnZmFpbCc6ICdyZWRfYmFja2dyb3VuZCcsXHJcbiAgICAgICdtaXNzaW5nJzogJ3llbGxvd19iYWNrZ3JvdW5kJyxcclxuICAgICAgJ2NoZWNrJzogJ2dyZWVuX2JhY2tncm91bmQnLFxyXG4gICAgICAnZG9uZSc6ICdncmVlbl9iYWNrZ3JvdW5kJ1xyXG4gICAgfTtcclxuICAgIHJldHVybiBjb2xvcnNbbmFtZV0gfHwgJ2dyYXlfYmFja2dyb3VuZCc7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEVuaGFuY2VkIGxpc3QgcGFyc2luZyB3aXRoIGJldHRlciBuZXN0aW5nIHN1cHBvcnRcclxuICAgKi9cclxuICBzdGF0aWMgcGFyc2VNYXJrZG93bkxpc3QoY29udGVudDogc3RyaW5nKTogQVNUTm9kZVtdIHtcclxuICAgIGNvbnN0IHBhcnNlciA9IG5ldyBNYXJrZG93blBhcnNlcigpO1xyXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcclxuICAgIGNvbnN0IHsgbm9kZXMgfSA9IHBhcnNlci5wYXJzZU5lc3RlZExpc3QobGluZXMsIDApO1xyXG4gICAgcmV0dXJuIG5vZGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGFyc2UgbWFya2Rvd24gdGFibGVzIHdpdGggYWR2YW5jZWQgZmVhdHVyZXNcclxuICAgKi9cclxuICBzdGF0aWMgcGFyc2VNYXJrZG93blRhYmxlKGNvbnRlbnQ6IHN0cmluZyk6IEFTVE5vZGUgfCBudWxsIHtcclxuICAgIGNvbnN0IHBhcnNlciA9IG5ldyBNYXJrZG93blBhcnNlcigpO1xyXG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcclxuICAgIGNvbnN0IHsgbm9kZSB9ID0gcGFyc2VyLnBhcnNlVGFibGUobGluZXMsIDApO1xyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG59Il0sInZlcnNpb24iOjN9