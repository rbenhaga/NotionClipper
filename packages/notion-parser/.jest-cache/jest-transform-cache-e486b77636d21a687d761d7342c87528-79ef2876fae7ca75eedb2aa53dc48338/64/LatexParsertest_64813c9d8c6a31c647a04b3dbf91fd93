43870d9cdfb0bf5034bb65a8a3e7c693
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const parseContent_1 = require("../../../src/parseContent");
describe('LaTeX Parsing', () => {
    describe('Inline LaTeX Detection', () => {
        it('should detect inline math with single dollar signs', () => {
            const content = 'The formula $E = mc^2$ is famous';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks.length).toBeGreaterThan(0);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeDefined();
        });
        it('should detect inline math with escaped parentheses', () => {
            const content = 'Formula \\(x^2 + y^2 = z^2\\) is Pythagorean';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeDefined();
        });
    });
    describe('Block LaTeX Detection', () => {
        it('should detect display math with double dollar signs', () => {
            const content = '$$\\int_{a}^{b} f(x) \\, dx = F(b) - F(a)$$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks.length).toBeGreaterThan(0);
            expect(result.blocks[0].type).toBe('equation');
        });
        it('should detect LaTeX environments', () => {
            const content = `\\begin{equation}
E = mc^2
\\end{equation}`;
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks.length).toBeGreaterThan(0);
            expect(result.blocks[0].type).toBe('equation');
        });
        it('should detect align environments', () => {
            const content = `\\begin{align}
x &= a + b \\\\
y &= c + d
\\end{align}`;
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks.length).toBeGreaterThan(0);
            expect(result.blocks[0].type).toBe('equation');
        });
    });
    describe('Complex LaTeX Expressions', () => {
        it('should handle fractions', () => {
            const content = '$\\frac{a}{b} + \\frac{c}{d} = \\frac{ad + bc}{bd}$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeDefined();
        });
        it('should handle integrals and summations', () => {
            const content = '$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeDefined();
        });
        it('should handle matrices', () => {
            const content = `$\\begin{pmatrix}
a & b \\\\
c & d
\\end{pmatrix}$`;
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks[0].type).toBe('equation');
        });
        it('should handle Greek letters and symbols', () => {
            const content = '$\\alpha + \\beta = \\gamma \\cdot \\delta$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeDefined();
        });
    });
    describe('Mixed Content', () => {
        it('should handle text with multiple equations', () => {
            const content = 'First equation $a = b$ and second $c = d$ in text';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks.length).toBeGreaterThan(0);
            const blocks = result.blocks;
            const equations = blocks.filter((b) => b.type === 'equation');
            expect(equations.length).toBeGreaterThan(0);
        });
        it('should handle LaTeX mixed with markdown', () => {
            const content = '# Math Section\n\nThe formula $E = mc^2$ is **important**.\n\n$F = ma$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'markdown' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equations = blocks.filter((b) => b.type === 'equation');
            expect(equations.length).toBeGreaterThan(0);
        });
    });
    describe('LaTeX Validation', () => {
        it('should handle malformed LaTeX gracefully', () => {
            const malformed = '$\\frac{a}{b$'; // Missing closing brace
            const result = (0, parseContent_1.parseContent)(malformed, { contentType: 'latex' });
            expect(result.success).toBe(true);
            // Should either fix or treat as text
        });
        it('should handle unmatched delimiters', () => {
            const unmatched = '$a = b + c'; // Missing closing $
            const result = (0, parseContent_1.parseContent)(unmatched, { contentType: 'latex' });
            expect(result.success).toBe(true);
        });
        it('should handle nested delimiters', () => {
            const nested = '$a = \\text{nested}$'; // Simplified nested content
            const result = (0, parseContent_1.parseContent)(nested, { contentType: 'latex' });
            expect(result.success).toBe(true);
        });
    });
    describe('Equation Block Structure', () => {
        it('should create proper equation block structure', () => {
            const content = '$x^2 + y^2 = r^2$';
            const result = (0, parseContent_1.parseContent)(content, { contentType: 'latex' });
            expect(result.success).toBe(true);
            const blocks = result.blocks;
            const equationBlock = blocks.find((b) => b.type === 'equation');
            expect(equationBlock).toBeValidNotionBlock();
            expect(equationBlock?.type).toBe('equation');
            expect(equationBlock?.equation).toBeDefined();
        });
    });
    describe('Error Handling', () => {
        it('should handle empty content', () => {
            const result = (0, parseContent_1.parseContent)('', { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks).toEqual([]);
        });
        it('should handle null content', () => {
            const result = (0, parseContent_1.parseContent)(null, { contentType: 'latex' });
            expect(result.success).toBe(true);
            expect(result.blocks).toEqual([]);
        });
    });
    describe('Performance', () => {
        it('should handle complex equations efficiently', () => {
            const complexEquation = `$\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}$`;
            const startTime = performance.now();
            const result = (0, parseContent_1.parseContent)(complexEquation, { contentType: 'latex' });
            const endTime = performance.now();
            expect(result.success).toBe(true);
            expect(endTime - startTime).toBeLessThan(100);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHVuaXRcXHBhcnNlcnNcXExhdGV4UGFyc2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw0REFBeUQ7QUFRekQsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtRQUN0QyxFQUFFLENBQUMsb0RBQW9ELEVBQUUsR0FBRyxFQUFFO1lBQzVELE1BQU0sT0FBTyxHQUFHLGtDQUFrQyxDQUFDO1lBQ25ELE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxPQUFPLEVBQUUsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFaEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQXFCLENBQUM7WUFDNUMsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQVksRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsQ0FBQztZQUMzRSxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0RBQW9ELEVBQUUsR0FBRyxFQUFFO1lBQzVELE1BQU0sT0FBTyxHQUFHLDhDQUE4QyxDQUFDO1lBQy9ELE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVksRUFBQyxPQUFPLEVBQUUsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsTUFB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QWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLGVBQWUsR0FBRyw0REFBNEQsQ0FBQztZQUVyRixNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDcEMsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBWSxFQUFDLGVBQWUsRUFBRSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZFLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVsQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHVuaXRcXHBhcnNlcnNcXExhdGV4UGFyc2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGFyc2VDb250ZW50IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3BhcnNlQ29udGVudCc7XHJcblxyXG4vLyBUeXBlcyBmbGV4aWJsZXMgcG91ciBsZXMgdGVzdHNcclxudHlwZSBUZXN0QmxvY2sgPSB7XHJcbiAgdHlwZTogc3RyaW5nO1xyXG4gIFtrZXk6IHN0cmluZ106IGFueTtcclxufTtcclxuXHJcbmRlc2NyaWJlKCdMYVRlWCBQYXJzaW5nJywgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKCdJbmxpbmUgTGFUZVggRGV0ZWN0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgaW5saW5lIG1hdGggd2l0aCBzaW5nbGUgZG9sbGFyIHNpZ25zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJ1RoZSBmb3JtdWxhICRFID0gbWNeMiQgaXMgZmFtb3VzJztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbnRlbnQsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgYmxvY2tzID0gcmVzdWx0LmJsb2NrcyBhcyBUZXN0QmxvY2tbXTtcclxuICAgICAgY29uc3QgZXF1YXRpb25CbG9jayA9IGJsb2Nrcy5maW5kKChiOiBUZXN0QmxvY2spID0+IGIudHlwZSA9PT0gJ2VxdWF0aW9uJyk7XHJcbiAgICAgIGV4cGVjdChlcXVhdGlvbkJsb2NrKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgaW5saW5lIG1hdGggd2l0aCBlc2NhcGVkIHBhcmVudGhlc2VzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJ0Zvcm11bGEgXFxcXCh4XjIgKyB5XjIgPSB6XjJcXFxcKSBpcyBQeXRoYWdvcmVhbic7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBjb25zdCBibG9ja3MgPSByZXN1bHQuYmxvY2tzIGFzIFRlc3RCbG9ja1tdO1xyXG4gICAgICBjb25zdCBlcXVhdGlvbkJsb2NrID0gYmxvY2tzLmZpbmQoKGI6IFRlc3RCbG9jaykgPT4gYi50eXBlID09PSAnZXF1YXRpb24nKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9uQmxvY2spLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Jsb2NrIExhVGVYIERldGVjdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGRpc3BsYXkgbWF0aCB3aXRoIGRvdWJsZSBkb2xsYXIgc2lnbnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSAnJCRcXFxcaW50X3thfV57Yn0gZih4KSBcXFxcLCBkeCA9IEYoYikgLSBGKGEpJCQnO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBjb250ZW50VHlwZTogJ2xhdGV4JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzWzBdLnR5cGUpLnRvQmUoJ2VxdWF0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBMYVRlWCBlbnZpcm9ubWVudHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgXFxcXGJlZ2lue2VxdWF0aW9ufVxyXG5FID0gbWNeMlxyXG5cXFxcZW5ke2VxdWF0aW9ufWA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBjb250ZW50VHlwZTogJ2xhdGV4JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzWzBdLnR5cGUpLnRvQmUoJ2VxdWF0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBhbGlnbiBlbnZpcm9ubWVudHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgXFxcXGJlZ2lue2FsaWdufVxyXG54ICY9IGEgKyBiIFxcXFxcXFxcXHJcbnkgJj0gYyArIGRcclxuXFxcXGVuZHthbGlnbn1gO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbnRlbnQsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2Nrc1swXS50eXBlKS50b0JlKCdlcXVhdGlvbicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDb21wbGV4IExhVGVYIEV4cHJlc3Npb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZnJhY3Rpb25zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJyRcXFxcZnJhY3thfXtifSArIFxcXFxmcmFje2N9e2R9ID0gXFxcXGZyYWN7YWQgKyBiY317YmR9JCc7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBjb25zdCBibG9ja3MgPSByZXN1bHQuYmxvY2tzIGFzIFRlc3RCbG9ja1tdO1xyXG4gICAgICBjb25zdCBlcXVhdGlvbkJsb2NrID0gYmxvY2tzLmZpbmQoKGI6IFRlc3RCbG9jaykgPT4gYi50eXBlID09PSAnZXF1YXRpb24nKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9uQmxvY2spLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnRlZ3JhbHMgYW5kIHN1bW1hdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSAnJFxcXFxzdW1fe2k9MX1ee259IGkgPSBcXFxcZnJhY3tuKG4rMSl9ezJ9JCc7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBjb25zdCBibG9ja3MgPSByZXN1bHQuYmxvY2tzIGFzIFRlc3RCbG9ja1tdO1xyXG4gICAgICBjb25zdCBlcXVhdGlvbkJsb2NrID0gYmxvY2tzLmZpbmQoKGI6IFRlc3RCbG9jaykgPT4gYi50eXBlID09PSAnZXF1YXRpb24nKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9uQmxvY2spLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYXRyaWNlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9IGAkXFxcXGJlZ2lue3BtYXRyaXh9XHJcbmEgJiBiIFxcXFxcXFxcXHJcbmMgJiBkXHJcblxcXFxlbmR7cG1hdHJpeH0kYDtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2Nrc1swXS50eXBlKS50b0JlKCdlcXVhdGlvbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgR3JlZWsgbGV0dGVycyBhbmQgc3ltYm9scycsICgpID0+IHtcclxuICAgICAgY29uc3QgY29udGVudCA9ICckXFxcXGFscGhhICsgXFxcXGJldGEgPSBcXFxcZ2FtbWEgXFxcXGNkb3QgXFxcXGRlbHRhJCc7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChjb250ZW50LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBjb25zdCBibG9ja3MgPSByZXN1bHQuYmxvY2tzIGFzIFRlc3RCbG9ja1tdO1xyXG4gICAgICBjb25zdCBlcXVhdGlvbkJsb2NrID0gYmxvY2tzLmZpbmQoKGI6IFRlc3RCbG9jaykgPT4gYi50eXBlID09PSAnZXF1YXRpb24nKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9uQmxvY2spLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ01peGVkIENvbnRlbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0ZXh0IHdpdGggbXVsdGlwbGUgZXF1YXRpb25zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJ0ZpcnN0IGVxdWF0aW9uICRhID0gYiQgYW5kIHNlY29uZCAkYyA9IGQkIGluIHRleHQnO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBjb250ZW50VHlwZTogJ2xhdGV4JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBibG9ja3MgPSByZXN1bHQuYmxvY2tzIGFzIFRlc3RCbG9ja1tdO1xyXG4gICAgICBjb25zdCBlcXVhdGlvbnMgPSBibG9ja3MuZmlsdGVyKChiOiBUZXN0QmxvY2spID0+IGIudHlwZSA9PT0gJ2VxdWF0aW9uJyk7XHJcbiAgICAgIGV4cGVjdChlcXVhdGlvbnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBMYVRlWCBtaXhlZCB3aXRoIG1hcmtkb3duJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250ZW50ID0gJyMgTWF0aCBTZWN0aW9uXFxuXFxuVGhlIGZvcm11bGEgJEUgPSBtY14yJCBpcyAqKmltcG9ydGFudCoqLlxcblxcbiRGID0gbWEkJztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbnRlbnQsIHsgY29udGVudFR5cGU6ICdtYXJrZG93bicgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGNvbnN0IGJsb2NrcyA9IHJlc3VsdC5ibG9ja3MgYXMgVGVzdEJsb2NrW107XHJcbiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IGJsb2Nrcy5maWx0ZXIoKGI6IFRlc3RCbG9jaykgPT4gYi50eXBlID09PSAnZXF1YXRpb24nKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTGFUZVggVmFsaWRhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1hbGZvcm1lZCBMYVRlWCBncmFjZWZ1bGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYWxmb3JtZWQgPSAnJFxcXFxmcmFje2F9e2IkJzsgLy8gTWlzc2luZyBjbG9zaW5nIGJyYWNlXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChtYWxmb3JtZWQsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIC8vIFNob3VsZCBlaXRoZXIgZml4IG9yIHRyZWF0IGFzIHRleHRcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVubWF0Y2hlZCBkZWxpbWl0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1bm1hdGNoZWQgPSAnJGEgPSBiICsgYyc7IC8vIE1pc3NpbmcgY2xvc2luZyAkXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudCh1bm1hdGNoZWQsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBuZXN0ZWQgZGVsaW1pdGVycycsICgpID0+IHtcclxuICAgICAgY29uc3QgbmVzdGVkID0gJyRhID0gXFxcXHRleHR7bmVzdGVkfSQnOyAvLyBTaW1wbGlmaWVkIG5lc3RlZCBjb250ZW50XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlQ29udGVudChuZXN0ZWQsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0VxdWF0aW9uIEJsb2NrIFN0cnVjdHVyZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHByb3BlciBlcXVhdGlvbiBibG9jayBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSAnJHheMiArIHleMiA9IHJeMiQnO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoY29udGVudCwgeyBjb250ZW50VHlwZTogJ2xhdGV4JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgY29uc3QgYmxvY2tzID0gcmVzdWx0LmJsb2NrcyBhcyBUZXN0QmxvY2tbXTtcclxuICAgICAgY29uc3QgZXF1YXRpb25CbG9jayA9IGJsb2Nrcy5maW5kKChiOiBUZXN0QmxvY2spID0+IGIudHlwZSA9PT0gJ2VxdWF0aW9uJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoZXF1YXRpb25CbG9jaykudG9CZVZhbGlkTm90aW9uQmxvY2soKTtcclxuICAgICAgZXhwZWN0KGVxdWF0aW9uQmxvY2s/LnR5cGUpLnRvQmUoJ2VxdWF0aW9uJyk7XHJcbiAgICAgIGV4cGVjdChlcXVhdGlvbkJsb2NrPy5lcXVhdGlvbikudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBjb250ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZUNvbnRlbnQoJycsIHsgY29udGVudFR5cGU6ICdsYXRleCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzKS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgY29udGVudCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KG51bGwgYXMgYW55LCB7IGNvbnRlbnRUeXBlOiAnbGF0ZXgnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2NrcykudG9FcXVhbChbXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBlcXVhdGlvbnMgZWZmaWNpZW50bHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXhFcXVhdGlvbiA9IGAkXFxcXHN1bV97bj0xfV57XFxcXGluZnR5fSBcXFxcZnJhY3sxfXtuXjJ9ID0gXFxcXGZyYWN7XFxcXHBpXjJ9ezZ9JGA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VDb250ZW50KGNvbXBsZXhFcXVhdGlvbiwgeyBjb250ZW50VHlwZTogJ2xhdGV4JyB9KTtcclxuICAgICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDEwMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9