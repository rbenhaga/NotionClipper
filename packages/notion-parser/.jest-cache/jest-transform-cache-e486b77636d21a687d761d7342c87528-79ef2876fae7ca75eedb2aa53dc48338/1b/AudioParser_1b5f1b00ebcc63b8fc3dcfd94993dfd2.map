{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\parsers\\AudioParser.ts","mappings":"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","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\src\\parsers\\AudioParser.ts"],"sourcesContent":["/**\r\n * Parser spécialisé pour les fichiers audio\r\n */\r\n\r\nimport { BaseParser } from './BaseParser';\r\nimport type { ASTNode } from '../types/ast';\r\nimport type { ParseOptions } from '../types/options';\r\nimport type { AudioBlock } from '../types/notion';\r\n\r\nexport class AudioParser extends BaseParser {\r\n  private static readonly SUPPORTED_FORMATS = [\r\n    'mp3', 'wav', 'ogg', 'm4a', 'aac', 'flac', 'webm'\r\n  ];\r\n\r\n  private static readonly AUDIO_MIME_TYPES = [\r\n    'audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4', \r\n    'audio/aac', 'audio/flac', 'audio/webm'\r\n  ];\r\n\r\n  constructor(options: ParseOptions = {}) {\r\n    super(options);\r\n  }\r\n\r\n  parse(content: string): ASTNode[] {\r\n    const urls = this.extractUrls(content);\r\n    const audioUrls = urls.filter(url => this.isAudioUrl(url));\r\n    \r\n    return audioUrls.map(url => this.createAudioNode(url));\r\n  }\r\n\r\n  private extractUrls(content: string): string[] {\r\n    const urlPattern = /https?:\\/\\/[^\\s<>\"{}|\\\\^`[\\]]+/g;\r\n    const matches = content.match(urlPattern) || [];\r\n    \r\n    return matches.filter(url => {\r\n      try {\r\n        new URL(url);\r\n        return true;\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n  }\r\n\r\n  private isAudioUrl(url: string): boolean {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const pathname = urlObj.pathname.toLowerCase();\r\n      \r\n      // Vérifier l'extension\r\n      const extension = pathname.split('.').pop();\r\n      if (extension && AudioParser.SUPPORTED_FORMATS.includes(extension)) {\r\n        return true;\r\n      }\r\n      \r\n      // Vérifier les services audio connus\r\n      const audioServices = [\r\n        'soundcloud.com',\r\n        'spotify.com',\r\n        'apple.com/music',\r\n        'music.youtube.com',\r\n        'bandcamp.com'\r\n      ];\r\n      \r\n      return audioServices.some(service => urlObj.hostname.includes(service));\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private createAudioNode(url: string): ASTNode {\r\n    return {\r\n      type: 'audio',\r\n      content: url,\r\n      metadata: {\r\n        url,\r\n        format: this.detectAudioFormat(url),\r\n        isExternal: true\r\n      },\r\n      children: []\r\n    };\r\n  }\r\n\r\n  private detectAudioFormat(url: string): string {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const extension = urlObj.pathname.toLowerCase().split('.').pop();\r\n      \r\n      if (extension && AudioParser.SUPPORTED_FORMATS.includes(extension)) {\r\n        return extension;\r\n      }\r\n      \r\n      return 'unknown';\r\n    } catch {\r\n      return 'unknown';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Valide si un fichier audio est supporté\r\n   */\r\n  static validateAudioFile(file: File): boolean {\r\n    // Vérifier le type MIME\r\n    if (AudioParser.AUDIO_MIME_TYPES.includes(file.type)) {\r\n      return true;\r\n    }\r\n    \r\n    // Vérifier l'extension\r\n    const extension = file.name.toLowerCase().split('.').pop();\r\n    return extension ? AudioParser.SUPPORTED_FORMATS.includes(extension) : false;\r\n  }\r\n\r\n  /**\r\n   * Crée un bloc audio Notion depuis une URL\r\n   */\r\n  static createAudioBlock(url: string, caption?: string): AudioBlock {\r\n    return {\r\n      type: 'audio',\r\n      audio: {\r\n        type: 'external',\r\n        external: {\r\n          url\r\n        },\r\n        caption: caption ? [{\r\n          type: 'text',\r\n          text: {\r\n            content: caption\r\n          },\r\n          annotations: {},\r\n          plain_text: caption,\r\n          href: null\r\n        }] : []\r\n      }\r\n    };\r\n  }\r\n}"],"version":3}