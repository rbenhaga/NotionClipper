adf245f1b07e9830c756aa73276ff534
"use strict";
/**
 * Parser spécialisé pour les fichiers audio
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.AudioParser = void 0;
const BaseParser_1 = require("./BaseParser");
class AudioParser extends BaseParser_1.BaseParser {
    constructor(options = {}) {
        super(options);
    }
    parse(content) {
        const urls = this.extractUrls(content);
        const audioUrls = urls.filter(url => this.isAudioUrl(url));
        return audioUrls.map(url => this.createAudioNode(url));
    }
    extractUrls(content) {
        const urlPattern = /https?:\/\/[^\s<>"{}|\\^`[\]]+/g;
        const matches = content.match(urlPattern) || [];
        return matches.filter(url => {
            try {
                new URL(url);
                return true;
            }
            catch {
                return false;
            }
        });
    }
    isAudioUrl(url) {
        try {
            const urlObj = new URL(url);
            const pathname = urlObj.pathname.toLowerCase();
            // Vérifier l'extension
            const extension = pathname.split('.').pop();
            if (extension && AudioParser.SUPPORTED_FORMATS.includes(extension)) {
                return true;
            }
            // Vérifier les services audio connus
            const audioServices = [
                'soundcloud.com',
                'spotify.com',
                'apple.com/music',
                'music.youtube.com',
                'bandcamp.com'
            ];
            return audioServices.some(service => urlObj.hostname.includes(service));
        }
        catch {
            return false;
        }
    }
    createAudioNode(url) {
        return {
            type: 'audio',
            content: url,
            metadata: {
                url,
                format: this.detectAudioFormat(url),
                isExternal: true
            },
            children: []
        };
    }
    detectAudioFormat(url) {
        try {
            const urlObj = new URL(url);
            const extension = urlObj.pathname.toLowerCase().split('.').pop();
            if (extension && AudioParser.SUPPORTED_FORMATS.includes(extension)) {
                return extension;
            }
            return 'unknown';
        }
        catch {
            return 'unknown';
        }
    }
    /**
     * Valide si un fichier audio est supporté
     */
    static validateAudioFile(file) {
        // Vérifier le type MIME
        if (AudioParser.AUDIO_MIME_TYPES.includes(file.type)) {
            return true;
        }
        // Vérifier l'extension
        const extension = file.name.toLowerCase().split('.').pop();
        return extension ? AudioParser.SUPPORTED_FORMATS.includes(extension) : false;
    }
    /**
     * Crée un bloc audio Notion depuis une URL
     */
    static createAudioBlock(url, caption) {
        return {
            type: 'audio',
            audio: {
                type: 'external',
                external: {
                    url
                },
                caption: caption ? [{
                        type: 'text',
                        text: {
                            content: caption
                        },
                        annotations: {},
                        plain_text: caption,
                        href: null
                    }] : []
            }
        };
    }
}
exports.AudioParser = AudioParser;
AudioParser.SUPPORTED_FORMATS = [
    'mp3', 'wav', 'ogg', 'm4a', 'aac', 'flac', 'webm'
];
AudioParser.AUDIO_MIME_TYPES = [
    'audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4',
    'audio/aac', 'audio/flac', 'audio/webm'
];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcc3JjXFxwYXJzZXJzXFxBdWRpb1BhcnNlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7OztBQUVILDZDQUEwQztBQUsxQyxNQUFhLFdBQVksU0FBUSx1QkFBVTtJQVV6QyxZQUFZLFVBQXdCLEVBQUU7UUFDcEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBZTtRQUNuQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFM0QsT0FBTyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFTyxXQUFXLENBQUMsT0FBZTtRQUNqQyxNQUFNLFVBQVUsR0FBRyxpQ0FBaUMsQ0FBQztRQUNyRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVoRCxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDMUIsSUFBSSxDQUFDO2dCQUNILElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNiLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUFDLE1BQU0sQ0FBQztnQkFDUCxPQUFPLEtBQUssQ0FBQztZQUNmLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxVQUFVLENBQUMsR0FBVztRQUM1QixJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM1QixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRS9DLHVCQUF1QjtZQUN2QixNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzVDLElBQUksU0FBUyxJQUFJLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDbkUsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBRUQscUNBQXFDO1lBQ3JDLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixnQkFBZ0I7Z0JBQ2hCLGFBQWE7Z0JBQ2IsaUJBQWlCO2dCQUNqQixtQkFBbUI7Z0JBQ25CLGNBQWM7YUFDZixDQUFDO1lBRUYsT0FBTyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUMxRSxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO0lBQ0gsQ0FBQztJQUVPLGVBQWUsQ0FBQyxHQUFXO1FBQ2pDLE9BQU87WUFDTCxJQUFJLEVBQUUsT0FBTztZQUNiLE9BQU8sRUFBRSxHQUFHO1lBQ1osUUFBUSxFQUFFO2dCQUNSLEdBQUc7Z0JBQ0gsTUFBTSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUM7Z0JBQ25DLFVBQVUsRUFBRSxJQUFJO2FBQ2pCO1lBQ0QsUUFBUSxFQUFFLEVBQUU7U0FDYixDQUFDO0lBQ0osQ0FBQztJQUVPLGlCQUFpQixDQUFDLEdBQVc7UUFDbkMsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDNUIsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFakUsSUFBSSxTQUFTLElBQUksV0FBVyxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUNuRSxPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDO1lBRUQsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztRQUFDLE1BQU0sQ0FBQztZQUNQLE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsaUJBQWlCLENBQUMsSUFBVTtRQUNqQyx3QkFBd0I7UUFDeEIsSUFBSSxXQUFXLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3JELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELHVCQUF1QjtRQUN2QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMzRCxPQUFPLFNBQVMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQy9FLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFXLEVBQUUsT0FBZ0I7UUFDbkQsT0FBTztZQUNMLElBQUksRUFBRSxPQUFPO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRSxVQUFVO2dCQUNoQixRQUFRLEVBQUU7b0JBQ1IsR0FBRztpQkFDSjtnQkFDRCxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNsQixJQUFJLEVBQUUsTUFBTTt3QkFDWixJQUFJLEVBQUU7NEJBQ0osT0FBTyxFQUFFLE9BQU87eUJBQ2pCO3dCQUNELFdBQVcsRUFBRSxFQUFFO3dCQUNmLFVBQVUsRUFBRSxPQUFPO3dCQUNuQixJQUFJLEVBQUUsSUFBSTtxQkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7YUFDUjtTQUNGLENBQUM7SUFDSixDQUFDOztBQTdISCxrQ0E4SEM7QUE3SHlCLDZCQUFpQixHQUFHO0lBQzFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU07Q0FDbEQsQ0FBQztBQUVzQiw0QkFBZ0IsR0FBRztJQUN6QyxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxXQUFXO0lBQ25ELFdBQVcsRUFBRSxZQUFZLEVBQUUsWUFBWTtDQUN4QyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xccmF5YW5cXERlc2t0b3BcXERldlxcTm90aW9uQ2xpcHBlclxccGFja2FnZXNcXG5vdGlvbi1wYXJzZXJcXHNyY1xccGFyc2Vyc1xcQXVkaW9QYXJzZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFBhcnNlciBzcMOpY2lhbGlzw6kgcG91ciBsZXMgZmljaGllcnMgYXVkaW9cclxuICovXHJcblxyXG5pbXBvcnQgeyBCYXNlUGFyc2VyIH0gZnJvbSAnLi9CYXNlUGFyc2VyJztcclxuaW1wb3J0IHR5cGUgeyBBU1ROb2RlIH0gZnJvbSAnLi4vdHlwZXMvYXN0JztcclxuaW1wb3J0IHR5cGUgeyBQYXJzZU9wdGlvbnMgfSBmcm9tICcuLi90eXBlcy9vcHRpb25zJztcclxuaW1wb3J0IHR5cGUgeyBBdWRpb0Jsb2NrIH0gZnJvbSAnLi4vdHlwZXMvbm90aW9uJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBdWRpb1BhcnNlciBleHRlbmRzIEJhc2VQYXJzZXIge1xyXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFNVUFBPUlRFRF9GT1JNQVRTID0gW1xyXG4gICAgJ21wMycsICd3YXYnLCAnb2dnJywgJ200YScsICdhYWMnLCAnZmxhYycsICd3ZWJtJ1xyXG4gIF07XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFVRElPX01JTUVfVFlQRVMgPSBbXHJcbiAgICAnYXVkaW8vbXBlZycsICdhdWRpby93YXYnLCAnYXVkaW8vb2dnJywgJ2F1ZGlvL21wNCcsIFxyXG4gICAgJ2F1ZGlvL2FhYycsICdhdWRpby9mbGFjJywgJ2F1ZGlvL3dlYm0nXHJcbiAgXTtcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9uczogUGFyc2VPcHRpb25zID0ge30pIHtcclxuICAgIHN1cGVyKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcGFyc2UoY29udGVudDogc3RyaW5nKTogQVNUTm9kZVtdIHtcclxuICAgIGNvbnN0IHVybHMgPSB0aGlzLmV4dHJhY3RVcmxzKGNvbnRlbnQpO1xyXG4gICAgY29uc3QgYXVkaW9VcmxzID0gdXJscy5maWx0ZXIodXJsID0+IHRoaXMuaXNBdWRpb1VybCh1cmwpKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIGF1ZGlvVXJscy5tYXAodXJsID0+IHRoaXMuY3JlYXRlQXVkaW9Ob2RlKHVybCkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBleHRyYWN0VXJscyhjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCB1cmxQYXR0ZXJuID0gL2h0dHBzPzpcXC9cXC9bXlxcczw+XCJ7fXxcXFxcXmBbXFxdXSsvZztcclxuICAgIGNvbnN0IG1hdGNoZXMgPSBjb250ZW50Lm1hdGNoKHVybFBhdHRlcm4pIHx8IFtdO1xyXG4gICAgXHJcbiAgICByZXR1cm4gbWF0Y2hlcy5maWx0ZXIodXJsID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBuZXcgVVJMKHVybCk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzQXVkaW9VcmwodXJsOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsKTtcclxuICAgICAgY29uc3QgcGF0aG5hbWUgPSB1cmxPYmoucGF0aG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFbDqXJpZmllciBsJ2V4dGVuc2lvblxyXG4gICAgICBjb25zdCBleHRlbnNpb24gPSBwYXRobmFtZS5zcGxpdCgnLicpLnBvcCgpO1xyXG4gICAgICBpZiAoZXh0ZW5zaW9uICYmIEF1ZGlvUGFyc2VyLlNVUFBPUlRFRF9GT1JNQVRTLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVsOpcmlmaWVyIGxlcyBzZXJ2aWNlcyBhdWRpbyBjb25udXNcclxuICAgICAgY29uc3QgYXVkaW9TZXJ2aWNlcyA9IFtcclxuICAgICAgICAnc291bmRjbG91ZC5jb20nLFxyXG4gICAgICAgICdzcG90aWZ5LmNvbScsXHJcbiAgICAgICAgJ2FwcGxlLmNvbS9tdXNpYycsXHJcbiAgICAgICAgJ211c2ljLnlvdXR1YmUuY29tJyxcclxuICAgICAgICAnYmFuZGNhbXAuY29tJ1xyXG4gICAgICBdO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIGF1ZGlvU2VydmljZXMuc29tZShzZXJ2aWNlID0+IHVybE9iai5ob3N0bmFtZS5pbmNsdWRlcyhzZXJ2aWNlKSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVBdWRpb05vZGUodXJsOiBzdHJpbmcpOiBBU1ROb2RlIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR5cGU6ICdhdWRpbycsXHJcbiAgICAgIGNvbnRlbnQ6IHVybCxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICB1cmwsXHJcbiAgICAgICAgZm9ybWF0OiB0aGlzLmRldGVjdEF1ZGlvRm9ybWF0KHVybCksXHJcbiAgICAgICAgaXNFeHRlcm5hbDogdHJ1ZVxyXG4gICAgICB9LFxyXG4gICAgICBjaGlsZHJlbjogW11cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGVjdEF1ZGlvRm9ybWF0KHVybDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsKTtcclxuICAgICAgY29uc3QgZXh0ZW5zaW9uID0gdXJsT2JqLnBhdGhuYW1lLnRvTG93ZXJDYXNlKCkuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChleHRlbnNpb24gJiYgQXVkaW9QYXJzZXIuU1VQUE9SVEVEX0ZPUk1BVFMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xyXG4gICAgICAgIHJldHVybiBleHRlbnNpb247XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiAndW5rbm93bic7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgcmV0dXJuICd1bmtub3duJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkZSBzaSB1biBmaWNoaWVyIGF1ZGlvIGVzdCBzdXBwb3J0w6lcclxuICAgKi9cclxuICBzdGF0aWMgdmFsaWRhdGVBdWRpb0ZpbGUoZmlsZTogRmlsZSk6IGJvb2xlYW4ge1xyXG4gICAgLy8gVsOpcmlmaWVyIGxlIHR5cGUgTUlNRVxyXG4gICAgaWYgKEF1ZGlvUGFyc2VyLkFVRElPX01JTUVfVFlQRVMuaW5jbHVkZXMoZmlsZS50eXBlKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVsOpcmlmaWVyIGwnZXh0ZW5zaW9uXHJcbiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlLm5hbWUudG9Mb3dlckNhc2UoKS5zcGxpdCgnLicpLnBvcCgpO1xyXG4gICAgcmV0dXJuIGV4dGVuc2lvbiA/IEF1ZGlvUGFyc2VyLlNVUFBPUlRFRF9GT1JNQVRTLmluY2x1ZGVzKGV4dGVuc2lvbikgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyw6llIHVuIGJsb2MgYXVkaW8gTm90aW9uIGRlcHVpcyB1bmUgVVJMXHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZUF1ZGlvQmxvY2sodXJsOiBzdHJpbmcsIGNhcHRpb24/OiBzdHJpbmcpOiBBdWRpb0Jsb2NrIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR5cGU6ICdhdWRpbycsXHJcbiAgICAgIGF1ZGlvOiB7XHJcbiAgICAgICAgdHlwZTogJ2V4dGVybmFsJyxcclxuICAgICAgICBleHRlcm5hbDoge1xyXG4gICAgICAgICAgdXJsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYXB0aW9uOiBjYXB0aW9uID8gW3tcclxuICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgIHRleHQ6IHtcclxuICAgICAgICAgICAgY29udGVudDogY2FwdGlvblxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGFubm90YXRpb25zOiB7fSxcclxuICAgICAgICAgIHBsYWluX3RleHQ6IGNhcHRpb24sXHJcbiAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgfV0gOiBbXVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxufSJdLCJ2ZXJzaW9uIjozfQ==