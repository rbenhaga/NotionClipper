b6d956733cc4cbf1756cae3b763fdeaf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MarkdownDetector = void 0;
class MarkdownDetector {
    detect(content) {
        if (!content?.trim()) {
            return { type: 'markdown', confidence: 0.0 };
        }
        let confidence = 0;
        const lines = content.split('\n');
        // Headers (# ## ###)
        const headerLines = lines.filter(line => line.match(/^#{1,6}\s+/)).length;
        if (headerLines > 0) {
            confidence += Math.min(headerLines * 0.2, 0.4);
        }
        // Lists (- * + 1.)
        const listLines = lines.filter(line => line.match(/^[\s]*[-*+]\s+/) || line.match(/^[\s]*\d+\.\s+/)).length;
        if (listLines > 0) {
            confidence += Math.min(listLines * 0.15, 0.3);
        }
        // Code blocks (```)
        const codeBlocks = (content.match(/```/g) || []).length / 2;
        if (codeBlocks > 0) {
            confidence += Math.min(codeBlocks * 0.2, 0.3);
        }
        // Inline code (`)
        const inlineCode = (content.match(/`[^`]+`/g) || []).length;
        if (inlineCode > 0) {
            confidence += Math.min(inlineCode * 0.05, 0.15);
        }
        // Bold/Italic (**text** *text*)
        const boldItalic = (content.match(/\*\*[^*]+\*\*|\*[^*]+\*/g) || []).length;
        if (boldItalic > 0) {
            confidence += Math.min(boldItalic * 0.08, 0.25);
        }
        // Links ([text](url))
        const links = (content.match(/\[[^\]]+\]\([^)]+\)/g) || []).length;
        if (links > 0) {
            confidence += Math.min(links * 0.1, 0.2);
        }
        // Images (![alt](url))
        const images = (content.match(/!\[[^\]]*\]\([^)]+\)/g) || []).length;
        if (images > 0) {
            confidence += Math.min(images * 0.15, 0.2);
        }
        // Tables (|col1|col2|)
        const tableLines = lines.filter(line => line.includes('|') && line.split('|').length > 2).length;
        if (tableLines >= 2) {
            confidence += Math.min(tableLines * 0.1, 0.25);
        }
        // Blockquotes (>)
        const quoteLines = lines.filter(line => line.match(/^>\s+/)).length;
        if (quoteLines > 0) {
            confidence += Math.min(quoteLines * 0.08, 0.15);
        }
        // Horizontal rules (--- *** ___)
        const hrLines = lines.filter(line => line.match(/^(---|\*\*\*|___)$/)).length;
        if (hrLines > 0) {
            confidence += Math.min(hrLines * 0.1, 0.1);
        }
        // Checkboxes (- [ ] - [x])
        const checkboxes = (content.match(/- \[[x ]\]/g) || []).length;
        if (checkboxes > 0) {
            confidence += Math.min(checkboxes * 0.1, 0.2);
        }
        // Special case: single markdown element should be detected as markdown
        // even if confidence is below threshold
        const totalLines = lines.filter(line => line.trim()).length;
        if (totalLines === 1) {
            // Single line content
            if (headerLines === 1) {
                confidence = Math.max(confidence, 0.8); // Single header
            }
            else if (listLines === 1) {
                confidence = Math.max(confidence, 0.7); // Single list item
            }
            else if (checkboxes === 1) {
                confidence = Math.max(confidence, 0.7); // Single checkbox
            }
            else if (links > 0 || images > 0) {
                confidence = Math.max(confidence, 0.6); // Contains links/images
            }
            else if (boldItalic > 0) {
                confidence = Math.max(confidence, 0.5); // Contains formatting
            }
        }
        else if (totalLines <= 3) {
            // Short content with clear markdown indicators
            if (headerLines > 0 || listLines > 0 || checkboxes > 0) {
                confidence = Math.max(confidence, 0.6);
            }
        }
        return {
            type: 'markdown',
            confidence: Math.min(confidence, 1.0),
            metadata: {
                features: {
                    headers: headerLines,
                    lists: listLines,
                    codeBlocks,
                    links,
                    images,
                    tables: tableLines >= 2,
                    checkboxes
                }
            }
        };
    }
}
exports.MarkdownDetector = MarkdownDetector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcc3JjXFxkZXRlY3RvcnNcXE1hcmtkb3duRGV0ZWN0b3IudHMiLCJtYXBwaW5ncyI6Ijs7O0FBRUEsTUFBYSxnQkFBZ0I7SUFDM0IsTUFBTSxDQUFDLE9BQWU7UUFDcEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQ3JCLE9BQU8sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUMvQyxDQUFDO1FBRUQsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbEMscUJBQXFCO1FBQ3JCLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDdEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FDekIsQ0FBQyxNQUFNLENBQUM7UUFDVCxJQUFJLFdBQVcsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNwQixVQUFVLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELENBQUM7UUFFRCxtQkFBbUI7UUFDbkIsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUNwQyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUM3RCxDQUFDLE1BQU0sQ0FBQztRQUNULElBQUksU0FBUyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ2xCLFVBQVUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEQsQ0FBQztR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QUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyx3QkFBd0I7WUFDbEUsQ0FBQztpQkFBTSxJQUFJLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDMUIsVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsc0JBQXNCO1lBQ2hFLENBQUM7UUFDSCxDQUFDO2FBQU0sSUFBSSxVQUFVLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0IsK0NBQStDO1lBQy9DLElBQUksV0FBVyxHQUFHLENBQUMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxJQUFJLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDdkQsVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTztZQUNMLElBQUksRUFBRSxVQUFVO1lBQ2hCLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUM7WUFDckMsUUFBUSxFQUFFO2dCQUNSLFFBQVEsRUFBRTtvQkFDUixPQUFPLEVBQUUsV0FBVztvQkFDcEIsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFVBQVU7b0JBQ1YsS0FBSztvQkFDTCxNQUFNO29CQUNOLE1BQU0sRUFBRSxVQUFVLElBQUksQ0FBQztvQkFDdkIsVUFBVTtpQkFDWDthQUNGO1NBQ0YsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQTdIRCw0Q0E2SEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcc3JjXFxkZXRlY3RvcnNcXE1hcmtkb3duRGV0ZWN0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBEZXRlY3Rpb25SZXN1bHQgfSBmcm9tICcuL0NvbnRlbnREZXRlY3Rvcic7XHJcblxyXG5leHBvcnQgY2xhc3MgTWFya2Rvd25EZXRlY3RvciB7XHJcbiAgZGV0ZWN0KGNvbnRlbnQ6IHN0cmluZyk6IERldGVjdGlvblJlc3VsdCB7XHJcbiAgICBpZiAoIWNvbnRlbnQ/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyB0eXBlOiAnbWFya2Rvd24nLCBjb25maWRlbmNlOiAwLjAgfTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29uZmlkZW5jZSA9IDA7XHJcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xyXG5cclxuICAgIC8vIEhlYWRlcnMgKCMgIyMgIyMjKVxyXG4gICAgY29uc3QgaGVhZGVyTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBcclxuICAgICAgbGluZS5tYXRjaCgvXiN7MSw2fVxccysvKVxyXG4gICAgKS5sZW5ndGg7XHJcbiAgICBpZiAoaGVhZGVyTGluZXMgPiAwKSB7XHJcbiAgICAgIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4oaGVhZGVyTGluZXMgKiAwLjIsIDAuNCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGlzdHMgKC0gKiArIDEuKVxyXG4gICAgY29uc3QgbGlzdExpbmVzID0gbGluZXMuZmlsdGVyKGxpbmUgPT4gXHJcbiAgICAgIGxpbmUubWF0Y2goL15bXFxzXSpbLSorXVxccysvKSB8fCBsaW5lLm1hdGNoKC9eW1xcc10qXFxkK1xcLlxccysvKVxyXG4gICAgKS5sZW5ndGg7XHJcbiAgICBpZiAobGlzdExpbmVzID4gMCkge1xyXG4gICAgICBjb25maWRlbmNlICs9IE1hdGgubWluKGxpc3RMaW5lcyAqIDAuMTUsIDAuMyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29kZSBibG9ja3MgKGBgYClcclxuICAgIGNvbnN0IGNvZGVCbG9ja3MgPSAoY29udGVudC5tYXRjaCgvYGBgL2cpIHx8IFtdKS5sZW5ndGggLyAyO1xyXG4gICAgaWYgKGNvZGVCbG9ja3MgPiAwKSB7XHJcbiAgICAgIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4oY29kZUJsb2NrcyAqIDAuMiwgMC4zKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbmxpbmUgY29kZSAoYClcclxuICAgIGNvbnN0IGlubGluZUNvZGUgPSAoY29udGVudC5tYXRjaCgvYFteYF0rYC9nKSB8fCBbXSkubGVuZ3RoO1xyXG4gICAgaWYgKGlubGluZUNvZGUgPiAwKSB7XHJcbiAgICAgIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4oaW5saW5lQ29kZSAqIDAuMDUsIDAuMTUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJvbGQvSXRhbGljICgqKnRleHQqKiAqdGV4dCopXHJcbiAgICBjb25zdCBib2xkSXRhbGljID0gKGNvbnRlbnQubWF0Y2goL1xcKlxcKlteKl0rXFwqXFwqfFxcKlteKl0rXFwqL2cpIHx8IFtdKS5sZW5ndGg7XHJcbiAgICBpZiAoYm9sZEl0YWxpYyA+IDApIHtcclxuICAgICAgY29uZmlkZW5jZSArPSBNYXRoLm1pbihib2xkSXRhbGljICogMC4wOCwgMC4yNSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGlua3MgKFt0ZXh0XSh1cmwpKVxyXG4gICAgY29uc3QgbGlua3MgPSAoY29udGVudC5tYXRjaCgvXFxbW15cXF1dK1xcXVxcKFteKV0rXFwpL2cpIHx8IFtdKS5sZW5ndGg7XHJcbiAgICBpZiAobGlua3MgPiAwKSB7XHJcbiAgICAgIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4obGlua3MgKiAwLjEsIDAuMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW1hZ2VzICghW2FsdF0odXJsKSlcclxuICAgIGNvbnN0IGltYWdlcyA9IChjb250ZW50Lm1hdGNoKC8hXFxbW15cXF1dKlxcXVxcKFteKV0rXFwpL2cpIHx8IFtdKS5sZW5ndGg7XHJcbiAgICBpZiAoaW1hZ2VzID4gMCkge1xyXG4gICAgICBjb25maWRlbmNlICs9IE1hdGgubWluKGltYWdlcyAqIDAuMTUsIDAuMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGFibGVzICh8Y29sMXxjb2wyfClcclxuICAgIGNvbnN0IHRhYmxlTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBcclxuICAgICAgbGluZS5pbmNsdWRlcygnfCcpICYmIGxpbmUuc3BsaXQoJ3wnKS5sZW5ndGggPiAyXHJcbiAgICApLmxlbmd0aDtcclxuICAgIGlmICh0YWJsZUxpbmVzID49IDIpIHtcclxuICAgICAgY29uZmlkZW5jZSArPSBNYXRoLm1pbih0YWJsZUxpbmVzICogMC4xLCAwLjI1KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCbG9ja3F1b3RlcyAoPilcclxuICAgIGNvbnN0IHF1b3RlTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBcclxuICAgICAgbGluZS5tYXRjaCgvXj5cXHMrLylcclxuICAgICkubGVuZ3RoO1xyXG4gICAgaWYgKHF1b3RlTGluZXMgPiAwKSB7XHJcbiAgICAgIGNvbmZpZGVuY2UgKz0gTWF0aC5taW4ocXVvdGVMaW5lcyAqIDAuMDgsIDAuMTUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhvcml6b250YWwgcnVsZXMgKC0tLSAqKiogX19fKVxyXG4gICAgY29uc3QgaHJMaW5lcyA9IGxpbmVzLmZpbHRlcihsaW5lID0+IFxyXG4gICAgICBsaW5lLm1hdGNoKC9eKC0tLXxcXCpcXCpcXCp8X19fKSQvKVxyXG4gICAgKS5sZW5ndGg7XHJcbiAgICBpZiAoaHJMaW5lcyA+IDApIHtcclxuICAgICAgY29uZmlkZW5jZSArPSBNYXRoLm1pbihockxpbmVzICogMC4xLCAwLjEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrYm94ZXMgKC0gWyBdIC0gW3hdKVxyXG4gICAgY29uc3QgY2hlY2tib3hlcyA9IChjb250ZW50Lm1hdGNoKC8tIFxcW1t4IF1cXF0vZykgfHwgW10pLmxlbmd0aDtcclxuICAgIGlmIChjaGVja2JveGVzID4gMCkge1xyXG4gICAgICBjb25maWRlbmNlICs9IE1hdGgubWluKGNoZWNrYm94ZXMgKiAwLjEsIDAuMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU3BlY2lhbCBjYXNlOiBzaW5nbGUgbWFya2Rvd24gZWxlbWVudCBzaG91bGQgYmUgZGV0ZWN0ZWQgYXMgbWFya2Rvd25cclxuICAgIC8vIGV2ZW4gaWYgY29uZmlkZW5jZSBpcyBiZWxvdyB0aHJlc2hvbGRcclxuICAgIGNvbnN0IHRvdGFsTGluZXMgPSBsaW5lcy5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICBpZiAodG90YWxMaW5lcyA9PT0gMSkge1xyXG4gICAgICAvLyBTaW5nbGUgbGluZSBjb250ZW50XHJcbiAgICAgIGlmIChoZWFkZXJMaW5lcyA9PT0gMSkge1xyXG4gICAgICAgIGNvbmZpZGVuY2UgPSBNYXRoLm1heChjb25maWRlbmNlLCAwLjgpOyAvLyBTaW5nbGUgaGVhZGVyXHJcbiAgICAgIH0gZWxzZSBpZiAobGlzdExpbmVzID09PSAxKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIDAuNyk7IC8vIFNpbmdsZSBsaXN0IGl0ZW1cclxuICAgICAgfSBlbHNlIGlmIChjaGVja2JveGVzID09PSAxKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIDAuNyk7IC8vIFNpbmdsZSBjaGVja2JveFxyXG4gICAgICB9IGVsc2UgaWYgKGxpbmtzID4gMCB8fCBpbWFnZXMgPiAwKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIDAuNik7IC8vIENvbnRhaW5zIGxpbmtzL2ltYWdlc1xyXG4gICAgICB9IGVsc2UgaWYgKGJvbGRJdGFsaWMgPiAwKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIDAuNSk7IC8vIENvbnRhaW5zIGZvcm1hdHRpbmdcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0b3RhbExpbmVzIDw9IDMpIHtcclxuICAgICAgLy8gU2hvcnQgY29udGVudCB3aXRoIGNsZWFyIG1hcmtkb3duIGluZGljYXRvcnNcclxuICAgICAgaWYgKGhlYWRlckxpbmVzID4gMCB8fCBsaXN0TGluZXMgPiAwIHx8IGNoZWNrYm94ZXMgPiAwKSB7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIDAuNik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0eXBlOiAnbWFya2Rvd24nLFxyXG4gICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihjb25maWRlbmNlLCAxLjApLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGZlYXR1cmVzOiB7XHJcbiAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJMaW5lcyxcclxuICAgICAgICAgIGxpc3RzOiBsaXN0TGluZXMsXHJcbiAgICAgICAgICBjb2RlQmxvY2tzLFxyXG4gICAgICAgICAgbGlua3MsXHJcbiAgICAgICAgICBpbWFnZXMsXHJcbiAgICAgICAgICB0YWJsZXM6IHRhYmxlTGluZXMgPj0gMixcclxuICAgICAgICAgIGNoZWNrYm94ZXNcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG59Il0sInZlcnNpb24iOjN9