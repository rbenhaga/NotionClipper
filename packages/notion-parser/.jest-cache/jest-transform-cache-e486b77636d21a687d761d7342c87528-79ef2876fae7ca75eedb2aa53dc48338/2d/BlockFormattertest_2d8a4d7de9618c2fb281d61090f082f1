607f585e25ef7fb357012a8dc6532d4e
"use strict";
/**
 * Tests unitaires pour BlockFormatter - Cahier des Charges v2.1
 * Couvre le formatage et l'optimisation des blocs Notion
 */
Object.defineProperty(exports, "__esModule", { value: true });
const BlockFormatter_1 = require("../../../src/formatters/BlockFormatter");
describe('BlockFormatter - Cahier des Charges v2.1', () => {
    let formatter;
    beforeEach(() => {
        formatter = new BlockFormatter_1.BlockFormatter();
    });
    describe('Empty Block Removal', () => {
        it('should remove empty paragraph blocks', () => {
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: []
                    }
                },
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: 'Valid content' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: 'Valid content',
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { removeEmptyBlocks: true });
            expect(result).toHaveLength(1);
            expect(result[0].type).toBe('paragraph');
        });
        it('should remove empty heading blocks', () => {
            const blocks = [
                {
                    type: 'heading_1',
                    heading_1: {
                        rich_text: []
                    }
                },
                {
                    type: 'heading_2',
                    heading_2: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: 'Valid heading' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: 'Valid heading',
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { removeEmptyBlocks: true });
            expect(result).toHaveLength(1);
            expect(result[0].type).toBe('heading_2');
        });
        it('should keep non-text blocks even if empty', () => {
            const blocks = [
                {
                    type: 'divider',
                    divider: {}
                },
                {
                    type: 'image',
                    image: {
                        type: 'external',
                        external: { url: 'https://example.com/image.jpg' }
                    }
                }
            ];
            const result = formatter.format(blocks, { removeEmptyBlocks: true });
            expect(result).toHaveLength(2);
        });
    });
    describe('Whitespace Normalization', () => {
        it('should normalize whitespace in rich text', () => {
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: '  Multiple   spaces   here  ' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: '  Multiple   spaces   here  ',
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { normalizeWhitespace: true });
            expect(result).toHaveLength(1);
            const richText = result[0].paragraph.rich_text[0];
            expect(richText.text.content).toBe('Multiple spaces here');
        });
        it('should preserve code block whitespace', () => {
            const blocks = [
                {
                    type: 'code',
                    code: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: '  function test() {\n    return true;\n  }' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: '  function test() {\n    return true;\n  }',
                                href: null
                            }
                        ],
                        language: 'javascript'
                    }
                }
            ];
            const result = formatter.format(blocks, { normalizeWhitespace: true });
            expect(result).toHaveLength(1);
            const richText = result[0].code.rich_text[0];
            // Code whitespace should be preserved
            expect(richText.text.content).toContain('  function');
        });
    });
    describe('Color Application', () => {
        it('should apply color to all blocks when requested', () => {
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: 'Test content' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: 'Test content',
                                href: null
                            }
                        ],
                        color: 'default'
                    }
                },
                {
                    type: 'heading_1',
                    heading_1: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: 'Heading' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: 'Heading',
                                href: null
                            }
                        ],
                        color: 'default'
                    }
                }
            ];
            const result = formatter.format(blocks, {
                color: 'blue',
                applyColorToAll: true
            });
            expect(result).toHaveLength(2);
            expect(result[0].paragraph.color).toBe('blue');
            expect(result[1].heading_1.color).toBe('blue');
        });
    });
    describe('Block Limits Enforcement', () => {
        it('should enforce Notion block limits', () => {
            const longContent = 'a'.repeat(3000); // Exceeds 2000 char limit
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: longContent },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: longContent,
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { enforceBlockLimits: true });
            expect(result).toHaveLength(1);
            const richText = result[0].paragraph.rich_text[0];
            expect(richText.text.content.length).toBeLessThanOrEqual(2000);
        });
        it('should limit table width to 5 columns', () => {
            const wideTable = {
                type: 'table',
                table: {
                    table_width: 8,
                    children: []
                }
            };
            const result = formatter.format([wideTable], { enforceBlockLimits: true });
            expect(result).toHaveLength(1);
            expect(result[0].table.table_width).toBeLessThanOrEqual(5);
        });
    });
    describe('Structure Optimization', () => {
        it('should optimize nested block structure', () => {
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: 'Content' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: 'Content',
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { optimizeStructure: true });
            expect(result).toHaveLength(1);
            expect(result[0].type).toBe('paragraph');
        });
        it('should handle deeply nested blocks', () => {
            const deeplyNested = {
                type: 'toggle',
                toggle: {
                    rich_text: [
                        {
                            type: 'text',
                            text: { content: 'Toggle' },
                            annotations: {
                                bold: false,
                                italic: false,
                                strikethrough: false,
                                underline: false,
                                code: false,
                                color: 'default'
                            },
                            plain_text: 'Toggle',
                            href: null
                        }
                    ]
                },
                children: [
                    {
                        type: 'paragraph',
                        paragraph: {
                            rich_text: [
                                {
                                    type: 'text',
                                    text: { content: 'Nested content' },
                                    annotations: {
                                        bold: false,
                                        italic: false,
                                        strikethrough: false,
                                        underline: false,
                                        code: false,
                                        color: 'default'
                                    },
                                    plain_text: 'Nested content',
                                    href: null
                                }
                            ]
                        }
                    }
                ]
            };
            const result = formatter.format([deeplyNested], {
                optimizeStructure: true,
                maxBlockDepth: 3
            });
            expect(result).toHaveLength(1);
            expect(result[0].type).toBe('toggle');
        });
    });
    describe('Rich Text Trimming', () => {
        it('should trim rich text content', () => {
            const blocks = [
                {
                    type: 'paragraph',
                    paragraph: {
                        rich_text: [
                            {
                                type: 'text',
                                text: { content: '  Trimmed content  ' },
                                annotations: {
                                    bold: false,
                                    italic: false,
                                    strikethrough: false,
                                    underline: false,
                                    code: false,
                                    color: 'default'
                                },
                                plain_text: '  Trimmed content  ',
                                href: null
                            }
                        ]
                    }
                }
            ];
            const result = formatter.format(blocks, { trimRichText: true });
            expect(result).toHaveLength(1);
            const richText = result[0].paragraph.rich_text[0];
            expect(richText.text.content).toBe('Trimmed content');
            expect(richText.plain_text).toBe('Trimmed content');
        });
    });
    describe('Performance and Edge Cases', () => {
        it('should handle large number of blocks efficiently', () => {
            const manyBlocks = Array(1000).fill(0).map((_, i) => ({
                type: 'paragraph',
                paragraph: {
                    rich_text: [
                        {
                            type: 'text',
                            text: { content: `Paragraph ${i}` },
                            annotations: {
                                bold: false,
                                italic: false,
                                strikethrough: false,
                                underline: false,
                                code: false,
                                color: 'default'
                            },
                            plain_text: `Paragraph ${i}`,
                            href: null
                        }
                    ]
                }
            }));
            const startTime = Date.now();
            const result = formatter.format(manyBlocks, {
                removeEmptyBlocks: true,
                normalizeWhitespace: true
            });
            const duration = Date.now() - startTime;
            expect(result).toHaveLength(1000);
            expect(duration).toBeLessThan(100); // Should be fast
        });
        it('should handle empty input', () => {
            const result = formatter.format([], { removeEmptyBlocks: true });
            expect(result).toEqual([]);
        });
        it('should handle null/undefined blocks gracefully', () => {
            const blocks = [null, undefined];
            const result = formatter.format(blocks, { removeEmptyBlocks: true });
            expect(result).toEqual([]);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHVuaXRcXGZvcm1hdHRlcnNcXEJsb2NrRm9ybWF0dGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCwyRUFBd0U7QUFHeEUsUUFBUSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtJQUN4RCxJQUFJLFNBQXlCLENBQUM7SUFFOUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFNBQVMsR0FBRyxJQUFJLCtCQUFjLEVBQUUsQ0FBQztJQUNuQyxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUM5QyxNQUFNLE1BQU0sR0FBa0I7Z0JBQzVCO29CQUNFLElBQUksRUFBRSxXQUFXO29CQUNqQixTQUFTLEVBQUU7d0JBQ1QsU0FBUyxFQUFFLEVBQUU7cUJBQ2Q7aUJBQ0s7Z0JBQ1I7b0JBQ0UsSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLFNBQVMsRUFBRTt3QkFDVCxTQUFTLEVBQUU7NEJBQ1Q7Z0NBQ0UsSUFBSSxFQUFFLE1BQU07Z0NBQ1osSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRTtnQ0FDbEMsV0FBVyxFQUFFO29DQUNYLElBQUksRUFBRSxLQUFLO29DQUNYLE1BQU0sRUFBRSxLQUFLO29DQUNiLGFBQWEsRUFBRSxLQUFLO29DQUNwQixTQUFTLEVBQUUsS0FBSztvQ0FDaEIsSUFBSSxFQUFFLEtBQUs7b0NBQ1gsS0FBSyxFQUFFLFNBQVM7aUNBQ2pCO2dDQUNELFVBQVUsRUFBRSxlQUFlO2dDQUMzQixJQUFJLEVBQUUsSUFBSTs2QkFDWDt5QkFDRjtxQkFDRjtpQkFDSzthQUNULENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLGlC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Q0FBQyxDQUFDLENBQUMsaUJBQWlCO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtZQUNuQyxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLGlCQUFpQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFDakUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDeEQsTUFBTSxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFRLENBQUM7WUFDeEMsTUFBTSxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xccmF5YW5cXERlc2t0b3BcXERldlxcTm90aW9uQ2xpcHBlclxccGFja2FnZXNcXG5vdGlvbi1wYXJzZXJcXHRlc3RzXFx1bml0XFxmb3JtYXR0ZXJzXFxCbG9ja0Zvcm1hdHRlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUZXN0cyB1bml0YWlyZXMgcG91ciBCbG9ja0Zvcm1hdHRlciAtIENhaGllciBkZXMgQ2hhcmdlcyB2Mi4xXHJcbiAqIENvdXZyZSBsZSBmb3JtYXRhZ2UgZXQgbCdvcHRpbWlzYXRpb24gZGVzIGJsb2NzIE5vdGlvblxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEJsb2NrRm9ybWF0dGVyIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2Zvcm1hdHRlcnMvQmxvY2tGb3JtYXR0ZXInO1xyXG5pbXBvcnQgdHlwZSB7IE5vdGlvbkJsb2NrIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3R5cGVzJztcclxuXHJcbmRlc2NyaWJlKCdCbG9ja0Zvcm1hdHRlciAtIENhaGllciBkZXMgQ2hhcmdlcyB2Mi4xJywgKCkgPT4ge1xyXG4gIGxldCBmb3JtYXR0ZXI6IEJsb2NrRm9ybWF0dGVyO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGZvcm1hdHRlciA9IG5ldyBCbG9ja0Zvcm1hdHRlcigpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRW1wdHkgQmxvY2sgUmVtb3ZhbCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGVtcHR5IHBhcmFncmFwaCBibG9ja3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGJsb2NrczogTm90aW9uQmxvY2tbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAncGFyYWdyYXBoJyxcclxuICAgICAgICAgIHBhcmFncmFwaDoge1xyXG4gICAgICAgICAgICByaWNoX3RleHQ6IFtdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnksXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3BhcmFncmFwaCcsXHJcbiAgICAgICAgICBwYXJhZ3JhcGg6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnVmFsaWQgY29udGVudCcgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnVmFsaWQgY29udGVudCcsXHJcbiAgICAgICAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnlcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IHJlbW92ZUVtcHR5QmxvY2tzOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnR5cGUpLnRvQmUoJ3BhcmFncmFwaCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgZW1wdHkgaGVhZGluZyBibG9ja3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGJsb2NrczogTm90aW9uQmxvY2tbXSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnaGVhZGluZ18xJyxcclxuICAgICAgICAgIGhlYWRpbmdfMToge1xyXG4gICAgICAgICAgICByaWNoX3RleHQ6IFtdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnksXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2hlYWRpbmdfMicsXHJcbiAgICAgICAgICBoZWFkaW5nXzI6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnVmFsaWQgaGVhZGluZycgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnVmFsaWQgaGVhZGluZycsXHJcbiAgICAgICAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnlcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IHJlbW92ZUVtcHR5QmxvY2tzOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnR5cGUpLnRvQmUoJ2hlYWRpbmdfMicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBrZWVwIG5vbi10ZXh0IGJsb2NrcyBldmVuIGlmIGVtcHR5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBibG9ja3M6IE5vdGlvbkJsb2NrW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2RpdmlkZXInLFxyXG4gICAgICAgICAgZGl2aWRlcjoge31cclxuICAgICAgICB9IGFzIGFueSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnaW1hZ2UnLFxyXG4gICAgICAgICAgaW1hZ2U6IHtcclxuICAgICAgICAgICAgdHlwZTogJ2V4dGVybmFsJyxcclxuICAgICAgICAgICAgZXh0ZXJuYWw6IHsgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZS5qcGcnIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybWF0dGVyLmZvcm1hdChibG9ja3MsIHsgcmVtb3ZlRW1wdHlCbG9ja3M6IHRydWUgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1doaXRlc3BhY2UgTm9ybWFsaXphdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbm9ybWFsaXplIHdoaXRlc3BhY2UgaW4gcmljaCB0ZXh0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBibG9ja3M6IE5vdGlvbkJsb2NrW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3BhcmFncmFwaCcsXHJcbiAgICAgICAgICBwYXJhZ3JhcGg6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnICBNdWx0aXBsZSAgIHNwYWNlcyAgIGhlcmUgICcgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnICBNdWx0aXBsZSAgIHNwYWNlcyAgIGhlcmUgICcsXHJcbiAgICAgICAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnlcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IG5vcm1hbGl6ZVdoaXRlc3BhY2U6IHRydWUgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGNvbnN0IHJpY2hUZXh0ID0gKHJlc3VsdFswXSBhcyBhbnkpLnBhcmFncmFwaC5yaWNoX3RleHRbMF07XHJcbiAgICAgIGV4cGVjdChyaWNoVGV4dC50ZXh0LmNvbnRlbnQpLnRvQmUoJ011bHRpcGxlIHNwYWNlcyBoZXJlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHByZXNlcnZlIGNvZGUgYmxvY2sgd2hpdGVzcGFjZScsICgpID0+IHtcclxuICAgICAgY29uc3QgYmxvY2tzOiBOb3Rpb25CbG9ja1tdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdjb2RlJyxcclxuICAgICAgICAgIGNvZGU6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnICBmdW5jdGlvbiB0ZXN0KCkge1xcbiAgICByZXR1cm4gdHJ1ZTtcXG4gIH0nIH0sXHJcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICBib2xkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgaXRhbGljOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgc3RyaWtldGhyb3VnaDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIHVuZGVybGluZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvZGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBjb2xvcjogJ2RlZmF1bHQnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcGxhaW5fdGV4dDogJyAgZnVuY3Rpb24gdGVzdCgpIHtcXG4gICAgcmV0dXJuIHRydWU7XFxuICB9JyxcclxuICAgICAgICAgICAgICAgIGhyZWY6IG51bGxcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGxhbmd1YWdlOiAnamF2YXNjcmlwdCdcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybWF0dGVyLmZvcm1hdChibG9ja3MsIHsgbm9ybWFsaXplV2hpdGVzcGFjZTogdHJ1ZSB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgY29uc3QgcmljaFRleHQgPSAocmVzdWx0WzBdIGFzIGFueSkuY29kZS5yaWNoX3RleHRbMF07XHJcbiAgICAgIC8vIENvZGUgd2hpdGVzcGFjZSBzaG91bGQgYmUgcHJlc2VydmVkXHJcbiAgICAgIGV4cGVjdChyaWNoVGV4dC50ZXh0LmNvbnRlbnQpLnRvQ29udGFpbignICBmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDb2xvciBBcHBsaWNhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYXBwbHkgY29sb3IgdG8gYWxsIGJsb2NrcyB3aGVuIHJlcXVlc3RlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgYmxvY2tzOiBOb3Rpb25CbG9ja1tdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdwYXJhZ3JhcGgnLFxyXG4gICAgICAgICAgcGFyYWdyYXBoOiB7XHJcbiAgICAgICAgICAgIHJpY2hfdGV4dDogW1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHsgY29udGVudDogJ1Rlc3QgY29udGVudCcgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnVGVzdCBjb250ZW50JyxcclxuICAgICAgICAgICAgICAgIGhyZWY6IG51bGxcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnaGVhZGluZ18xJyxcclxuICAgICAgICAgIGhlYWRpbmdfMToge1xyXG4gICAgICAgICAgICByaWNoX3RleHQ6IFtcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB7IGNvbnRlbnQ6ICdIZWFkaW5nJyB9LFxyXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgYm9sZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGl0YWxpYzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIHN0cmlrZXRocm91Z2g6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICB1bmRlcmxpbmU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBjb2RlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29sb3I6ICdkZWZhdWx0J1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHBsYWluX3RleHQ6ICdIZWFkaW5nJyxcclxuICAgICAgICAgICAgICAgIGhyZWY6IG51bGxcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybWF0dGVyLmZvcm1hdChibG9ja3MsIHsgXHJcbiAgICAgICAgY29sb3I6ICdibHVlJyxcclxuICAgICAgICBhcHBseUNvbG9yVG9BbGw6IHRydWUgXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgICBleHBlY3QoKHJlc3VsdFswXSBhcyBhbnkpLnBhcmFncmFwaC5jb2xvcikudG9CZSgnYmx1ZScpO1xyXG4gICAgICBleHBlY3QoKHJlc3VsdFsxXSBhcyBhbnkpLmhlYWRpbmdfMS5jb2xvcikudG9CZSgnYmx1ZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdCbG9jayBMaW1pdHMgRW5mb3JjZW1lbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgTm90aW9uIGJsb2NrIGxpbWl0cycsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9uZ0NvbnRlbnQgPSAnYScucmVwZWF0KDMwMDApOyAvLyBFeGNlZWRzIDIwMDAgY2hhciBsaW1pdFxyXG4gICAgICBcclxuICAgICAgY29uc3QgYmxvY2tzOiBOb3Rpb25CbG9ja1tdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdwYXJhZ3JhcGgnLFxyXG4gICAgICAgICAgcGFyYWdyYXBoOiB7XHJcbiAgICAgICAgICAgIHJpY2hfdGV4dDogW1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgIHRleHQ6IHsgY29udGVudDogbG9uZ0NvbnRlbnQgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiBsb25nQ29udGVudCxcclxuICAgICAgICAgICAgICAgIGhyZWY6IG51bGxcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybWF0dGVyLmZvcm1hdChibG9ja3MsIHsgZW5mb3JjZUJsb2NrTGltaXRzOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBjb25zdCByaWNoVGV4dCA9IChyZXN1bHRbMF0gYXMgYW55KS5wYXJhZ3JhcGgucmljaF90ZXh0WzBdO1xyXG4gICAgICBleHBlY3QocmljaFRleHQudGV4dC5jb250ZW50Lmxlbmd0aCkudG9CZUxlc3NUaGFuT3JFcXVhbCgyMDAwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbGltaXQgdGFibGUgd2lkdGggdG8gNSBjb2x1bW5zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB3aWRlVGFibGU6IE5vdGlvbkJsb2NrID0ge1xyXG4gICAgICAgIHR5cGU6ICd0YWJsZScsXHJcbiAgICAgICAgdGFibGU6IHtcclxuICAgICAgICAgIHRhYmxlX3dpZHRoOiA4LFxyXG4gICAgICAgICAgY2hpbGRyZW46IFtdXHJcbiAgICAgICAgfVxyXG4gICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoW3dpZGVUYWJsZV0sIHsgZW5mb3JjZUJsb2NrTGltaXRzOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QoKHJlc3VsdFswXSBhcyBhbnkpLnRhYmxlLnRhYmxlX3dpZHRoKS50b0JlTGVzc1RoYW5PckVxdWFsKDUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdTdHJ1Y3R1cmUgT3B0aW1pemF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBvcHRpbWl6ZSBuZXN0ZWQgYmxvY2sgc3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBibG9ja3M6IE5vdGlvbkJsb2NrW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3BhcmFncmFwaCcsXHJcbiAgICAgICAgICBwYXJhZ3JhcGg6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnQ29udGVudCcgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnQ29udGVudCcsXHJcbiAgICAgICAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnlcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IG9wdGltaXplU3RydWN0dXJlOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnR5cGUpLnRvQmUoJ3BhcmFncmFwaCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGVlcGx5IG5lc3RlZCBibG9ja3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlZXBseU5lc3RlZDogTm90aW9uQmxvY2sgPSB7XHJcbiAgICAgICAgdHlwZTogJ3RvZ2dsZScsXHJcbiAgICAgICAgdG9nZ2xlOiB7XHJcbiAgICAgICAgICByaWNoX3RleHQ6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICB0ZXh0OiB7IGNvbnRlbnQ6ICdUb2dnbGUnIH0sXHJcbiAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgaXRhbGljOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHN0cmlrZXRocm91Z2g6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNvZGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6ICdkZWZhdWx0J1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgcGxhaW5fdGV4dDogJ1RvZ2dsZScsXHJcbiAgICAgICAgICAgICAgaHJlZjogbnVsbFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiAncGFyYWdyYXBoJyxcclxuICAgICAgICAgICAgcGFyYWdyYXBoOiB7XHJcbiAgICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnTmVzdGVkIGNvbnRlbnQnIH0sXHJcbiAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaXRhbGljOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICB1bmRlcmxpbmU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgcGxhaW5fdGV4dDogJ05lc3RlZCBjb250ZW50JyxcclxuICAgICAgICAgICAgICAgICAgaHJlZjogbnVsbFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBhcyBhbnlcclxuICAgICAgICBdXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybWF0dGVyLmZvcm1hdChbZGVlcGx5TmVzdGVkXSwgeyBcclxuICAgICAgICBvcHRpbWl6ZVN0cnVjdHVyZTogdHJ1ZSxcclxuICAgICAgICBtYXhCbG9ja0RlcHRoOiAzIFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS50eXBlKS50b0JlKCd0b2dnbGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUmljaCBUZXh0IFRyaW1taW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB0cmltIHJpY2ggdGV4dCBjb250ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBibG9ja3M6IE5vdGlvbkJsb2NrW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3BhcmFncmFwaCcsXHJcbiAgICAgICAgICBwYXJhZ3JhcGg6IHtcclxuICAgICAgICAgICAgcmljaF90ZXh0OiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogeyBjb250ZW50OiAnICBUcmltbWVkIGNvbnRlbnQgICcgfSxcclxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgIGJvbGQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgdW5kZXJsaW5lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZGVmYXVsdCdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwbGFpbl90ZXh0OiAnICBUcmltbWVkIGNvbnRlbnQgICcsXHJcbiAgICAgICAgICAgICAgICBocmVmOiBudWxsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBhcyBhbnlcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IHRyaW1SaWNoVGV4dDogdHJ1ZSB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgY29uc3QgcmljaFRleHQgPSAocmVzdWx0WzBdIGFzIGFueSkucGFyYWdyYXBoLnJpY2hfdGV4dFswXTtcclxuICAgICAgZXhwZWN0KHJpY2hUZXh0LnRleHQuY29udGVudCkudG9CZSgnVHJpbW1lZCBjb250ZW50Jyk7XHJcbiAgICAgIGV4cGVjdChyaWNoVGV4dC5wbGFpbl90ZXh0KS50b0JlKCdUcmltbWVkIGNvbnRlbnQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgYW5kIEVkZ2UgQ2FzZXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsYXJnZSBudW1iZXIgb2YgYmxvY2tzIGVmZmljaWVudGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYW55QmxvY2tzID0gQXJyYXkoMTAwMCkuZmlsbCgwKS5tYXAoKF8sIGkpID0+ICh7XHJcbiAgICAgICAgdHlwZTogJ3BhcmFncmFwaCcsXHJcbiAgICAgICAgcGFyYWdyYXBoOiB7XHJcbiAgICAgICAgICByaWNoX3RleHQ6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICB0ZXh0OiB7IGNvbnRlbnQ6IGBQYXJhZ3JhcGggJHtpfWAgfSxcclxuICAgICAgICAgICAgICBhbm5vdGF0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgYm9sZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBpdGFsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc3RyaWtldGhyb3VnaDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB1bmRlcmxpbmU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY29kZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJ2RlZmF1bHQnXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBwbGFpbl90ZXh0OiBgUGFyYWdyYXBoICR7aX1gLFxyXG4gICAgICAgICAgICAgIGhyZWY6IG51bGxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH1cclxuICAgICAgfSkpIGFzIE5vdGlvbkJsb2NrW107XHJcblxyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBmb3JtYXR0ZXIuZm9ybWF0KG1hbnlCbG9ja3MsIHsgXHJcbiAgICAgICAgcmVtb3ZlRW1wdHlCbG9ja3M6IHRydWUsXHJcbiAgICAgICAgbm9ybWFsaXplV2hpdGVzcGFjZTogdHJ1ZSBcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxMDAwKTtcclxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwKTsgLy8gU2hvdWxkIGJlIGZhc3RcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGlucHV0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBmb3JtYXR0ZXIuZm9ybWF0KFtdLCB7IHJlbW92ZUVtcHR5QmxvY2tzOiB0cnVlIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwvdW5kZWZpbmVkIGJsb2NrcyBncmFjZWZ1bGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBibG9ja3MgPSBbbnVsbCwgdW5kZWZpbmVkXSBhcyBhbnk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm1hdHRlci5mb3JtYXQoYmxvY2tzLCB7IHJlbW92ZUVtcHR5QmxvY2tzOiB0cnVlIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=