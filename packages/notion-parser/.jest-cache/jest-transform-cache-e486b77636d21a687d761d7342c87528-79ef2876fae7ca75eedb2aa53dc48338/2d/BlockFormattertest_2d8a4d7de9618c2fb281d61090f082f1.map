{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\unit\\formatters\\BlockFormatter.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\unit\\formatters\\BlockFormatter.test.ts"],"sourcesContent":["/**\r\n * Tests unitaires pour BlockFormatter - Cahier des Charges v2.1\r\n * Couvre le formatage et l'optimisation des blocs Notion\r\n */\r\n\r\nimport { BlockFormatter } from '../../../src/formatters/BlockFormatter';\r\nimport type { NotionBlock } from '../../../src/types';\r\n\r\ndescribe('BlockFormatter - Cahier des Charges v2.1', () => {\r\n  let formatter: BlockFormatter;\r\n\r\n  beforeEach(() => {\r\n    formatter = new BlockFormatter();\r\n  });\r\n\r\n  describe('Empty Block Removal', () => {\r\n    it('should remove empty paragraph blocks', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: []\r\n          }\r\n        } as any,\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: 'Valid content' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: 'Valid content',\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { removeEmptyBlocks: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      expect(result[0].type).toBe('paragraph');\r\n    });\r\n\r\n    it('should remove empty heading blocks', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'heading_1',\r\n          heading_1: {\r\n            rich_text: []\r\n          }\r\n        } as any,\r\n        {\r\n          type: 'heading_2',\r\n          heading_2: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: 'Valid heading' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: 'Valid heading',\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { removeEmptyBlocks: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      expect(result[0].type).toBe('heading_2');\r\n    });\r\n\r\n    it('should keep non-text blocks even if empty', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'divider',\r\n          divider: {}\r\n        } as any,\r\n        {\r\n          type: 'image',\r\n          image: {\r\n            type: 'external',\r\n            external: { url: 'https://example.com/image.jpg' }\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { removeEmptyBlocks: true });\r\n\r\n      expect(result).toHaveLength(2);\r\n    });\r\n  });\r\n\r\n  describe('Whitespace Normalization', () => {\r\n    it('should normalize whitespace in rich text', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: '  Multiple   spaces   here  ' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: '  Multiple   spaces   here  ',\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { normalizeWhitespace: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      const richText = (result[0] as any).paragraph.rich_text[0];\r\n      expect(richText.text.content).toBe('Multiple spaces here');\r\n    });\r\n\r\n    it('should preserve code block whitespace', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'code',\r\n          code: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: '  function test() {\\n    return true;\\n  }' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: '  function test() {\\n    return true;\\n  }',\r\n                href: null\r\n              }\r\n            ],\r\n            language: 'javascript'\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { normalizeWhitespace: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      const richText = (result[0] as any).code.rich_text[0];\r\n      // Code whitespace should be preserved\r\n      expect(richText.text.content).toContain('  function');\r\n    });\r\n  });\r\n\r\n  describe('Color Application', () => {\r\n    it('should apply color to all blocks when requested', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: 'Test content' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: 'Test content',\r\n                href: null\r\n              }\r\n            ],\r\n            color: 'default'\r\n          }\r\n        } as any,\r\n        {\r\n          type: 'heading_1',\r\n          heading_1: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: 'Heading' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: 'Heading',\r\n                href: null\r\n              }\r\n            ],\r\n            color: 'default'\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { \r\n        color: 'blue',\r\n        applyColorToAll: true \r\n      });\r\n\r\n      expect(result).toHaveLength(2);\r\n      expect((result[0] as any).paragraph.color).toBe('blue');\r\n      expect((result[1] as any).heading_1.color).toBe('blue');\r\n    });\r\n  });\r\n\r\n  describe('Block Limits Enforcement', () => {\r\n    it('should enforce Notion block limits', () => {\r\n      const longContent = 'a'.repeat(3000); // Exceeds 2000 char limit\r\n      \r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: longContent },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: longContent,\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { enforceBlockLimits: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      const richText = (result[0] as any).paragraph.rich_text[0];\r\n      expect(richText.text.content.length).toBeLessThanOrEqual(2000);\r\n    });\r\n\r\n    it('should limit table width to 5 columns', () => {\r\n      const wideTable: NotionBlock = {\r\n        type: 'table',\r\n        table: {\r\n          table_width: 8,\r\n          children: []\r\n        }\r\n      } as any;\r\n\r\n      const result = formatter.format([wideTable], { enforceBlockLimits: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      expect((result[0] as any).table.table_width).toBeLessThanOrEqual(5);\r\n    });\r\n  });\r\n\r\n  describe('Structure Optimization', () => {\r\n    it('should optimize nested block structure', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: 'Content' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: 'Content',\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { optimizeStructure: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      expect(result[0].type).toBe('paragraph');\r\n    });\r\n\r\n    it('should handle deeply nested blocks', () => {\r\n      const deeplyNested: NotionBlock = {\r\n        type: 'toggle',\r\n        toggle: {\r\n          rich_text: [\r\n            {\r\n              type: 'text',\r\n              text: { content: 'Toggle' },\r\n              annotations: {\r\n                bold: false,\r\n                italic: false,\r\n                strikethrough: false,\r\n                underline: false,\r\n                code: false,\r\n                color: 'default'\r\n              },\r\n              plain_text: 'Toggle',\r\n              href: null\r\n            }\r\n          ]\r\n        },\r\n        children: [\r\n          {\r\n            type: 'paragraph',\r\n            paragraph: {\r\n              rich_text: [\r\n                {\r\n                  type: 'text',\r\n                  text: { content: 'Nested content' },\r\n                  annotations: {\r\n                    bold: false,\r\n                    italic: false,\r\n                    strikethrough: false,\r\n                    underline: false,\r\n                    code: false,\r\n                    color: 'default'\r\n                  },\r\n                  plain_text: 'Nested content',\r\n                  href: null\r\n                }\r\n              ]\r\n            }\r\n          } as any\r\n        ]\r\n      } as any;\r\n\r\n      const result = formatter.format([deeplyNested], { \r\n        optimizeStructure: true,\r\n        maxBlockDepth: 3 \r\n      });\r\n\r\n      expect(result).toHaveLength(1);\r\n      expect(result[0].type).toBe('toggle');\r\n    });\r\n  });\r\n\r\n  describe('Rich Text Trimming', () => {\r\n    it('should trim rich text content', () => {\r\n      const blocks: NotionBlock[] = [\r\n        {\r\n          type: 'paragraph',\r\n          paragraph: {\r\n            rich_text: [\r\n              {\r\n                type: 'text',\r\n                text: { content: '  Trimmed content  ' },\r\n                annotations: {\r\n                  bold: false,\r\n                  italic: false,\r\n                  strikethrough: false,\r\n                  underline: false,\r\n                  code: false,\r\n                  color: 'default'\r\n                },\r\n                plain_text: '  Trimmed content  ',\r\n                href: null\r\n              }\r\n            ]\r\n          }\r\n        } as any\r\n      ];\r\n\r\n      const result = formatter.format(blocks, { trimRichText: true });\r\n\r\n      expect(result).toHaveLength(1);\r\n      const richText = (result[0] as any).paragraph.rich_text[0];\r\n      expect(richText.text.content).toBe('Trimmed content');\r\n      expect(richText.plain_text).toBe('Trimmed content');\r\n    });\r\n  });\r\n\r\n  describe('Performance and Edge Cases', () => {\r\n    it('should handle large number of blocks efficiently', () => {\r\n      const manyBlocks = Array(1000).fill(0).map((_, i) => ({\r\n        type: 'paragraph',\r\n        paragraph: {\r\n          rich_text: [\r\n            {\r\n              type: 'text',\r\n              text: { content: `Paragraph ${i}` },\r\n              annotations: {\r\n                bold: false,\r\n                italic: false,\r\n                strikethrough: false,\r\n                underline: false,\r\n                code: false,\r\n                color: 'default'\r\n              },\r\n              plain_text: `Paragraph ${i}`,\r\n              href: null\r\n            }\r\n          ]\r\n        }\r\n      })) as NotionBlock[];\r\n\r\n      const startTime = Date.now();\r\n      const result = formatter.format(manyBlocks, { \r\n        removeEmptyBlocks: true,\r\n        normalizeWhitespace: true \r\n      });\r\n      const duration = Date.now() - startTime;\r\n\r\n      expect(result).toHaveLength(1000);\r\n      expect(duration).toBeLessThan(100); // Should be fast\r\n    });\r\n\r\n    it('should handle empty input', () => {\r\n      const result = formatter.format([], { removeEmptyBlocks: true });\r\n      expect(result).toEqual([]);\r\n    });\r\n\r\n    it('should handle null/undefined blocks gracefully', () => {\r\n      const blocks = [null, undefined] as any;\r\n      const result = formatter.format(blocks, { removeEmptyBlocks: true });\r\n      expect(result).toEqual([]);\r\n    });\r\n  });\r\n});"],"version":3}