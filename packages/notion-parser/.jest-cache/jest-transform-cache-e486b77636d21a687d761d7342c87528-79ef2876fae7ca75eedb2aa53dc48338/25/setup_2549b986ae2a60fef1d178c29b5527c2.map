{"file":"C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\setup.ts","mappings":";AAAA;;;GAGG;;AAEH,yDAAqE;AAErE,kDAAkD;AAClD,MAAM,sBAAsB,GAAG;IAC7B,oBAAoB,EAAE,CAAC,EAAO,aAAa;IAC3C,mBAAmB,EAAE,EAAE,EAAO,cAAc;IAC5C,eAAe,EAAE,EAAE,EAAW,cAAc;IAC5C,oBAAoB,EAAE,EAAE,EAAM,cAAc;IAC5C,eAAe,EAAE,CAAC,EAAY,aAAa;IAC3C,kBAAkB,EAAE,EAAE,EAAQ,cAAc;IAC5C,mBAAmB,EAAE,EAAE,EAAO,cAAc;IAC5C,mBAAmB,EAAE,EAAE,EAAO,cAAc;IAC5C,eAAe,EAAE,IAAI,EAAS,YAAY;IAE1C,gCAAgC;IAChC,YAAY,EAAE,KAAK;CACpB,CAAC;AAEF,6BAA6B;AAC7B,IAAI,CAAC,UAAU,CAAC,sBAAsB,CAAC,YAAY,CAAC,CAAC;AAErD,8BAA8B;AAC9B,MAAM,eAAe,GAAG,OAAO,CAAC;AAEhC,SAAS,CAAC,GAAG,EAAE;IACb,yDAAyD;IACzD,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;QACvB,MAAM,CAAC,OAAO,GAAG;YACf,GAAG,OAAO;YACV,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;YACd,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE;YAChB,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;YACf,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;YACf,KAAK,EAAE,eAAe,CAAC,KAAK,CAAC,qBAAqB;SACnD,CAAC;IACJ,CAAC;IAED,kCAAkC;IACjC,MAAc,CAAC,WAAW,GAAG,0BAAW,CAAC;IACzC,MAAc,CAAC,sBAAsB,GAAG,sBAAsB,CAAC;AAClE,CAAC,CAAC,CAAC;AAEH,QAAQ,CAAC,GAAG,EAAE;IACZ,MAAM,CAAC,OAAO,GAAG,eAAe,CAAC;AACnC,CAAC,CAAC,CAAC;AAiBH,iCAAiC;AACjC,MAAM,CAAC,MAAM,CAAC;IACZ,GAAG,6BAAc;IAEjB,yCAAyC;IACzC,8BAA8B,CAAC,QAAgB,EAAE,SAAiB;QAChE,MAAM,IAAI,GAAG,QAAQ,IAAI,SAAS,CAAC;QAEnC,IAAI,IAAI,EAAE,CAAC;YACT,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,YAAY,QAAQ,sCAAsC,SAAS,IAAI;gBACtF,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,YAAY,QAAQ,yCAAyC,SAAS,IAAI;gBACzF,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,qDAAqD;IACrD,+BAA+B,CAAC,QAAa;QAC3C,MAAM,OAAO,GAAG,QAAQ;YACT,OAAO,QAAQ,KAAK,QAAQ;YAC5B,OAAO,QAAQ,CAAC,IAAI,KAAK,QAAQ;YACjC,QAAQ,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAExC,IAAI,OAAO,EAAE,CAAC;YACZ,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,iDAAiD;gBAChE,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,kEAAkE;gBACjF,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,gDAAgD;IAChD,gBAAgB,CAAC,QAAe;QAC9B,MAAM,aAAa,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAC1C,KAAK,CAAC,IAAI,KAAK,OAAO;YACtB,KAAK,CAAC,KAAK;YACX,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,UAAU;YAC/B,KAAK,CAAC,KAAK,CAAC,QAAQ;YACpB,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CACzB,CAAC;QAEF,IAAI,aAAa,EAAE,CAAC;YAClB,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,4CAA4C;gBAC3D,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,2DAA2D;gBAC1E,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,wDAAwD;IACxD,sBAAsB,CAAC,QAAe;QACpC,MAAM,mBAAmB,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAChD,KAAK,CAAC,IAAI,KAAK,OAAO;YACtB,KAAK,CAAC,KAAK;YACX,CAAC,KAAK,CAAC,KAAK,CAAC,iBAAiB,KAAK,IAAI,IAAI,KAAK,CAAC,KAAK,CAAC,cAAc,KAAK,IAAI,CAAC,CAChF,CAAC;QAEF,IAAI,mBAAmB,EAAE,CAAC;YACxB,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,mDAAmD;gBAClE,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,4DAA4D;gBAC3E,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,oDAAoD;IACpD,mBAAmB,CAAC,QAAe;QACjC,MAAM,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAC7C,KAAK,CAAC,IAAI;YACV,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC;YACjC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC;YACjB,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,aAAa,KAAK,IAAI,CACzC,CAAC;QAEF,IAAI,gBAAgB,EAAE,CAAC;YACrB,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,+CAA+C;gBAC9D,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,wDAAwD;gBACvE,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,sCAAsC;IACtC,iBAAiB,CAAC,QAAgB;QAChC,MAAM,eAAe,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACnF,MAAM,UAAU,GAAG,kCAAkC,CAAC;QAEtD,MAAM,UAAU,GAAG,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC7C,MAAM,iBAAiB,GAAG,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CACnD,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC,CAC3C,CAAC;QAEF,MAAM,OAAO,GAAG,UAAU,IAAI,iBAAiB,CAAC;QAEhD,IAAI,OAAO,EAAE,CAAC;YACZ,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,YAAY,QAAQ,8BAA8B;gBACjE,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,YAAY,QAAQ,mDAAmD;gBACtF,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAED,oCAAoC;IACpC,mBAAmB,CAAC,QAAa;QAC/B,MAAM,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC;YACxB,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CACvB,OAAO;gBACP,OAAO,OAAO,KAAK,QAAQ;gBAC3B,OAAO,CAAC,IAAI;gBACZ,OAAO,CAAC,IAAI;gBACZ,OAAO,CAAC,WAAW;gBACnB,OAAO,OAAO,CAAC,UAAU,KAAK,QAAQ,CACvC,CAAC;QAEzB,IAAI,eAAe,EAAE,CAAC;YACpB,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,kCAAkC;gBACjD,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO;gBACL,OAAO,EAAE,GAAG,EAAE,CAAC,sDAAsD;gBACrE,IAAI,EAAE,KAAK;aACZ,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAC,CAAC;AAEH,uCAAuC;AACvC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;IAClB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;AAC3B,CAAC;AAED,8CAA8C;AAC9C,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;IACxB,MAAM,CAAC,WAAW,GAAG;QACnB,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;KACxB,CAAC;AACX,CAAC;AAED,8CAA8C;AAC9C,MAAM,kBAAkB,GAAG,MAAM,CAAC,UAAU,CAAC;AAC7C,MAAM,mBAAmB,GAAG,MAAM,CAAC,WAAW,CAAC;AAE/C,UAAU,CAAC,GAAG,EAAE;IACd,oCAAoC;IACpC,IAAI,CAAC,aAAa,EAAE,CAAC;IAErB,qEAAqE;IACrE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;IACzD,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;AAC9D,CAAC,CAAC,CAAC;AAEH,SAAS,CAAC,GAAG,EAAE;IACb,8BAA8B;IAC9B,IAAI,CAAC,eAAe,EAAE,CAAC;AACzB,CAAC,CAAC,CAAC;AAEH,oCAAoC;AACpC,OAAO,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,EAAE;IACnD,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;AACvE,CAAC,CAAC,CAAC;AAEH,6DAA6D;AAC7D,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,MAAM,CAAC;AAE9B,0CAA0C;AAC1C,MAAM,CAAC,SAAS,GAAG;IACjB,gCAAgC;IAChC,mBAAmB,EAAE,CAAC,IAAY,EAAE,OAAqC,OAAO,EAAE,EAAE;QAClF,MAAM,KAAK,GAAG;YACZ,KAAK,EAAE,EAAE;YACT,MAAM,EAAE,GAAG;YACX,KAAK,EAAE,IAAI;SACZ,CAAC;QAEF,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;QAE1B,QAAQ,IAAI,EAAE,CAAC;YACb,KAAK,UAAU;gBACb,OAAO,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACvC,YAAY,CAAC,iBAAiB,CAAC,sBAAsB,CACtD,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAEjB,KAAK,OAAO;gBACV,OAAO,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACvC,4BAA4B,CAAC,MAAM,CACpC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEf,KAAK,OAAO;gBACV,MAAM,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAC7C,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAC7B,CAAC;gBACF,OAAO,4BAA4B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAEvD,KAAK,QAAQ;gBACX,OAAO,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACvC,cAAc,CAAC,0BAA0B,CAAC,EAAE,CAC7C,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAEjB;gBACE,OAAO,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACvC,QAAQ,CAAC,kBAAkB,CAC5B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjB,CAAC;IACH,CAAC;IAED,wBAAwB;IACxB,kBAAkB,EAAE,CAAI,EAAW,EAAgD,EAAE;QACnF,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QAC1C,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAE7B,MAAM,MAAM,GAAG,EAAE,EAAE,CAAC;QAEpB,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC3B,MAAM,SAAS,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QAExC,OAAO;YACL,MAAM;YACN,QAAQ,EAAE,OAAO,GAAG,SAAS;YAC7B,MAAM,EAAE;gBACN,KAAK,EAAE,WAAW;gBAClB,GAAG,EAAE,SAAS;gBACd,KAAK,EAAE,SAAS,CAAC,QAAQ,GAAG,WAAW,CAAC,QAAQ;aACjD;SACF,CAAC;IACJ,CAAC;CACF,CAAC","names":[],"sources":["C:\\Users\\rayan\\Desktop\\Dev\\NotionClipper\\packages\\notion-parser\\tests\\setup.ts"],"sourcesContent":["/**\r\n * Configuration Jest pour les tests - Cahier des Charges v2.1 ⭐\r\n * Inclut des matchers personnalisés et configuration avancée\r\n */\r\n\r\nimport { customMatchers, testHelpers } from './helpers/test-helpers';\r\n\r\n// Constantes conformes au Cahier des Charges v2.1\r\nconst PERFORMANCE_BENCHMARKS = {\r\n  DETECTION_1000_LINES: 5,      // <5ms (P50)\r\n  PARSE_MARKDOWN_1000: 30,      // <30ms (P50)\r\n  PARSE_CODE_1000: 20,          // <20ms (P50)\r\n  PARSE_TABLE_100_ROWS: 15,     // <15ms (P50)\r\n  PARSE_AUDIO_URL: 1,           // <1ms (P50)\r\n  CONVERT_100_BLOCKS: 20,       // <20ms (P50)\r\n  VALIDATE_100_BLOCKS: 10,      // <10ms (P50)\r\n  PIPELINE_TOTAL_1000: 80,      // <80ms (P50)\r\n  FILE_UPLOAD_5MB: 2000,        // <2s (P50)\r\n  \r\n  // Timeout global pour les tests\r\n  TEST_TIMEOUT: 30000\r\n};\r\n\r\n// Configuration des timeouts\r\njest.setTimeout(PERFORMANCE_BENCHMARKS.TEST_TIMEOUT);\r\n\r\n// Mock console pour les tests\r\nconst originalConsole = console;\r\n\r\nbeforeAll(() => {\r\n  // Silencer les logs pendant les tests sauf si DEBUG=true\r\n  if (!process.env.DEBUG) {\r\n    global.console = {\r\n      ...console,\r\n      log: jest.fn(),\r\n      debug: jest.fn(),\r\n      info: jest.fn(),\r\n      warn: jest.fn(),\r\n      error: originalConsole.error // Garder les erreurs\r\n    };\r\n  }\r\n\r\n  // Initialiser les helpers globaux\r\n  (global as any).testHelpers = testHelpers;\r\n  (global as any).PERFORMANCE_BENCHMARKS = PERFORMANCE_BENCHMARKS;\r\n});\r\n\r\nafterAll(() => {\r\n  global.console = originalConsole;\r\n});\r\n\r\n// ⭐ Matchers personnalisés pour le Cahier des Charges v2.1\r\ndeclare global {\r\n  namespace jest {\r\n    interface Matchers<R> {\r\n      toBeWithinPerformanceThreshold(threshold: number): R;\r\n      toHaveValidNotionBlockStructure(): R;\r\n      toHaveAudioBlock(): R;\r\n      toHaveTableWithHeaders(): R;\r\n      toHaveToggleHeading(): R;\r\n      toBeValidAudioUrl(): R;\r\n      toHaveValidRichText(): R;\r\n    }\r\n  }\r\n}\r\n\r\n// Matchers personnalisés étendus\r\nexpect.extend({\r\n  ...customMatchers,\r\n  \r\n  // Matcher pour les seuils de performance\r\n  toBeWithinPerformanceThreshold(received: number, threshold: number) {\r\n    const pass = received <= threshold;\r\n    \r\n    if (pass) {\r\n      return {\r\n        message: () => `Expected ${received}ms to exceed performance threshold ${threshold}ms`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected ${received}ms to be within performance threshold ${threshold}ms`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour valider la structure des blocs Notion\r\n  toHaveValidNotionBlockStructure(received: any) {\r\n    const isValid = received && \r\n                   typeof received === 'object' &&\r\n                   typeof received.type === 'string' &&\r\n                   received.type.length > 0;\r\n    \r\n    if (isValid) {\r\n      return {\r\n        message: () => `Expected block to have invalid Notion structure`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected block to have valid Notion structure with type property`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour les blocs audio (⭐ NOUVEAU v2.1)\r\n  toHaveAudioBlock(received: any[]) {\r\n    const hasAudioBlock = received.some(block => \r\n      block.type === 'audio' && \r\n      block.audio &&\r\n      block.audio.type === 'external' &&\r\n      block.audio.external &&\r\n      block.audio.external.url\r\n    );\r\n    \r\n    if (hasAudioBlock) {\r\n      return {\r\n        message: () => `Expected blocks to not contain audio block`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected blocks to contain at least one valid audio block`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour les tables avec headers (⭐ NOUVEAU v2.1)\r\n  toHaveTableWithHeaders(received: any[]) {\r\n    const hasTableWithHeaders = received.some(block => \r\n      block.type === 'table' && \r\n      block.table &&\r\n      (block.table.has_column_header === true || block.table.has_row_header === true)\r\n    );\r\n    \r\n    if (hasTableWithHeaders) {\r\n      return {\r\n        message: () => `Expected blocks to not contain table with headers`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected blocks to contain at least one table with headers`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour les toggle headings (⭐ NOUVEAU v2.1)\r\n  toHaveToggleHeading(received: any[]) {\r\n    const hasToggleHeading = received.some(block => \r\n      block.type && \r\n      block.type.startsWith('heading_') &&\r\n      block[block.type] &&\r\n      block[block.type].is_toggleable === true\r\n    );\r\n    \r\n    if (hasToggleHeading) {\r\n      return {\r\n        message: () => `Expected blocks to not contain toggle heading`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected blocks to contain at least one toggle heading`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour valider les URLs audio\r\n  toBeValidAudioUrl(received: string) {\r\n    const audioExtensions = ['mp3', 'wav', 'ogg', 'oga', 'm4a', 'aac', 'flac', 'webm'];\r\n    const urlPattern = /^https?:\\/\\/[^\\s<>\"{}|\\\\^`[\\]]+$/;\r\n    \r\n    const isValidUrl = urlPattern.test(received);\r\n    const hasAudioExtension = audioExtensions.some(ext => \r\n      received.toLowerCase().endsWith(`.${ext}`)\r\n    );\r\n    \r\n    const isValid = isValidUrl && hasAudioExtension;\r\n    \r\n    if (isValid) {\r\n      return {\r\n        message: () => `Expected ${received} to not be a valid audio URL`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected ${received} to be a valid audio URL with supported extension`,\r\n        pass: false,\r\n      };\r\n    }\r\n  },\r\n  \r\n  // Matcher pour valider le rich text\r\n  toHaveValidRichText(received: any) {\r\n    const isValidRichText = Array.isArray(received) &&\r\n                           received.every(segment => \r\n                             segment &&\r\n                             typeof segment === 'object' &&\r\n                             segment.type &&\r\n                             segment.text &&\r\n                             segment.annotations &&\r\n                             typeof segment.plain_text === 'string'\r\n                           );\r\n    \r\n    if (isValidRichText) {\r\n      return {\r\n        message: () => `Expected rich text to be invalid`,\r\n        pass: true,\r\n      };\r\n    } else {\r\n      return {\r\n        message: () => `Expected valid rich text array with proper structure`,\r\n        pass: false,\r\n      };\r\n    }\r\n  }\r\n});\r\n\r\n// Mock global pour fetch si nécessaire\r\nif (!global.fetch) {\r\n  global.fetch = jest.fn();\r\n}\r\n\r\n// Mock pour performance.now si pas disponible\r\nif (!global.performance) {\r\n  global.performance = {\r\n    now: jest.fn(() => Date.now())\r\n  } as any;\r\n}\r\n\r\n// Configuration pour les tests de performance\r\nconst originalSetTimeout = global.setTimeout;\r\nconst originalSetInterval = global.setInterval;\r\n\r\nbeforeEach(() => {\r\n  // Reset des mocks avant chaque test\r\n  jest.clearAllMocks();\r\n  \r\n  // Mock console.time et console.timeEnd pour les tests de performance\r\n  jest.spyOn(console, 'time').mockImplementation(() => {});\r\n  jest.spyOn(console, 'timeEnd').mockImplementation(() => {});\r\n});\r\n\r\nafterEach(() => {\r\n  // Nettoyage après chaque test\r\n  jest.restoreAllMocks();\r\n});\r\n\r\n// Gestion des erreurs non capturées\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\r\n});\r\n\r\n// Configuration des variables d'environnement pour les tests\r\nprocess.env.NODE_ENV = 'test';\r\n\r\n// ⭐ Utilitaires de test globaux pour v2.1\r\nglobal.testUtils = {\r\n  // Générateur de contenu de test\r\n  generateTestContent: (type: string, size: 'small' | 'medium' | 'large' = 'small') => {\r\n    const sizes = {\r\n      small: 10,\r\n      medium: 100,\r\n      large: 1000\r\n    };\r\n    \r\n    const count = sizes[size];\r\n    \r\n    switch (type) {\r\n      case 'markdown':\r\n        return Array(count).fill(0).map((_, i) => \r\n          `# Header ${i}\\n\\nParagraph ${i} with **bold** text.`\r\n        ).join('\\n\\n');\r\n      \r\n      case 'audio':\r\n        return Array(count).fill(0).map((_, i) => \r\n          `https://example.com/audio${i}.mp3`\r\n        ).join('\\n');\r\n      \r\n      case 'table':\r\n        const rows = Array(count).fill(0).map((_, i) => \r\n          `Row${i},Value${i},Data${i}`\r\n        );\r\n        return `Header1,Header2,Header3\\n${rows.join('\\n')}`;\r\n      \r\n      case 'toggle':\r\n        return Array(count).fill(0).map((_, i) => \r\n          `> # Toggle ${i}\\n> Content for toggle ${i}`\r\n        ).join('\\n\\n');\r\n      \r\n      default:\r\n        return Array(count).fill(0).map((_, i) => \r\n          `Line ${i} of test content`\r\n        ).join('\\n');\r\n    }\r\n  },\r\n  \r\n  // Mesure de performance\r\n  measurePerformance: <T>(fn: () => T): { result: T; duration: number; memory: any } => {\r\n    const startMemory = process.memoryUsage();\r\n    const startTime = Date.now();\r\n    \r\n    const result = fn();\r\n    \r\n    const endTime = Date.now();\r\n    const endMemory = process.memoryUsage();\r\n    \r\n    return {\r\n      result,\r\n      duration: endTime - startTime,\r\n      memory: {\r\n        start: startMemory,\r\n        end: endMemory,\r\n        delta: endMemory.heapUsed - startMemory.heapUsed\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\n// Types globaux pour TypeScript\r\ndeclare global {\r\n  var testUtils: {\r\n    generateTestContent: (type: string, size?: 'small' | 'medium' | 'large') => string;\r\n    measurePerformance: <T>(fn: () => T) => { result: T; duration: number; memory: any };\r\n  };\r\n  var PERFORMANCE_BENCHMARKS: any;\r\n}"],"version":3}