27842fa67bd82ff61248ebffb5f8ab1b
"use strict";
/**
 * Tests unitaires pour FileUploadHandler - Upload natif Notion v2.1 ⭐
 * Couvre l'upload de fichiers via l'API Notion native /v1/file_uploads
 */
Object.defineProperty(exports, "__esModule", { value: true });
const FileUploadHandler_1 = require("../../../src/utils/FileUploadHandler");
// Mock fetch pour les tests
const mockFetch = jest.fn();
global.fetch = mockFetch;
describe('FileUploadHandler - Upload natif Notion v2.1 ⭐', () => {
    let handler;
    const mockOptions = {
        notionToken: 'secret_test_token_123',
        maxFileSize: 20 * 1024 * 1024
    };
    beforeEach(() => {
        handler = new FileUploadHandler_1.FileUploadHandler(mockOptions);
        mockFetch.mockClear();
    });
    describe('Constructor and Configuration', () => {
        it('should initialize with Notion token', () => {
            expect(handler).toBeDefined();
            expect(() => new FileUploadHandler_1.FileUploadHandler({ notionToken: '' })).toThrow();
        });
        it('should use default options', () => {
            const defaultHandler = new FileUploadHandler_1.FileUploadHandler(mockOptions);
            expect(defaultHandler).toBeDefined();
        });
        it('should accept custom options', () => {
            const customHandler = new FileUploadHandler_1.FileUploadHandler({
                ...mockOptions,
                maxFileSize: 50 * 1024 * 1024
            });
            expect(customHandler).toBeDefined();
        });
    });
    describe('File Validation', () => {
        it('should validate file size limits', async () => {
            // Create a mock file that exceeds size limit
            const largeFile = new Blob(['x'.repeat(100 * 1024 * 1024)], { type: 'image/jpeg' }); // 100MB
            const result = await handler.uploadFile(largeFile, 'large.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toContain('volumineux');
        });
        it('should validate allowed file types', async () => {
            const restrictedHandler = new FileUploadHandler_1.FileUploadHandler({
                ...mockOptions,
                allowedTypes: ['image/jpeg', 'image/png']
            });
            const file = new Blob(['test'], { type: 'text/plain' });
            const result = await restrictedHandler.uploadFile(file, 'test.txt');
            expect(result.success).toBe(false);
            expect(result.error).toContain('non autorisé');
        });
        it('should validate required parameters', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            const result = await handler.uploadFile(file);
            // Should handle gracefully with default filename
            expect(result).toBeDefined();
        });
        it('should handle file validation gracefully', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            const result = await handler.uploadFile(file, 'test.jpg');
            // Should handle gracefully
            expect(result).toBeDefined();
        });
    });
    describe('File Upload Process', () => {
        it('should upload small file successfully', async () => {
            const file = new Blob(['test content'], { type: 'image/jpeg' });
            // Mock successful responses
            mockFetch
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({
                    id: 'file_upload_123',
                    status: 'pending'
                })
            })
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({})
            });
            const result = await handler.uploadFile(file, 'test.jpg');
            expect(result.success).toBe(true);
            expect(result.publicId).toBe('file_upload_123');
            expect(mockFetch).toHaveBeenCalledTimes(2);
        });
        it('should handle upload API errors', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            mockFetch.mockResolvedValueOnce({
                ok: false,
                status: 400,
                text: async () => 'Bad Request'
            });
            const result = await handler.uploadFile(file, 'test.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toBeDefined();
        });
        it('should handle network errors', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            mockFetch.mockRejectedValueOnce(new Error('Network error'));
            const result = await handler.uploadFile(file, 'test.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toBeDefined();
        });
        it('should call progress callback if provided', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            const progressCallback = jest.fn();
            const handlerWithProgress = new FileUploadHandler_1.FileUploadHandler({
                ...mockOptions,
                onProgress: progressCallback
            });
            mockFetch
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({
                    id: 'file_upload_123',
                    status: 'pending'
                })
            })
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({})
            });
            await handlerWithProgress.uploadFile(file, 'test.jpg');
            // Progress callback should be called during upload process
            expect(progressCallback).toHaveBeenCalled();
        });
    });
    describe('Large File Handling', () => {
        it('should handle large files within size limits', async () => {
            const largeFile = new Blob(['x'.repeat(15 * 1024 * 1024)], { type: 'image/jpeg' }); // 15MB
            mockFetch
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({
                    id: 'file_upload_123',
                    status: 'pending'
                })
            })
                .mockResolvedValueOnce({
                ok: true,
                json: async () => ({})
            });
            const result = await handler.uploadFile(largeFile, 'large.jpg');
            expect(result.success).toBe(true);
            expect(mockFetch).toHaveBeenCalledTimes(2);
        });
        it('should reject files exceeding size limit', async () => {
            const tooLargeFile = new Blob(['x'.repeat(25 * 1024 * 1024)], { type: 'image/jpeg' }); // 25MB
            const result = await handler.uploadFile(tooLargeFile, 'toolarge.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toContain('volumineux');
        });
    });
    describe('Block Creation', () => {
        it('should create image block correctly', () => {
            const uploadResult = {
                success: true,
                publicId: 'file_upload_123',
                metadata: {
                    originalName: 'test.jpg',
                    size: 1024,
                    type: 'image/jpeg'
                }
            };
            const block = handler.createNotionBlock('image', uploadResult);
            expect(block.type).toBe('image');
            expect(block.image.type).toBe('file_upload');
            expect(block.image.file_upload.id).toBe('file_upload_123');
        });
        it('should create video block correctly', () => {
            const uploadResult = {
                success: true,
                publicId: 'file_upload_456',
                metadata: {
                    originalName: 'test.mp4',
                    size: 2048,
                    type: 'video/mp4'
                }
            };
            const block = handler.createNotionBlock('video', uploadResult);
            expect(block.type).toBe('video');
            expect(block.video.type).toBe('file_upload');
            expect(block.video.file_upload.id).toBe('file_upload_456');
        });
        it('should create audio block correctly', () => {
            const uploadResult = {
                success: true,
                publicId: 'file_upload_789',
                metadata: {
                    originalName: 'test.mp3',
                    size: 3072,
                    type: 'audio/mp3'
                }
            };
            const block = handler.createNotionBlock('audio', uploadResult);
            expect(block.type).toBe('audio');
            expect(block.audio.type).toBe('file_upload');
            expect(block.audio.file_upload.id).toBe('file_upload_789');
        });
        it('should create file block for unknown types', () => {
            const uploadResult = {
                success: true,
                publicId: 'file_upload_000',
                metadata: {
                    originalName: 'document.pdf',
                    size: 4096,
                    type: 'application/pdf'
                }
            };
            const block = handler.createNotionBlock('file', uploadResult);
            expect(block.type).toBe('file');
            expect(block.file.type).toBe('file_upload');
            expect(block.file.file_upload.id).toBe('file_upload_000');
        });
    });
    describe('Notion Block Creation', () => {
        it('should create blocks from upload results', () => {
            const uploadResult = {
                success: true,
                publicId: 'file_upload_123',
                metadata: {
                    originalName: 'test.jpg',
                    size: 1024,
                    type: 'image/jpeg'
                }
            };
            const block = handler.createNotionBlock('image', uploadResult);
            expect(block.type).toBe('image');
            expect(block.image.type).toBe('file_upload');
            expect(block.image.file_upload.id).toBe('file_upload_123');
        });
    });
    describe('Error Handling', () => {
        it('should handle network errors gracefully', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            mockFetch.mockRejectedValueOnce(new Error('Network error'));
            const result = await handler.uploadFile(file, 'test.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toContain('Network error');
        });
        it('should handle invalid Notion token', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            mockFetch.mockResolvedValueOnce({
                ok: false,
                status: 401,
                text: async () => 'Unauthorized'
            });
            const result = await handler.uploadFile(file, 'test.jpg');
            expect(result.success).toBe(false);
            expect(result.error).toContain('401');
        });
        it('should handle empty files', async () => {
            const emptyFile = new Blob([], { type: 'text/plain' });
            const result = await handler.uploadFile(emptyFile, 'empty.txt');
            // Should handle gracefully
            expect(result).toBeDefined();
        });
        it('should handle special characters in filename', async () => {
            const file = new Blob(['test'], { type: 'image/jpeg' });
            const specialFilename = 'tëst fîlé with spéciàl chars.jpg';
            mockFetch.mockResolvedValue({
                ok: true,
                json: async () => ({
                    id: 'file_upload_123',
                    status: 'pending'
                })
            });
            const result = await handler.uploadFile(file, specialFilename);
            expect(result.success).toBe(true);
        });
    });
    describe('Integration Tests', () => {
        it('should work with uploadFileAndParse function', async () => {
            const file = new Blob(['test image content'], { type: 'image/jpeg' });
            mockFetch.mockResolvedValue({
                ok: true,
                json: async () => ({
                    id: 'file_upload_123',
                    status: 'uploaded'
                })
            });
            const result = await (0, FileUploadHandler_1.uploadFileAndParse)(file, {
                upload: mockOptions
            });
            expect(result.uploadResult.success).toBe(true);
            expect(result.block).toBeDefined();
            expect(result.block?.type).toBe('image');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHVuaXRcXHV0aWxzXFxGaWxlVXBsb2FkSGFuZGxlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsNEVBQTZGO0FBRzdGLDRCQUE0QjtBQUM1QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDNUIsTUFBTSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7QUFFekIsUUFBUSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtJQUM5RCxJQUFJLE9BQTBCLENBQUM7SUFDL0IsTUFBTSxXQUFXLEdBQUc7UUFDbEIsV0FBVyxFQUFFLHVCQUF1QjtRQUNwQyxXQUFXLEVBQUUsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJO0tBQzlCLENBQUM7SUFFRixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsT0FBTyxHQUFHLElBQUkscUNBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDN0MsU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtRQUM3QyxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QixNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxxQ0FBaUIsQ0FBQyxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDckUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLE1BQU0sY0FBYyxHQUFHLElBQUkscUNBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDMUQsTUFBTSxDQUFDLGNBQWMsQ0FB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QixFQUFFLEVBQUUsSUFBSTtnQkFDUixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDO29CQUNqQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsVUFBVTtpQkFDbkIsQ0FBQzthQUNILENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxzQ0FBa0IsRUFBQyxJQUFJLEVBQUU7Z0JBQzVDLE1BQU0sRUFBRSxXQUFXO2FBQ3BCLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxyYXlhblxcRGVza3RvcFxcRGV2XFxOb3Rpb25DbGlwcGVyXFxwYWNrYWdlc1xcbm90aW9uLXBhcnNlclxcdGVzdHNcXHVuaXRcXHV0aWxzXFxGaWxlVXBsb2FkSGFuZGxlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUZXN0cyB1bml0YWlyZXMgcG91ciBGaWxlVXBsb2FkSGFuZGxlciAtIFVwbG9hZCBuYXRpZiBOb3Rpb24gdjIuMSDirZBcclxuICogQ291dnJlIGwndXBsb2FkIGRlIGZpY2hpZXJzIHZpYSBsJ0FQSSBOb3Rpb24gbmF0aXZlIC92MS9maWxlX3VwbG9hZHNcclxuICovXHJcblxyXG5pbXBvcnQgeyBGaWxlVXBsb2FkSGFuZGxlciwgdXBsb2FkRmlsZUFuZFBhcnNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3V0aWxzL0ZpbGVVcGxvYWRIYW5kbGVyJztcclxuaW1wb3J0IHR5cGUgeyBGaWxlVXBsb2FkUmVzdWx0IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3V0aWxzL0ZpbGVVcGxvYWRIYW5kbGVyJztcclxuXHJcbi8vIE1vY2sgZmV0Y2ggcG91ciBsZXMgdGVzdHNcclxuY29uc3QgbW9ja0ZldGNoID0gamVzdC5mbigpO1xyXG5nbG9iYWwuZmV0Y2ggPSBtb2NrRmV0Y2g7XHJcblxyXG5kZXNjcmliZSgnRmlsZVVwbG9hZEhhbmRsZXIgLSBVcGxvYWQgbmF0aWYgTm90aW9uIHYyLjEg4q2QJywgKCkgPT4ge1xyXG4gIGxldCBoYW5kbGVyOiBGaWxlVXBsb2FkSGFuZGxlcjtcclxuICBjb25zdCBtb2NrT3B0aW9ucyA9IHtcclxuICAgIG5vdGlvblRva2VuOiAnc2VjcmV0X3Rlc3RfdG9rZW5fMTIzJyxcclxuICAgIG1heEZpbGVTaXplOiAyMCAqIDEwMjQgKiAxMDI0XHJcbiAgfTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBoYW5kbGVyID0gbmV3IEZpbGVVcGxvYWRIYW5kbGVyKG1vY2tPcHRpb25zKTtcclxuICAgIG1vY2tGZXRjaC5tb2NrQ2xlYXIoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NvbnN0cnVjdG9yIGFuZCBDb25maWd1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggTm90aW9uIHRva2VuJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoaGFuZGxlcikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KCgpID0+IG5ldyBGaWxlVXBsb2FkSGFuZGxlcih7IG5vdGlvblRva2VuOiAnJyB9KSkudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBvcHRpb25zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkZWZhdWx0SGFuZGxlciA9IG5ldyBGaWxlVXBsb2FkSGFuZGxlcihtb2NrT3B0aW9ucyk7XHJcbiAgICAgIGV4cGVjdChkZWZhdWx0SGFuZGxlcikudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGN1c3RvbSBvcHRpb25zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjdXN0b21IYW5kbGVyID0gbmV3IEZpbGVVcGxvYWRIYW5kbGVyKHtcclxuICAgICAgICAuLi5tb2NrT3B0aW9ucyxcclxuICAgICAgICBtYXhGaWxlU2l6ZTogNTAgKiAxMDI0ICogMTAyNFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KGN1c3RvbUhhbmRsZXIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0ZpbGUgVmFsaWRhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZmlsZSBzaXplIGxpbWl0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQ3JlYXRlIGEgbW9jayBmaWxlIHRoYXQgZXhjZWVkcyBzaXplIGxpbWl0XHJcbiAgICAgIGNvbnN0IGxhcmdlRmlsZSA9IG5ldyBCbG9iKFsneCcucmVwZWF0KDEwMCAqIDEwMjQgKiAxMDI0KV0sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pOyAvLyAxMDBNQlxyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci51cGxvYWRGaWxlKGxhcmdlRmlsZSwgJ2xhcmdlLmpwZycpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCd2b2x1bWluZXV4Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFsbG93ZWQgZmlsZSB0eXBlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdHJpY3RlZEhhbmRsZXIgPSBuZXcgRmlsZVVwbG9hZEhhbmRsZXIoe1xyXG4gICAgICAgIC4uLm1vY2tPcHRpb25zLFxyXG4gICAgICAgIGFsbG93ZWRUeXBlczogWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZyddXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZmlsZSA9IG5ldyBCbG9iKFsndGVzdCddLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzdHJpY3RlZEhhbmRsZXIudXBsb2FkRmlsZShmaWxlLCAndGVzdC50eHQnKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignbm9uIGF1dG9yaXPDqScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1aXJlZCBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWyd0ZXN0J10sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci51cGxvYWRGaWxlKGZpbGUpO1xyXG4gICAgICBcclxuICAgICAgLy8gU2hvdWxkIGhhbmRsZSBncmFjZWZ1bGx5IHdpdGggZGVmYXVsdCBmaWxlbmFtZVxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZmlsZSB2YWxpZGF0aW9uIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgQmxvYihbJ3Rlc3QnXSwgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyLnVwbG9hZEZpbGUoZmlsZSwgJ3Rlc3QuanBnJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTaG91bGQgaGFuZGxlIGdyYWNlZnVsbHlcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRmlsZSBVcGxvYWQgUHJvY2VzcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdXBsb2FkIHNtYWxsIGZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWyd0ZXN0IGNvbnRlbnQnXSwgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcmVzcG9uc2VzXHJcbiAgICAgIG1vY2tGZXRjaFxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgb2s6IHRydWUsXHJcbiAgICAgICAgICBqc29uOiBhc3luYyAoKSA9PiAoe1xyXG4gICAgICAgICAgICBpZDogJ2ZpbGVfdXBsb2FkXzEyMycsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7fSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIudXBsb2FkRmlsZShmaWxlLCAndGVzdC5qcGcnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wdWJsaWNJZCkudG9CZSgnZmlsZV91cGxvYWRfMTIzJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrRmV0Y2gpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVwbG9hZCBBUEkgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWyd0ZXN0J10sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgb2s6IGZhbHNlLFxyXG4gICAgICAgIHN0YXR1czogNDAwLFxyXG4gICAgICAgIHRleHQ6IGFzeW5jICgpID0+ICdCYWQgUmVxdWVzdCdcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyLnVwbG9hZEZpbGUoZmlsZSwgJ3Rlc3QuanBnJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgQmxvYihbJ3Rlc3QnXSwgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRmV0Y2gubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIudXBsb2FkRmlsZShmaWxlLCAndGVzdC5qcGcnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNhbGwgcHJvZ3Jlc3MgY2FsbGJhY2sgaWYgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgQmxvYihbJ3Rlc3QnXSwgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XHJcbiAgICAgIGNvbnN0IHByb2dyZXNzQ2FsbGJhY2sgPSBqZXN0LmZuKCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBoYW5kbGVyV2l0aFByb2dyZXNzID0gbmV3IEZpbGVVcGxvYWRIYW5kbGVyKHtcclxuICAgICAgICAuLi5tb2NrT3B0aW9ucyxcclxuICAgICAgICBvblByb2dyZXNzOiBwcm9ncmVzc0NhbGxiYWNrXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7XHJcbiAgICAgICAgICAgIGlkOiAnZmlsZV91cGxvYWRfMTIzJyxcclxuICAgICAgICAgICAgc3RhdHVzOiAncGVuZGluZydcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICAgIG9rOiB0cnVlLFxyXG4gICAgICAgICAganNvbjogYXN5bmMgKCkgPT4gKHt9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgaGFuZGxlcldpdGhQcm9ncmVzcy51cGxvYWRGaWxlKGZpbGUsICd0ZXN0LmpwZycpO1xyXG5cclxuICAgICAgLy8gUHJvZ3Jlc3MgY2FsbGJhY2sgc2hvdWxkIGJlIGNhbGxlZCBkdXJpbmcgdXBsb2FkIHByb2Nlc3NcclxuICAgICAgZXhwZWN0KHByb2dyZXNzQ2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTGFyZ2UgRmlsZSBIYW5kbGluZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIGZpbGVzIHdpdGhpbiBzaXplIGxpbWl0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbGFyZ2VGaWxlID0gbmV3IEJsb2IoWyd4Jy5yZXBlYXQoMTUgKiAxMDI0ICogMTAyNCldLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KTsgLy8gMTVNQlxyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7XHJcbiAgICAgICAgICAgIGlkOiAnZmlsZV91cGxvYWRfMTIzJyxcclxuICAgICAgICAgICAgc3RhdHVzOiAncGVuZGluZydcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICAgIG9rOiB0cnVlLFxyXG4gICAgICAgICAganNvbjogYXN5bmMgKCkgPT4gKHt9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci51cGxvYWRGaWxlKGxhcmdlRmlsZSwgJ2xhcmdlLmpwZycpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QobW9ja0ZldGNoKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBmaWxlcyBleGNlZWRpbmcgc2l6ZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdG9vTGFyZ2VGaWxlID0gbmV3IEJsb2IoWyd4Jy5yZXBlYXQoMjUgKiAxMDI0ICogMTAyNCldLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KTsgLy8gMjVNQlxyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci51cGxvYWRGaWxlKHRvb0xhcmdlRmlsZSwgJ3Rvb2xhcmdlLmpwZycpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCd2b2x1bWluZXV4Jyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Jsb2NrIENyZWF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgaW1hZ2UgYmxvY2sgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cGxvYWRSZXN1bHQ6IEZpbGVVcGxvYWRSZXN1bHQgPSB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBwdWJsaWNJZDogJ2ZpbGVfdXBsb2FkXzEyMycsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIG9yaWdpbmFsTmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICAgIHNpemU6IDEwMjQsXHJcbiAgICAgICAgICB0eXBlOiAnaW1hZ2UvanBlZydcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBibG9jayA9IGhhbmRsZXIuY3JlYXRlTm90aW9uQmxvY2soJ2ltYWdlJywgdXBsb2FkUmVzdWx0KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChibG9jay50eXBlKS50b0JlKCdpbWFnZScpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkuaW1hZ2UudHlwZSkudG9CZSgnZmlsZV91cGxvYWQnKTtcclxuICAgICAgZXhwZWN0KChibG9jayBhcyBhbnkpLmltYWdlLmZpbGVfdXBsb2FkLmlkKS50b0JlKCdmaWxlX3VwbG9hZF8xMjMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHZpZGVvIGJsb2NrIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgY29uc3QgdXBsb2FkUmVzdWx0OiBGaWxlVXBsb2FkUmVzdWx0ID0ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcHVibGljSWQ6ICdmaWxlX3VwbG9hZF80NTYnLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6ICd0ZXN0Lm1wNCcsXHJcbiAgICAgICAgICBzaXplOiAyMDQ4LFxyXG4gICAgICAgICAgdHlwZTogJ3ZpZGVvL21wNCdcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBibG9jayA9IGhhbmRsZXIuY3JlYXRlTm90aW9uQmxvY2soJ3ZpZGVvJywgdXBsb2FkUmVzdWx0KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChibG9jay50eXBlKS50b0JlKCd2aWRlbycpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkudmlkZW8udHlwZSkudG9CZSgnZmlsZV91cGxvYWQnKTtcclxuICAgICAgZXhwZWN0KChibG9jayBhcyBhbnkpLnZpZGVvLmZpbGVfdXBsb2FkLmlkKS50b0JlKCdmaWxlX3VwbG9hZF80NTYnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGF1ZGlvIGJsb2NrIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgY29uc3QgdXBsb2FkUmVzdWx0OiBGaWxlVXBsb2FkUmVzdWx0ID0ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcHVibGljSWQ6ICdmaWxlX3VwbG9hZF83ODknLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6ICd0ZXN0Lm1wMycsXHJcbiAgICAgICAgICBzaXplOiAzMDcyLFxyXG4gICAgICAgICAgdHlwZTogJ2F1ZGlvL21wMydcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBibG9jayA9IGhhbmRsZXIuY3JlYXRlTm90aW9uQmxvY2soJ2F1ZGlvJywgdXBsb2FkUmVzdWx0KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChibG9jay50eXBlKS50b0JlKCdhdWRpbycpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkuYXVkaW8udHlwZSkudG9CZSgnZmlsZV91cGxvYWQnKTtcclxuICAgICAgZXhwZWN0KChibG9jayBhcyBhbnkpLmF1ZGlvLmZpbGVfdXBsb2FkLmlkKS50b0JlKCdmaWxlX3VwbG9hZF83ODknKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGZpbGUgYmxvY2sgZm9yIHVua25vd24gdHlwZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVwbG9hZFJlc3VsdDogRmlsZVVwbG9hZFJlc3VsdCA9IHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIHB1YmxpY0lkOiAnZmlsZV91cGxvYWRfMDAwJyxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgb3JpZ2luYWxOYW1lOiAnZG9jdW1lbnQucGRmJyxcclxuICAgICAgICAgIHNpemU6IDQwOTYsXHJcbiAgICAgICAgICB0eXBlOiAnYXBwbGljYXRpb24vcGRmJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGJsb2NrID0gaGFuZGxlci5jcmVhdGVOb3Rpb25CbG9jaygnZmlsZScsIHVwbG9hZFJlc3VsdCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoYmxvY2sudHlwZSkudG9CZSgnZmlsZScpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkuZmlsZS50eXBlKS50b0JlKCdmaWxlX3VwbG9hZCcpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkuZmlsZS5maWxlX3VwbG9hZC5pZCkudG9CZSgnZmlsZV91cGxvYWRfMDAwJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ05vdGlvbiBCbG9jayBDcmVhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGJsb2NrcyBmcm9tIHVwbG9hZCByZXN1bHRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cGxvYWRSZXN1bHQ6IEZpbGVVcGxvYWRSZXN1bHQgPSB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBwdWJsaWNJZDogJ2ZpbGVfdXBsb2FkXzEyMycsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIG9yaWdpbmFsTmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICAgIHNpemU6IDEwMjQsXHJcbiAgICAgICAgICB0eXBlOiAnaW1hZ2UvanBlZydcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBibG9jayA9IGhhbmRsZXIuY3JlYXRlTm90aW9uQmxvY2soJ2ltYWdlJywgdXBsb2FkUmVzdWx0KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChibG9jay50eXBlKS50b0JlKCdpbWFnZScpO1xyXG4gICAgICBleHBlY3QoKGJsb2NrIGFzIGFueSkuaW1hZ2UudHlwZSkudG9CZSgnZmlsZV91cGxvYWQnKTtcclxuICAgICAgZXhwZWN0KChibG9jayBhcyBhbnkpLmltYWdlLmZpbGVfdXBsb2FkLmlkKS50b0JlKCdmaWxlX3VwbG9hZF8xMjMnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBuZXR3b3JrIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWyd0ZXN0J10sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ05ldHdvcmsgZXJyb3InKSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyLnVwbG9hZEZpbGUoZmlsZSwgJ3Rlc3QuanBnJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ05ldHdvcmsgZXJyb3InKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgTm90aW9uIHRva2VuJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWyd0ZXN0J10sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgb2s6IGZhbHNlLFxyXG4gICAgICAgIHN0YXR1czogNDAxLFxyXG4gICAgICAgIHRleHQ6IGFzeW5jICgpID0+ICdVbmF1dGhvcml6ZWQnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci51cGxvYWRGaWxlKGZpbGUsICd0ZXN0LmpwZycpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCc0MDEnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGZpbGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlbXB0eUZpbGUgPSBuZXcgQmxvYihbXSwgeyB0eXBlOiAndGV4dC9wbGFpbicgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyLnVwbG9hZEZpbGUoZW1wdHlGaWxlLCAnZW1wdHkudHh0Jyk7XHJcblxyXG4gICAgICAvLyBTaG91bGQgaGFuZGxlIGdyYWNlZnVsbHlcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBmaWxlbmFtZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG5ldyBCbG9iKFsndGVzdCddLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KTtcclxuICAgICAgY29uc3Qgc3BlY2lhbEZpbGVuYW1lID0gJ3TDq3N0IGbDrmzDqSB3aXRoIHNww6ljacOgbCBjaGFycy5qcGcnO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICBqc29uOiBhc3luYyAoKSA9PiAoe1xyXG4gICAgICAgICAgaWQ6ICdmaWxlX3VwbG9hZF8xMjMnLFxyXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZydcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIudXBsb2FkRmlsZShmaWxlLCBzcGVjaWFsRmlsZW5hbWUpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIHVwbG9hZEZpbGVBbmRQYXJzZSBmdW5jdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG5ldyBCbG9iKFsndGVzdCBpbWFnZSBjb250ZW50J10sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICBqc29uOiBhc3luYyAoKSA9PiAoe1xyXG4gICAgICAgICAgaWQ6ICdmaWxlX3VwbG9hZF8xMjMnLFxyXG4gICAgICAgICAgc3RhdHVzOiAndXBsb2FkZWQnXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRGaWxlQW5kUGFyc2UoZmlsZSwge1xyXG4gICAgICAgIHVwbG9hZDogbW9ja09wdGlvbnNcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnVwbG9hZFJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2NrKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2NrPy50eXBlKS50b0JlKCdpbWFnZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==